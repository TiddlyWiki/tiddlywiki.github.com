<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 6, revision: 6, alpha: 1, date: new Date("October 6, 2011"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2012

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->

<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->
<!--PRE-HEAD-END-->
<title>

</title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->
<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->
<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2012 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>
&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>
Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>
/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLayout">
<pre>
/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>
/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetPrint">
<pre>
/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/
</pre>
</div>
<div title="PageTemplate">
<pre>
&lt;!--{{{--&gt;
&lt;div class='header' role='banner' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea' role='main'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ViewTemplate">
<pre>
&lt;!--{{{--&gt;
&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="EditTemplate">
<pre>
&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="GettingStarted">
<pre>
To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;
</pre>
</div>
<div title="OptionsPanel">
<pre>
These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]
</pre>
</div>
<div title="ImportTiddlers">
<pre>
&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
var config={numRssItems:20,animDuration:400,cascadeFast:20,cascadeSlow:60,cascadeDepth:5,locale:"en"};
config.parsers={};
config.adaptors={};
config.defaultAdaptor=null;
config.tasks={};
config.annotations={};
config.defaultCustomFields={};
config.messages={messageClose:{},dates:{},tiddlerPopup:{}};
config.options={chkRegExpSearch:false,chkCaseSensitiveSearch:false,chkIncrementalSearch:true,chkAnimate:true,chkSaveBackups:true,chkAutoSave:false,chkGenerateAnRssFeed:false,chkSaveEmptyTemplate:false,chkOpenInNewWindow:true,chkToggleLinks:false,chkHttpReadOnly:true,chkForceMinorUpdate:false,chkConfirmDelete:true,chkInsertTabs:false,chkUsePreForStorage:true,chkDisplayInstrumentation:false,txtBackupFolder:"",txtEditorFocus:"text",txtMainTab:"tabTimeline",txtMoreTab:"moreTabAll",txtMaxEditRows:"30",txtFileSystemCharSet:"UTF-8",txtTheme:""};
config.optionsDesc={};
config.optionsSource={};
var DEFAULT_VIEW_TEMPLATE=1;
var DEFAULT_EDIT_TEMPLATE=2;
config.tiddlerTemplates={1:"ViewTemplate",2:"EditTemplate"};
config.views={wikified:{tag:{}},editor:{tagChooser:{}}};
config.backstageTasks=["save","importTask","tweak","upgrade","plugins"];
config.extensions={};
config.macros={today:{},version:{},search:{sizeTextbox:15},tiddler:{},tag:{},tags:{},tagging:{},timeline:{},allTags:{},list:{all:{},missing:{},orphans:{},shadowed:{},touched:{},filter:{}},closeAll:{},permaview:{},saveChanges:{},slider:{},option:{},options:{},newTiddler:{},newJournal:{},tabs:{},gradient:{},message:{},view:{defaultView:"text"},edit:{},tagChooser:{},toolbar:{},plugins:{},refreshDisplay:{},importTiddlers:{},upgrade:{source:"http://tiddlywiki-releases.tiddlyspace.com/upgrade",backupExtension:"pre.core.upgrade"},sync:{},annotations:{}};
config.commands={closeTiddler:{},closeOthers:{},editTiddler:{},saveTiddler:{hideReadOnly:true},cancelTiddler:{},deleteTiddler:{hideReadOnly:true},permalink:{},references:{type:"popup"},jump:{type:"popup"},syncing:{type:"popup"},fields:{type:"popup"}};
config.evaluateMacroParameters="all";
config.textPrimitives={upperLetter:"[A-Z\xc0-\xde\u0150\u0170]",lowerLetter:"[a-z0-9_\\-\xdf-\xff\u0151\u0171]",anyLetter:"[A-Za-z0-9_\\-\xc0-\xde\xdf-\xff\u0150\u0170\u0151\u0171]",anyLetterStrict:"[A-Za-z0-9\xc0-\xde\xdf-\xff\u0150\u0170\u0151\u0171]"};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))){
config.textPrimitives={upperLetter:"[A-Z\xc0-\xde]",lowerLetter:"[a-z0-9_\\-\xdf-\xff]",anyLetter:"[A-Za-z0-9_\\-\xc0-\xde\xdf-\xff]",anyLetterStrict:"[A-Za-z0-9\xc0-\xde\xdf-\xff]"};
}
config.textPrimitives.sliceSeparator="::";
config.textPrimitives.sectionSeparator="##";
config.textPrimitives.urlPattern="(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink="~";
config.textPrimitives.wikiLink="(?:(?:"+config.textPrimitives.upperLetter+"+"+config.textPrimitives.lowerLetter+"+"+config.textPrimitives.upperLetter+config.textPrimitives.anyLetter+"*)|(?:"+config.textPrimitives.upperLetter+"{2,}"+config.textPrimitives.lowerLetter+"+))";
config.textPrimitives.cssLookahead="(?:("+config.textPrimitives.anyLetter+"+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:("+config.textPrimitives.anyLetter+"+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp=new RegExp(config.textPrimitives.cssLookahead,"mg");
config.textPrimitives.brackettedLink="\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink="\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp=new RegExp("(?:"+config.textPrimitives.titledBrackettedLink+")|(?:"+config.textPrimitives.brackettedLink+")|(?:"+config.textPrimitives.urlPattern+")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp=new RegExp("("+config.textPrimitives.wikiLink+")|(?:"+config.textPrimitives.titledBrackettedLink+")|(?:"+config.textPrimitives.brackettedLink+")|(?:"+config.textPrimitives.urlPattern+")","mg");
config.glyphs={currBrowser:null,browsers:[],codes:{}};
config.shadowTiddlers={StyleSheet:"",MarkupPreHead:"",MarkupPostHead:"",MarkupPreBody:"",MarkupPostBody:"",TabTimeline:"<<timeline>>",TabAll:"<<list all>>",TabTags:"<<allTags excludeLists>>",TabMoreMissing:"<<list missing>>",TabMoreOrphans:"<<list orphans>>",TabMoreShadowed:"<<list shadowed>>",AdvancedOptions:"<<options>>",PluginManager:"<<plugins>>",SystemSettings:"",ToolbarCommands:"|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|",WindowTitle:"<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>"};
config.userAgent=navigator.userAgent.toLowerCase();
config.browser={isIE:config.userAgent.indexOf("msie")!=-1&&config.userAgent.indexOf("opera")==-1,isGecko:navigator.product=="Gecko"&&config.userAgent.indexOf("WebKit")==-1,ieVersion:/MSIE (\d.\d)/i.exec(config.userAgent),isSafari:config.userAgent.indexOf("applewebkit")!=-1,isBadSafari:!((new RegExp("[\u0150\u0170]","g")).test("\u0150")),firefoxDate:/gecko\/(\d{8})/i.exec(config.userAgent),isOpera:config.userAgent.indexOf("opera")!=-1,isChrome:config.userAgent.indexOf("chrome")>-1,isLinux:config.userAgent.indexOf("linux")!=-1,isUnix:config.userAgent.indexOf("x11")!=-1,isMac:config.userAgent.indexOf("mac")!=-1,isWindows:config.userAgent.indexOf("win")!=-1};
merge(config.glyphs,{browsers:[function(){
return config.browser.isIE;
},function(){
return true;
}],codes:{downTriangle:["\u25bc","\u25be"],downArrow:["\u2193","\u2193"],bentArrowLeft:["\u2190","\u21a9"],bentArrowRight:["\u2192","\u21aa"]}});
merge(config.options,{txtUserName:"YourName"});
merge(config.tasks,{save:{text:"save",tooltip:"Save your changes to this TiddlyWiki"},importTask:{text:"import",tooltip:"Import tiddlers and plugins from other TiddlyWiki files and servers",content:"<<importTiddlers>>"},tweak:{text:"tweak",tooltip:"Tweak the appearance and behaviour of TiddlyWiki",content:"<<options>>"},upgrade:{text:"upgrade",tooltip:"Upgrade TiddlyWiki core code",content:"<<upgrade>>"},plugins:{text:"plugins",tooltip:"Manage installed plugins",content:"<<plugins>>"}});
merge(config.optionsDesc,{txtUserName:"Username for signing your edits",chkRegExpSearch:"Enable regular expressions for searches",chkCaseSensitiveSearch:"Case-sensitive searching",chkIncrementalSearch:"Incremental key-by-key searching",chkAnimate:"Enable animations",chkSaveBackups:"Keep backup file when saving changes",chkAutoSave:"Automatically save changes",chkGenerateAnRssFeed:"Generate an RSS feed when saving changes",chkSaveEmptyTemplate:"Generate an empty template when saving changes",chkOpenInNewWindow:"Open external links in a new window",chkToggleLinks:"Clicking on links to open tiddlers causes them to close",chkHttpReadOnly:"Hide editing features when viewed over HTTP",chkForceMinorUpdate:"Don't update modifier username and date when editing tiddlers",chkConfirmDelete:"Require confirmation before deleting tiddlers",chkInsertTabs:"Use the tab key to insert tab characters instead of moving between fields",txtBackupFolder:"Name of folder to use for backups",txtMaxEditRows:"Maximum number of rows in edit boxes",txtTheme:"Name of the theme to use",txtFileSystemCharSet:"Default character set for saving changes (Firefox/Mozilla only)"});
merge(config.messages,{customConfigError:"Problems were encountered loading plugins. See PluginManager for details",pluginError:"Error: %0",pluginDisabled:"Not executed because disabled via 'systemConfigDisable' tag",pluginForced:"Executed because forced via 'systemConfigForce' tag",pluginVersionError:"Not executed because this plugin needs a newer version of TiddlyWiki",nothingSelected:"Nothing is selected. You must select one or more items first",savedSnapshotError:"It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",subtitleUnknown:"(unknown)",undefinedTiddlerToolTip:"The tiddler '%0' doesn't yet exist",shadowedTiddlerToolTip:"The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",tiddlerLinkTooltip:"%0 - %1, %2",externalLinkTooltip:"External link to %0",noTags:"There are no tagged tiddlers",notFileUrlError:"You need to save this TiddlyWiki to a file before you can save changes",cantSaveError:"It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",invalidFileError:"The original file '%0' does not appear to be a valid TiddlyWiki",backupSaved:"Backup saved",backupFailed:"Failed to save backup file",rssSaved:"RSS feed saved",rssFailed:"Failed to save RSS feed file",emptySaved:"Empty template saved",emptyFailed:"Failed to save empty template file",mainSaved:"Main TiddlyWiki file saved",mainFailed:"Failed to save main TiddlyWiki file. Your changes have not been saved",macroError:"Error in macro <<%0>>",macroErrorDetails:"Error while executing macro <<%0>>:\n%1",missingMacro:"No such macro",overwriteWarning:"A tiddler named '%0' already exists. Choose OK to overwrite it",unsavedChangesWarning:"WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",confirmExit:"--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",saveInstructions:"SaveChanges",unsupportedTWFormat:"Unsupported TiddlyWiki format '%0'",tiddlerSaveError:"Error when saving tiddler '%0'",tiddlerLoadError:"Error when loading tiddler '%0'",wrongSaveFormat:"Cannot save with storage format '%0'. Using standard format for save.",invalidFieldName:"Invalid field name %0",fieldCannotBeChanged:"Field '%0' cannot be changed",loadingMissingTiddler:"Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",upgradeDone:"The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",invalidCookie:"Invalid cookie '%0'"});
merge(config.messages.messageClose,{text:"close",tooltip:"close this message area"});
config.messages.backstage={open:{text:"backstage",tooltip:"Open the backstage area to perform authoring and editing tasks"},close:{text:"close",tooltip:"Close the backstage area"},prompt:"backstage: ",decal:{edit:{text:"edit",tooltip:"Edit the tiddler '%0'"}}};
config.messages.listView={tiddlerTooltip:"Click for the full text of this tiddler",previewUnavailable:"(preview not available)"};
config.messages.dates.months=["January","February","March","April","May","June","July","August","September","October","November","December"];
config.messages.dates.days=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
config.messages.dates.shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
config.messages.dates.shortDays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
config.messages.dates.daySuffixes=["st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"];
config.messages.dates.am="am";
config.messages.dates.pm="pm";
merge(config.messages.tiddlerPopup,{});
merge(config.views.wikified.tag,{labelNoTags:"no tags",labelTags:"tags: ",openTag:"Open tag '%0'",tooltip:"Show tiddlers tagged with '%0'",openAllText:"Open all",openAllTooltip:"Open all of these tiddlers",popupNone:"No other tiddlers tagged with '%0'"});
merge(config.views.wikified,{defaultText:"The tiddler '%0' doesn't yet exist. Double-click to create it",defaultModifier:"(missing)",shadowModifier:"(built-in shadow tiddler)",dateFormat:"DD MMM YYYY",createdPrompt:"created"});
merge(config.views.editor,{tagPrompt:"Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",defaultText:"Type the text for '%0'"});
merge(config.views.editor.tagChooser,{text:"tags",tooltip:"Choose existing tags to add to this tiddler",popupNone:"There are no tags defined",tagTooltip:"Add the tag '%0'"});
merge(config.messages,{sizeTemplates:[{unit:1024*1024*1024,template:"%0\xa0GB"},{unit:1024*1024,template:"%0\xa0MB"},{unit:1024,template:"%0\xa0KB"},{unit:1,template:"%0\xa0B"}]});
merge(config.macros.search,{label:"search",prompt:"Search this TiddlyWiki",placeholder:"",accessKey:"F",successMsg:"%0 tiddlers found matching %1",failureMsg:"No tiddlers found matching %0"});
merge(config.macros.tagging,{label:"tagging: ",labelNotTag:"not tagging",tooltip:"List of tiddlers tagged with '%0'"});
merge(config.macros.timeline,{dateFormat:"DD MMM YYYY"});
merge(config.macros.allTags,{tooltip:"Show tiddlers tagged with '%0'",noTags:"There are no tagged tiddlers"});
config.macros.list.all.prompt="All tiddlers in alphabetical order";
config.macros.list.missing.prompt="Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt="Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt="Tiddlers shadowed with default contents";
config.macros.list.touched.prompt="Tiddlers that have been modified locally";
merge(config.macros.closeAll,{label:"close all",prompt:"Close all displayed tiddlers (except any that are being edited)"});
merge(config.macros.permaview,{label:"permaview",prompt:"Link to an URL that retrieves all the currently displayed tiddlers"});
merge(config.macros.saveChanges,{label:"save changes",prompt:"Save all tiddlers to create a new TiddlyWiki",accessKey:"S"});
merge(config.macros.newTiddler,{label:"new tiddler",prompt:"Create a new tiddler",title:"New Tiddler",accessKey:"N"});
merge(config.macros.newJournal,{label:"new journal",prompt:"Create a new tiddler from the current date and time",accessKey:"J"});
merge(config.macros.options,{wizardTitle:"Tweak advanced options",step1Title:"These options are saved in cookies in your browser",step1Html:"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",unknownDescription:"//(unknown)//",listViewTemplate:{columns:[{name:"Option",field:"option",title:"Option",type:"String"},{name:"Description",field:"description",title:"Description",type:"WikiText"},{name:"Name",field:"name",title:"Name",type:"String"}],rowClasses:[{className:"lowlight",field:"lowlight"}]}});
merge(config.macros.plugins,{wizardTitle:"Manage plugins",step1Title:"Currently loaded plugins",step1Html:"<input type='hidden' name='markList'></input>",skippedText:"(This plugin has not been executed because it was added since startup)",noPluginText:"There are no plugins installed",confirmDeleteText:"Are you sure you want to delete these plugins:\n\n%0",removeLabel:"remove systemConfig tag",removePrompt:"Remove systemConfig tag",deleteLabel:"delete",deletePrompt:"Delete these tiddlers forever",listViewTemplate:{columns:[{name:"Selected",field:"Selected",rowName:"title",type:"Selector"},{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Description",field:"Description",title:"Description",type:"String"},{name:"Version",field:"Version",title:"Version",type:"String"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Forced",field:"forced",title:"Forced",tag:"systemConfigForce",type:"TagCheckbox"},{name:"Disabled",field:"disabled",title:"Disabled",tag:"systemConfigDisable",type:"TagCheckbox"},{name:"Executed",field:"executed",title:"Loaded",type:"Boolean",trueText:"Yes",falseText:"No"},{name:"Startup Time",field:"startupTime",title:"Startup Time",type:"String"},{name:"Error",field:"error",title:"Status",type:"Boolean",trueText:"Error",falseText:"OK"},{name:"Log",field:"log",title:"Log",type:"StringList"}],rowClasses:[{className:"error",field:"error"},{className:"warning",field:"warning"}]},listViewTemplateReadOnly:{columns:[{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Description",field:"Description",title:"Description",type:"String"},{name:"Version",field:"Version",title:"Version",type:"String"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Executed",field:"executed",title:"Loaded",type:"Boolean",trueText:"Yes",falseText:"No"},{name:"Startup Time",field:"startupTime",title:"Startup Time",type:"String"},{name:"Error",field:"error",title:"Status",type:"Boolean",trueText:"Error",falseText:"OK"},{name:"Log",field:"log",title:"Log",type:"StringList"}],rowClasses:[{className:"error",field:"error"},{className:"warning",field:"warning"}]}});
merge(config.macros.toolbar,{moreLabel:"more",morePrompt:"Show additional commands",lessLabel:"less",lessPrompt:"Hide additional commands",separator:"|"});
merge(config.macros.refreshDisplay,{label:"refresh",prompt:"Redraw the entire TiddlyWiki display"});
merge(config.macros.importTiddlers,{readOnlyWarning:"You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",wizardTitle:"Import tiddlers from another file or server",step1Title:"Step 1: Locate the server or TiddlyWiki file",step1Html:"Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",openLabel:"open",openPrompt:"Open the connection to this file or server",statusOpenHost:"Opening the host",statusGetWorkspaceList:"Getting the list of available workspaces",step2Title:"Step 2: Choose the workspace",step2Html:"Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",cancelLabel:"cancel",cancelPrompt:"Cancel this import",statusOpenWorkspace:"Opening the workspace",statusGetTiddlerList:"Getting the list of available tiddlers",errorGettingTiddlerList:"Error getting list of tiddlers, click Cancel to try again",errorGettingTiddlerListHttp404:"Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",errorGettingTiddlerListHttp:"Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",errorGettingTiddlerListFile:"Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",step3Title:"Step 3: Choose the tiddlers to import",step3Html:"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",importLabel:"import",importPrompt:"Import these tiddlers",confirmOverwriteText:"Are you sure you want to overwrite these tiddlers:\n\n%0",step4Title:"Step 4: Importing %0 tiddler(s)",step4Html:"<input type='hidden' name='markReport'></input>",doneLabel:"done",donePrompt:"Close this wizard",statusDoingImport:"Importing tiddlers",statusDoneImport:"All tiddlers imported",systemServerNamePattern:"%2 on %1",systemServerNamePatternNoWorkspace:"%1",confirmOverwriteSaveTiddler:"The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",serverSaveTemplate:"|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",serverSaveModifier:"(System)",listViewTemplate:{columns:[{name:"Selected",field:"Selected",rowName:"title",type:"Selector"},{name:"Tiddler",field:"tiddler",title:"Tiddler",type:"Tiddler"},{name:"Size",field:"size",tiddlerLink:"size",title:"Size",type:"Size"},{name:"Tags",field:"tags",title:"Tags",type:"Tags"}],rowClasses:[]}});
merge(config.macros.upgrade,{wizardTitle:"Upgrade TiddlyWiki core code",step1Title:"Update or repair this TiddlyWiki to the latest release",step1Html:"You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",errorCantUpgrade:"Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",errorNotSaved:"You must save changes before you can perform an upgrade",step2Title:"Confirm the upgrade details",step2Html_downgrade:"You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",step2Html_restore:"This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",step2Html_upgrade:"You are about to upgrade to TiddlyWiki version %0 from %1",upgradeLabel:"upgrade",upgradePrompt:"Prepare for the upgrade process",statusPreparingBackup:"Preparing backup",statusSavingBackup:"Saving backup file",errorSavingBackup:"There was a problem saving the backup file",statusLoadingCore:"Loading core code",errorLoadingCore:"Error loading the core code",errorCoreFormat:"Error with the new core code",statusSavingCore:"Saving the new core code",statusReloadingCore:"Reloading the new core code",startLabel:"start",startPrompt:"Start the upgrade process",cancelLabel:"cancel",cancelPrompt:"Cancel the upgrade process",step3Title:"Upgrade cancelled",step3Html:"You have cancelled the upgrade process"});
merge(config.macros.annotations,{});
merge(config.commands.closeTiddler,{text:"close",tooltip:"Close this tiddler"});
merge(config.commands.closeOthers,{text:"close others",tooltip:"Close all other tiddlers"});
merge(config.commands.editTiddler,{text:"edit",tooltip:"Edit this tiddler",readOnlyText:"view",readOnlyTooltip:"View the source of this tiddler"});
merge(config.commands.saveTiddler,{text:"done",tooltip:"Save changes to this tiddler"});
merge(config.commands.cancelTiddler,{text:"cancel",tooltip:"Undo changes to this tiddler",warning:"Are you sure you want to abandon your changes to '%0'?",readOnlyText:"done",readOnlyTooltip:"View this tiddler normally"});
merge(config.commands.deleteTiddler,{text:"delete",tooltip:"Delete this tiddler",warning:"Are you sure you want to delete '%0'?"});
merge(config.commands.permalink,{text:"permalink",tooltip:"Permalink for this tiddler"});
merge(config.commands.references,{text:"references",tooltip:"Show tiddlers that link to this one",popupNone:"No references"});
merge(config.commands.jump,{text:"jump",tooltip:"Jump to another open tiddler"});
merge(config.commands.fields,{text:"fields",tooltip:"Show the extended fields of this tiddler",emptyText:"There are no extended fields for this tiddler",listViewTemplate:{columns:[{name:"Field",field:"field",title:"Field",type:"String"},{name:"Value",field:"value",title:"Value",type:"String"}],rowClasses:[],buttons:[]}});
merge(config.shadowTiddlers,{DefaultTiddlers:"[[GettingStarted]]",MainMenu:"[[GettingStarted]]",SiteTitle:"My TiddlyWiki",SiteSubtitle:"a reusable non-linear personal web notebook",SiteUrl:"",SideBarOptions:"<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal \"DD MMM YYYY\" \"journal\">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel \"options \xbb\" \"Change TiddlyWiki advanced options\">>",SideBarTabs:"<<tabs txtMainTab \"Timeline\" \"Timeline\" TabTimeline \"All\" \"All tiddlers\" TabAll \"Tags\" \"All tags\" TabTags \"More\" \"More lists\" TabMore>>",TabMore:"<<tabs txtMoreTab \"Missing\" \"Missing tiddlers\" TabMoreMissing \"Orphans\" \"Orphaned tiddlers\" TabMoreOrphans \"Shadowed\" \"Shadowed tiddlers\" TabMoreShadowed>>"});
merge(config.annotations,{AdvancedOptions:"This shadow tiddler provides access to several advanced options",ColorPalette:"These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",DefaultTiddlers:"The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",EditTemplate:"The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",GettingStarted:"This shadow tiddler provides basic usage instructions",ImportTiddlers:"This shadow tiddler provides access to importing tiddlers",MainMenu:"This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",MarkupPreHead:"This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",MarkupPostHead:"This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",MarkupPreBody:"This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",MarkupPostBody:"This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",OptionsPanel:"This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",PageTemplate:"The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",PluginManager:"This shadow tiddler provides access to the plugin manager",SideBarOptions:"This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",SideBarTabs:"This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",SiteSubtitle:"This shadow tiddler is used as the second part of the page title",SiteTitle:"This shadow tiddler is used as the first part of the page title",SiteUrl:"This shadow tiddler should be set to the full target URL for publication",StyleSheetColors:"This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",StyleSheet:"This tiddler can contain custom CSS definitions",StyleSheetLayout:"This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",StyleSheetLocale:"This shadow tiddler contains CSS definitions related to the translation locale",StyleSheetPrint:"This shadow tiddler contains CSS definitions for printing",SystemSettings:"This tiddler is used to store configuration options for this TiddlyWiki document",TabAll:"This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",TabMore:"This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",TabMoreMissing:"This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",TabMoreOrphans:"This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",TabMoreShadowed:"This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",TabTags:"This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",TabTimeline:"This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",ToolbarCommands:"This shadow tiddler determines which commands are shown in tiddler toolbars",ViewTemplate:"The HTML template in this shadow tiddler determines how tiddlers look"});
var params=null;
var store=null;
var story=null;
var formatter=null;
var anim=typeof Animator=="function"?new Animator():null;
var readOnly=false;
var highlightHack=null;
var hadConfirmExit=false;
var safeMode=false;
var showBackstage;
var installedPlugins=[];
var startingUp=false;
var pluginInfo,tiddler;
var useJavaSaver=(config.browser.isSafari||config.browser.isOpera)&&(document.location.toString().substr(0,4)!="http");
if(!window||!window.console){
console={tiddlywiki:true,log:function(_1){
displayMessage(_1);
}};
}
function main(){
var _2,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0=new Date();
startingUp=true;
var _d=jQuery(document);
jQuery.noConflict();
window.onbeforeunload=function(e){
if(window.confirmExit){
return confirmExit();
}
};
params=getParameters();
if(params){
params=params.parseParams("open",null,false);
}
store=new TiddlyWiki({config:config});
invokeParamifier(params,"oninit");
story=new Story("tiddlerDisplay","tiddler");
addEvent(document,"click",Popup.onDocumentClick);
saveTest();
var s;
for(s=0;s<config.notifyTiddlers.length;s++){
store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
}
t1=new Date();
loadShadowTiddlers();
_d.trigger("loadShadows");
t2=new Date();
store.loadFromDiv("storeArea","store",true);
_d.trigger("loadTiddlers");
loadOptions();
t3=new Date();
invokeParamifier(params,"onload");
t4=new Date();
readOnly=(window.location.protocol=="file:")?false:config.options.chkHttpReadOnly;
var _10=loadPlugins("systemConfig");
_d.trigger("loadPlugins");
t5=new Date();
formatter=new Formatter(config.formatters);
invokeParamifier(params,"onconfig");
story.switchTheme(config.options.txtTheme);
showBackstage=showBackstage!==undefined?showBackstage:!readOnly;
t6=new Date();
var m;
for(m in config.macros){
if(config.macros[m].init){
config.macros[m].init();
}
}
t7=new Date();
store.notifyAll();
t8=new Date();
restart();
refreshDisplay();
t9=new Date();
if(_10){
story.displayTiddler(null,"PluginManager");
displayMessage(config.messages.customConfigError);
}
if(showBackstage){
backstage.init();
}
_2=new Date();
if(config.options.chkDisplayInstrumentation){
displayMessage("LoadShadows "+(t2-t1)+" ms");
displayMessage("LoadFromDiv "+(t3-t2)+" ms");
displayMessage("LoadPlugins "+(t5-t4)+" ms");
displayMessage("Macro init "+(t7-t6)+" ms");
displayMessage("Notify "+(t8-t7)+" ms");
displayMessage("Restart "+(t9-t8)+" ms");
displayMessage("Total: "+(_2-t0)+" ms");
}
startingUp=false;
_d.trigger("startup");
}
function unload(){
if(window.checkUnsavedChanges){
checkUnsavedChanges();
}
if(window.scrubNodes){
scrubNodes(document.body);
}
}
function restart(){
invokeParamifier(params,"onstart");
if(story.isEmpty()){
story.displayDefaultTiddlers();
}
window.scrollTo(0,0);
}
function saveTest(){
var s=document.getElementById("saveTest");
if(s.hasChildNodes()){
alert(config.messages.savedSnapshotError);
}
s.appendChild(document.createTextNode("savetest"));
}
function loadShadowTiddlers(){
var _13=new TiddlyWiki();
_13.loadFromDiv("shadowArea","shadows",true);
_13.forEachTiddler(function(_14,_15){
config.shadowTiddlers[_14]=_15.text;
});
}
function loadPlugins(tag){
if(safeMode){
return false;
}
var _17=store.getTaggedTiddlers(tag);
_17.sort(function(a,b){
return a.title<b.title?-1:(a.title==b.title?0:1);
});
var _1a=[];
var _1b=0;
var map={};
var _1d=_17.length;
installedPlugins=[];
var i;
for(i=0;i<_1d;i++){
var p=getPluginInfo(_17[i]);
installedPlugins[i]=p;
var n=p.Name||p.title;
if(n){
map[n]=p;
}
n=p.Source;
if(n){
map[n]=p;
}
}
var _21=function(p){
if(!p||p.done){
return;
}
p.done=1;
var _23=p.Requires;
if(_23){
_23=_23.readBracketedList();
var i;
for(i=0;i<_23.length;i++){
_21(map[_23[i]]);
}
}
_1a.push(p);
};
for(i=0;i<_1d;i++){
_21(installedPlugins[i]);
}
for(i=0;i<_1a.length;i++){
p=_1a[i];
pluginInfo=p;
tiddler=p.tiddler;
if(isPluginExecutable(p)){
if(isPluginEnabled(p)){
p.executed=true;
var _25=new Date();
try{
if(tiddler.text){
window.eval(tiddler.text);
}
_1b++;
}
catch(ex){
p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
p.error=true;
if(!console.tiddlywiki){
console.log("error evaluating "+tiddler.title,ex);
}
}
pluginInfo.startupTime=String((new Date())-_25)+"ms";
}else{
_1d--;
}
}else{
p.warning=true;
}
}
return _1b!=_1d;
}
function getPluginInfo(_26){
var p=store.getTiddlerSlices(_26.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
p.tiddler=_26;
p.title=_26.title;
p.log=[];
return p;
}
function isPluginExecutable(_28){
if(_28.tiddler.isTagged("systemConfigForce")){
_28.log.push(config.messages.pluginForced);
return true;
}
if(_28["CoreVersion"]){
var _29=_28["CoreVersion"].split(".");
var w=parseInt(_29[0],10)-version.major;
if(w==0&&_29[1]){
w=parseInt(_29[1],10)-version.minor;
}
if(w==0&&_29[2]){
w=parseInt(_29[2],10)-version.revision;
}
if(w>0){
_28.log.push(config.messages.pluginVersionError);
return false;
}
}
return true;
}
function isPluginEnabled(_2b){
if(_2b.tiddler.isTagged("systemConfigDisable")){
_2b.log.push(config.messages.pluginDisabled);
return false;
}
return true;
}
function getParameters(){
var p=null;
if(window.location.hash){
p=decodeURIComponent(window.location.hash.substr(1));
if(config.browser.firefoxDate!=null&&config.browser.firefoxDate[1]<"20051111"){
p=convertUTF8ToUnicode(p);
}
}
return p;
}
function invokeParamifier(_2d,_2e){
if(!_2d||_2d.length==undefined||_2d.length<=1){
return;
}
var i;
for(i=1;i<_2d.length;i++){
var p=config.paramifiers[_2d[i].name];
if(p&&p[_2e] instanceof Function){
p[_2e](_2d[i].value);
}else{
var h=config.optionHandlers[_2d[i].name.substr(0,3)];
if(h&&h.set instanceof Function){
h.set(_2d[i].name,_2d[i].value);
}
}
}
}
config.paramifiers={};
config.paramifiers.start={oninit:function(v){
safeMode=v.toLowerCase()=="safe";
}};
config.paramifiers.open={onstart:function(v){
if(!readOnly||store.tiddlerExists(v)||store.isShadowTiddler(v)){
story.displayTiddler("bottom",v,null,false,null);
}
}};
config.paramifiers.story={onstart:function(v){
var _35=store.getTiddlerText(v,"").parseParams("open",null,false);
invokeParamifier(_35,"onstart");
}};
config.paramifiers.search={onstart:function(v){
story.search(v,false,false);
}};
config.paramifiers.searchRegExp={onstart:function(v){
story.prototype.search(v,false,true);
}};
config.paramifiers.tag={onstart:function(v){
story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
}};
config.paramifiers.newTiddler={onstart:function(v){
var _3a=v.parseParams("anon",null,null)[0];
var _3b=_3a.title?_3a.title[0]:v;
var _3c=_3a.fields?_3a.fields[0]:null;
if(!readOnly){
story.displayTiddler(null,_3b,DEFAULT_EDIT_TEMPLATE,false,null,_3c);
story.focusTiddler(_3b,"text");
var i,_3e=_3a.tag||[];
for(i=0;i<_3e.length;i++){
story.setTiddlerTag(_3b,_3e[i],+1);
}
}
}};
config.paramifiers.newJournal={onstart:function(v){
if(!readOnly){
var now=new Date();
var _41=now.formatString(v.trim());
story.displayTiddler(null,_41,DEFAULT_EDIT_TEMPLATE);
story.focusTiddler(_41,"text");
}
}};
config.paramifiers.readOnly={onconfig:function(v){
var p=v.toLowerCase();
readOnly=p=="yes"?true:(p=="no"?false:readOnly);
}};
config.paramifiers.theme={onconfig:function(v){
story.switchTheme(v);
}};
config.paramifiers.upgrade={onstart:function(v){
upgradeFrom(v);
}};
config.paramifiers.recent={onstart:function(v){
var _47=[];
var i,_49=store.getTiddlers("modified","excludeLists").reverse();
for(i=0;i<v&&i<_49.length;i++){
_47.push(_49[i].title);
}
story.displayTiddlers(null,_47);
}};
config.paramifiers.filter={onstart:function(v){
story.displayTiddlers(null,store.filterTiddlers(v),null,false);
}};
function Formatter(_4b){
var n;
this.formatters=[];
var _4d=[];
for(n=0;n<_4b.length;n++){
_4d.push("("+_4b[n].match+")");
this.formatters.push(_4b[n]);
}
this.formatterRegExp=new RegExp(_4d.join("|"),"mg");
}
config.formatterHelpers={createElementAndWikify:function(w){
w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
},inlineCssHelper:function(w){
var _50=[];
config.textPrimitives.cssLookaheadRegExp.lastIndex=w.nextMatch;
var _51=config.textPrimitives.cssLookaheadRegExp.exec(w.source);
while(_51&&_51.index==w.nextMatch){
var s,v;
if(_51[1]){
s=_51[1].unDash();
v=_51[2];
}else{
s=_51[3].unDash();
v=_51[4];
}
if(s=="bgcolor"){
s="backgroundColor";
}
if(s=="float"){
s="cssFloat";
}
_50.push({style:s,value:v});
w.nextMatch=_51.index+_51[0].length;
config.textPrimitives.cssLookaheadRegExp.lastIndex=w.nextMatch;
_51=config.textPrimitives.cssLookaheadRegExp.exec(w.source);
}
return _50;
},applyCssHelper:function(e,_55){
var t;
for(t=0;t<_55.length;t++){
try{
e.style[_55[t].style]=_55[t].value;
}
catch(ex){
}
}
},enclosedTextHelper:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _58=this.lookaheadRegExp.exec(w.source);
if(_58&&_58.index==w.matchStart){
var _59=_58[1];
if(config.browser.isIE){
_59=_59.replace(/\n/g,"\r");
}
createTiddlyElement(w.output,this.element,null,null,_59);
w.nextMatch=_58.index+_58[0].length;
}
},isExternalLink:function(_5a){
if(store.tiddlerExists(_5a)||store.isShadowTiddler(_5a)){
return false;
}
var _5b=new RegExp(config.textPrimitives.urlPattern,"mg");
if(_5b.exec(_5a)){
return true;
}
if(_5a.indexOf(".")!=-1||_5a.indexOf("\\")!=-1||_5a.indexOf("/")!=-1||_5a.indexOf("#")!=-1){
return true;
}
return false;
}};
config.formatters=[{name:"table",match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookaheadRegExp:/^\|([^\n]*)\|([fhck]?)$/mg,rowTermRegExp:/(\|(?:[fhck]?)$\n?)/mg,cellRegExp:/(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,cellTermRegExp:/((?:\x20*)\|)/mg,rowTypes:{"c":"caption","h":"thead","":"tbody","f":"tfoot"},handler:function(w){
var _5d=createTiddlyElement(w.output,"table",null,"twtable");
var _5e=[];
var _5f=null;
var _60;
var _61=0;
var _62=function(){
jQuery(this).addClass("hoverRow");
};
var _63=function(){
jQuery(this).removeClass("hoverRow");
};
w.nextMatch=w.matchStart;
this.lookaheadRegExp.lastIndex=w.nextMatch;
var _64=this.lookaheadRegExp.exec(w.source);
while(_64&&_64.index==w.nextMatch){
var _65=_64[2];
if(_65=="k"){
_5d.className=_64[1];
w.nextMatch+=_64[0].length+1;
}else{
if(_65!=_5f){
_60=createTiddlyElement(_5d,this.rowTypes[_65]);
_5f=_65;
}
if(_5f=="c"){
w.nextMatch++;
if(_60!=_5d.firstChild){
_5d.insertBefore(_60,_5d.firstChild);
}
_60.setAttribute("align",_61==0?"top":"bottom");
w.subWikifyTerm(_60,this.rowTermRegExp);
}else{
var _66=createTiddlyElement(_60,"tr",null,_61%2?"oddRow":"evenRow");
_66.onmouseover=_62;
_66.onmouseout=_63;
this.rowHandler(w,_66,_5e);
_61++;
}
}
this.lookaheadRegExp.lastIndex=w.nextMatch;
_64=this.lookaheadRegExp.exec(w.source);
}
},rowHandler:function(w,e,_69){
var col=0;
var _6b=1;
var _6c=null;
this.cellRegExp.lastIndex=w.nextMatch;
var _6d=this.cellRegExp.exec(w.source);
while(_6d&&_6d.index==w.nextMatch){
if(_6d[1]=="~"){
var _6e=_69[col];
if(_6e){
_6e.rowSpanCount++;
_6e.element.setAttribute("rowspan",_6e.rowSpanCount);
_6e.element.setAttribute("rowSpan",_6e.rowSpanCount);
_6e.element.valign="center";
if(_6b>1){
_6e.element.setAttribute("colspan",_6b);
_6e.element.setAttribute("colSpan",_6b);
_6b=1;
}
}
w.nextMatch=this.cellRegExp.lastIndex-1;
}else{
if(_6d[1]==">"){
_6b++;
w.nextMatch=this.cellRegExp.lastIndex-1;
}else{
if(_6d[2]){
if(_6c&&_6b>1){
_6c.setAttribute("colspan",_6b);
_6c.setAttribute("colSpan",_6b);
}
w.nextMatch=this.cellRegExp.lastIndex;
break;
}else{
w.nextMatch++;
var _6f=config.formatterHelpers.inlineCssHelper(w);
var _70=false;
var chr=w.source.substr(w.nextMatch,1);
while(chr==" "){
_70=true;
w.nextMatch++;
chr=w.source.substr(w.nextMatch,1);
}
var _72;
if(chr=="!"){
_72=createTiddlyElement(e,"th");
w.nextMatch++;
}else{
_72=createTiddlyElement(e,"td");
}
_6c=_72;
_69[col]={rowSpanCount:1,element:_72};
if(_6b>1){
_72.setAttribute("colspan",_6b);
_72.setAttribute("colSpan",_6b);
_6b=1;
}
config.formatterHelpers.applyCssHelper(_72,_6f);
w.subWikifyTerm(_72,this.cellTermRegExp);
if(w.matchText.substr(w.matchText.length-2,1)==" "){
_72.align=_70?"center":"left";
}else{
if(_70){
_72.align="right";
}
}
w.nextMatch--;
}
}
}
col++;
this.cellRegExp.lastIndex=w.nextMatch;
_6d=this.cellRegExp.exec(w.source);
}
}},{name:"heading",match:"^!{1,6}",termRegExp:/(\n)/mg,handler:function(w){
w.subWikifyTerm(createTiddlyElement(w.output,"h"+w.matchLength),this.termRegExp);
}},{name:"list",match:"^(?:[\\*#;:]+)",lookaheadRegExp:/^(?:(?:(\*)|(#)|(;)|(:))+)/mg,termRegExp:/(\n)/mg,handler:function(w){
var _75=[w.output];
var _76=0,_77=null;
var _78,_79,_7a,_7b;
w.nextMatch=w.matchStart;
this.lookaheadRegExp.lastIndex=w.nextMatch;
var _7c=this.lookaheadRegExp.exec(w.source);
while(_7c&&_7c.index==w.nextMatch){
if(_7c[1]){
_79="ul";
_7a="li";
}else{
if(_7c[2]){
_79="ol";
_7a="li";
}else{
if(_7c[3]){
_79="dl";
_7a="dt";
}else{
if(_7c[4]){
_79="dl";
_7a="dd";
}
}
}
}
if(!_7b){
_7b=_79;
}
_78=_7c[0].length;
w.nextMatch+=_7c[0].length;
var t;
if(_78>_76){
for(t=_76;t<_78;t++){
var _7e=(_76==0)?_75[_75.length-1]:_75[_75.length-1].lastChild;
_75.push(createTiddlyElement(_7e,_79));
}
}else{
if(_79!=_7b&&_78==1){
w.nextMatch-=_7c[0].length;
return;
}else{
if(_78<_76){
for(t=_76;t>_78;t--){
_75.pop();
}
}else{
if(_78==_76&&_79!=_77){
_75.pop();
_75.push(createTiddlyElement(_75[_75.length-1].lastChild,_79));
}
}
}
}
_76=_78;
_77=_79;
var e=createTiddlyElement(_75[_75.length-1],_7a);
w.subWikifyTerm(e,this.termRegExp);
this.lookaheadRegExp.lastIndex=w.nextMatch;
_7c=this.lookaheadRegExp.exec(w.source);
}
}},{name:"quoteByBlock",match:"^<<<\\n",termRegExp:/(^<<<(\n|$))/mg,element:"blockquote",handler:config.formatterHelpers.createElementAndWikify},{name:"quoteByLine",match:"^>+",lookaheadRegExp:/^>+/mg,termRegExp:/(\n)/mg,element:"blockquote",handler:function(w){
var _81=[w.output];
var _82=0;
var _83=w.matchLength;
var t,_85;
do{
if(_83>_82){
for(t=_82;t<_83;t++){
_81.push(createTiddlyElement(_81[_81.length-1],this.element));
}
}else{
if(_83<_82){
for(t=_82;t>_83;t--){
_81.pop();
}
}
}
_82=_83;
w.subWikifyTerm(_81[_81.length-1],this.termRegExp);
createTiddlyElement(_81[_81.length-1],"br");
this.lookaheadRegExp.lastIndex=w.nextMatch;
var _86=this.lookaheadRegExp.exec(w.source);
_85=_86&&_86.index==w.nextMatch;
if(_85){
_83=_86[0].length;
w.nextMatch+=_86[0].length;
}
}while(_85);
}},{name:"rule",match:"^----+$\\n?|<hr ?/?>\\n?",handler:function(w){
createTiddlyElement(w.output,"hr");
}},{name:"monospacedByLine",match:"^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",element:"pre",handler:function(w){
switch(w.matchText){
case "/*{{{*/\n":
this.lookaheadRegExp=/\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
break;
case "{{{\n":
this.lookaheadRegExp=/^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
break;
case "//{{{\n":
this.lookaheadRegExp=/^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
break;
case "<!--{{{-->\n":
this.lookaheadRegExp=/<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
break;
default:
break;
}
config.formatterHelpers.enclosedTextHelper.call(this,w);
}},{name:"wikifyComment",match:"^(?:/\\*\\*\\*|<!---)\\n",handler:function(w){
var _8a=(w.matchText=="/***\n")?(/(^\*\*\*\/\n)/mg):(/(^--->\n)/mg);
w.subWikifyTerm(w.output,_8a);
}},{name:"macro",match:"<<",lookaheadRegExp:/<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _8c=this.lookaheadRegExp.exec(w.source);
if(_8c&&_8c.index==w.matchStart&&_8c[1]){
w.nextMatch=this.lookaheadRegExp.lastIndex;
invokeMacro(w.output,_8c[1],_8c[2],w,w.tiddler);
}
}},{name:"prettyLink",match:"\\[\\[",lookaheadRegExp:/\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _8e=this.lookaheadRegExp.exec(w.source);
if(_8e&&_8e.index==w.matchStart){
var e;
var _90=_8e[1];
if(_8e[3]){
var _91=_8e[3];
e=(!_8e[2]&&config.formatterHelpers.isExternalLink(_91))?createExternalLink(w.output,_91):createTiddlyLink(w.output,_91,false,null,w.isStatic,w.tiddler);
}else{
e=createTiddlyLink(w.output,_90,false,null,w.isStatic,w.tiddler);
}
createTiddlyText(e,_90);
w.nextMatch=this.lookaheadRegExp.lastIndex;
}
}},{name:"wikiLink",match:config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,handler:function(w){
if(w.matchText.substr(0,1)==config.textPrimitives.unWikiLink){
w.outputText(w.output,w.matchStart+1,w.nextMatch);
return;
}
if(w.matchStart>0){
var _93=new RegExp(config.textPrimitives.anyLetterStrict,"mg");
_93.lastIndex=w.matchStart-1;
var _94=_93.exec(w.source);
if(_94.index==w.matchStart-1){
w.outputText(w.output,w.matchStart,w.nextMatch);
return;
}
}
if(w.autoLinkWikiWords||store.isShadowTiddler(w.matchText)){
var _95=createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
w.outputText(_95,w.matchStart,w.nextMatch);
}else{
w.outputText(w.output,w.matchStart,w.nextMatch);
}
}},{name:"urlLink",match:config.textPrimitives.urlPattern,handler:function(w){
w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
}},{name:"image",match:"\\[[<>]?[Ii][Mm][Gg]\\[",lookaheadRegExp:/\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _98=this.lookaheadRegExp.exec(w.source);
if(_98&&_98.index==w.matchStart){
var e=w.output;
if(_98[5]){
var _9a=_98[5];
e=config.formatterHelpers.isExternalLink(_9a)?createExternalLink(w.output,_9a):createTiddlyLink(w.output,_9a,false,null,w.isStatic,w.tiddler);
jQuery(e).addClass("imageLink");
}
var img=createTiddlyElement(e,"img");
if(_98[1]){
img.align="left";
}else{
if(_98[2]){
img.align="right";
}
}
if(_98[3]){
img.title=_98[3];
img.setAttribute("alt",_98[3]);
}
img.src=_98[4];
w.nextMatch=this.lookaheadRegExp.lastIndex;
}
}},{name:"html",match:"<[Hh][Tt][Mm][Ll]>",lookaheadRegExp:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _9d=this.lookaheadRegExp.exec(w.source);
if(_9d&&_9d.index==w.matchStart){
createTiddlyElement(w.output,"span").innerHTML=_9d[1];
w.nextMatch=this.lookaheadRegExp.lastIndex;
}
}},{name:"commentByBlock",match:"/%",lookaheadRegExp:/\/%((?:.|\n)*?)%\//mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _9f=this.lookaheadRegExp.exec(w.source);
if(_9f&&_9f.index==w.matchStart){
w.nextMatch=this.lookaheadRegExp.lastIndex;
}
}},{name:"characterFormat",match:"''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",handler:function(w){
switch(w.matchText){
case "''":
w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
break;
case "//":
w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
break;
case "__":
w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
break;
case "^^":
w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
break;
case "~~":
w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
break;
case "--":
w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
break;
case "{{{":
var _a1=/\{\{\{((?:.|\n)*?)\}\}\}/mg;
_a1.lastIndex=w.matchStart;
var _a2=_a1.exec(w.source);
if(_a2&&_a2.index==w.matchStart){
createTiddlyElement(w.output,"code",null,null,_a2[1]);
w.nextMatch=_a1.lastIndex;
}
break;
}
}},{name:"customFormat",match:"@@|\\{\\{",handler:function(w){
switch(w.matchText){
case "@@":
var e=createTiddlyElement(w.output,"span");
var _a5=config.formatterHelpers.inlineCssHelper(w);
if(_a5.length==0){
e.className="marked";
}else{
config.formatterHelpers.applyCssHelper(e,_a5);
}
w.subWikifyTerm(e,/(@@)/mg);
break;
case "{{":
var _a6=/\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
_a6.lastIndex=w.matchStart;
var _a7=_a6.exec(w.source);
if(_a7){
w.nextMatch=_a6.lastIndex;
e=createTiddlyElement(w.output,_a7[2]=="\n"?"div":"span",null,_a7[1]);
w.subWikifyTerm(e,/(\}\}\})/mg);
}
break;
}
}},{name:"mdash",match:"--",handler:function(w){
createTiddlyElement(w.output,"span").innerHTML="&mdash;";
}},{name:"lineBreak",match:"\\n|<br ?/?>",handler:function(w){
createTiddlyElement(w.output,"br");
}},{name:"rawText",match:"\"{3}|<nowiki>",lookaheadRegExp:/(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _ab=this.lookaheadRegExp.exec(w.source);
if(_ab&&_ab.index==w.matchStart){
createTiddlyElement(w.output,"span",null,null,_ab[1]);
w.nextMatch=this.lookaheadRegExp.lastIndex;
}
}},{name:"htmlEntitiesEncoding",match:"(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",handler:function(w){
createTiddlyElement(w.output,"span").innerHTML=w.matchText;
}}];
function getParser(_ad,_ae){
if(_ad){
if(!_ae){
_ae=_ad.fields["wikiformat"];
}
var i;
if(_ae){
for(i in config.parsers){
if(_ae==config.parsers[i].format){
return config.parsers[i];
}
}
}else{
for(i in config.parsers){
if(_ad.isTagged(config.parsers[i].formatTag)){
return config.parsers[i];
}
}
}
}
return formatter;
}
function Wikifier(_b0,_b1,_b2,_b3){
this.source=_b0;
this.output=null;
this.formatter=_b1;
this.nextMatch=0;
this.autoLinkWikiWords=_b3&&_b3.autoLinkWikiWords()==false?false:true;
this.highlightRegExp=_b2;
this.highlightMatch=null;
this.isStatic=false;
if(_b2){
_b2.lastIndex=0;
this.highlightMatch=_b2.exec(_b0);
}
this.tiddler=_b3;
}
Wikifier.prototype.wikifyPlain=function(){
var e=createTiddlyElement(document.body,"div");
e.style.display="none";
this.subWikify(e);
var _b5=jQuery(e).text();
jQuery(e).remove();
return _b5;
};
Wikifier.prototype.subWikify=function(_b6,_b7){
try{
if(_b7){
this.subWikifyTerm(_b6,new RegExp("("+_b7+")","mg"));
}else{
this.subWikifyUnterm(_b6);
}
}
catch(ex){
showException(ex);
}
};
Wikifier.prototype.subWikifyUnterm=function(_b8){
var _b9=this.output;
this.output=_b8;
this.formatter.formatterRegExp.lastIndex=this.nextMatch;
var _ba=this.formatter.formatterRegExp.exec(this.source);
while(_ba){
if(_ba.index>this.nextMatch){
this.outputText(this.output,this.nextMatch,_ba.index);
}
this.matchStart=_ba.index;
this.matchLength=_ba[0].length;
this.matchText=_ba[0];
this.nextMatch=this.formatter.formatterRegExp.lastIndex;
var t;
for(t=1;t<_ba.length;t++){
if(_ba[t]){
this.formatter.formatters[t-1].handler(this);
this.formatter.formatterRegExp.lastIndex=this.nextMatch;
break;
}
}
_ba=this.formatter.formatterRegExp.exec(this.source);
}
if(this.nextMatch<this.source.length){
this.outputText(this.output,this.nextMatch,this.source.length);
this.nextMatch=this.source.length;
}
this.output=_b9;
};
Wikifier.prototype.subWikifyTerm=function(_bc,_bd){
var _be=this.output;
this.output=_bc;
_bd.lastIndex=this.nextMatch;
var _bf=_bd.exec(this.source);
this.formatter.formatterRegExp.lastIndex=this.nextMatch;
var _c0=this.formatter.formatterRegExp.exec(_bf?this.source.substr(0,_bf.index):this.source);
while(_bf||_c0){
if(_bf&&(!_c0||_bf.index<=_c0.index)){
if(_bf.index>this.nextMatch){
this.outputText(this.output,this.nextMatch,_bf.index);
}
this.matchText=_bf[1];
this.matchLength=_bf[1].length;
this.matchStart=_bf.index;
this.nextMatch=this.matchStart+this.matchLength;
this.output=_be;
return;
}
if(_c0.index>this.nextMatch){
this.outputText(this.output,this.nextMatch,_c0.index);
}
this.matchStart=_c0.index;
this.matchLength=_c0[0].length;
this.matchText=_c0[0];
this.nextMatch=this.formatter.formatterRegExp.lastIndex;
var t;
for(t=1;t<_c0.length;t++){
if(_c0[t]){
this.formatter.formatters[t-1].handler(this);
this.formatter.formatterRegExp.lastIndex=this.nextMatch;
break;
}
}
_bd.lastIndex=this.nextMatch;
_bf=_bd.exec(this.source);
_c0=this.formatter.formatterRegExp.exec(_bf?this.source.substr(0,_bf.index):this.source);
}
if(this.nextMatch<this.source.length){
this.outputText(this.output,this.nextMatch,this.source.length);
this.nextMatch=this.source.length;
}
this.output=_be;
};
Wikifier.prototype.outputText=function(_c2,_c3,_c4){
while(this.highlightMatch&&(this.highlightRegExp.lastIndex>_c3)&&(this.highlightMatch.index<_c4)&&(_c3<_c4)){
if(this.highlightMatch.index>_c3){
createTiddlyText(_c2,this.source.substring(_c3,this.highlightMatch.index));
_c3=this.highlightMatch.index;
}
var _c5=Math.min(this.highlightRegExp.lastIndex,_c4);
createTiddlyElement(_c2,"span",null,"highlight",this.source.substring(_c3,_c5));
_c3=_c5;
if(_c3>=this.highlightRegExp.lastIndex){
this.highlightMatch=this.highlightRegExp.exec(this.source);
}
}
if(_c3<_c4){
createTiddlyText(_c2,this.source.substring(_c3,_c4));
}
};
function wikify(_c6,_c7,_c8,_c9){
if(_c6){
var _ca=new Wikifier(_c6,getParser(_c9),_c8,_c9);
var t0=new Date();
_ca.subWikify(_c7);
if(_c9&&config.options.chkDisplayInstrumentation){
displayMessage("wikify:"+_c9.title+" in "+(new Date()-t0)+" ms");
}
}
}
function wikifyStatic(_cc,_cd,_ce,_cf){
var e=createTiddlyElement(document.body,"pre");
e.style.display="none";
var _d1="";
if(_cc&&_cc!=""){
if(!_ce){
_ce=new Tiddler("temp");
}
var _d2=new Wikifier(_cc,getParser(_ce,_cf),_cd,_ce);
_d2.isStatic=true;
_d2.subWikify(e);
_d1=e.innerHTML;
jQuery(e).remove();
}
return _d1;
}
function wikifyPlainText(_d3,_d4,_d5){
if(_d4>0){
_d3=_d3.substr(0,_d4);
}
var _d6=new Wikifier(_d3,formatter,null,_d5);
return _d6.wikifyPlain();
}
function highlightify(_d7,_d8,_d9,_da){
if(_d7){
var _db=new Wikifier(_d7,formatter,_d9,_da);
_db.outputText(_d8,0,_d7.length);
}
}
function invokeMacro(_dc,_dd,_de,_df,_e0){
try{
var m=config.macros[_dd];
if(m&&m.handler){
var _e2=story.findContainingTiddler(_dc);
window.tiddler=_e2?store.getTiddler(_e2.getAttribute("tiddler")):null;
window.place=_dc;
var _e3=true;
if(config.evaluateMacroParameters=="system"){
if(!_e0||_e0.tags.indexOf("systemAllowEval")==-1){
_e3=false;
}
}
m.handler(_dc,_dd,m.noPreParse?null:_de.readMacroParams(!_e3),_df,_de,_e0);
}else{
createTiddlyError(_dc,config.messages.macroError.format([_dd]),config.messages.macroErrorDetails.format([_dd,config.messages.missingMacro]));
}
}
catch(ex){
createTiddlyError(_dc,config.messages.macroError.format([_dd]),config.messages.macroErrorDetails.format([_dd,ex.toString()]));
}
}
config.macros.version.handler=function(_e4){
jQuery("<span/>").text(formatVersion()).appendTo(_e4);
};
config.macros.today.handler=function(_e5,_e6,_e7){
var now=new Date();
var _e9=_e7[0]?now.formatString(_e7[0].trim()):now.toLocaleString();
jQuery("<span/>").text(_e9).appendTo(_e5);
};
config.macros.list.template="<<view title link>>";
config.macros.list.handler=function(_ea,_eb,_ec,_ed,_ee){
var _ef=document.createElement("ul");
jQuery(_ef).attr({refresh:"macro",macroName:_eb}).data("params",_ee);
_ea.appendChild(_ef);
this.refresh(_ef);
};
config.macros.list.refresh=function(_f0){
var _f1=jQuery(_f0).data("params");
var _f2=_f1.readMacroParams();
var _f3=_f1.parseParams("anon",null,null)[0];
var _f4=_f3.anon?_f3.anon[0]:"all";
jQuery(_f0).empty().addClass("list list-"+_f4);
var _f5=_f3.template?store.getTiddlerText(_f3.template[0]):false;
if(!_f5){
_f5=config.macros.list.template;
}
if(this[_f4].prompt){
createTiddlyElement(_f0,"li",null,"listTitle",this[_f4].prompt);
}
var _f6;
if(this[_f4].handler){
_f6=this[_f4].handler(_f2);
}
var t;
for(t=0;t<_f6.length;t++){
var li=document.createElement("li");
_f0.appendChild(li);
var _f9=_f6[t];
if(typeof (_f9)=="string"){
_f9=store.getTiddler(_f9)||new Tiddler(_f9);
}
wikify(_f5,li,null,_f9);
}
if(_f6.length===0&&_f3.emptyMessage){
jQuery(_f0).addClass("emptyList");
jQuery("<li />").text(_f3.emptyMessage[0]).appendTo(_f0);
}
};
config.macros.list.all.handler=function(_fa){
return store.reverseLookup("tags","excludeLists",false,"title");
};
config.macros.list.missing.handler=function(_fb){
return store.getMissingLinks();
};
config.macros.list.orphans.handler=function(_fc){
return store.getOrphans();
};
config.macros.list.shadowed.handler=function(_fd){
return store.getShadowed();
};
config.macros.list.touched.handler=function(_fe){
return store.getTouched();
};
config.macros.list.filter.handler=function(_ff){
var _100=_ff[1];
var _101=[];
if(_100){
var _102=store.filterTiddlers(_100);
var t;
for(t=0;t<_102.length;t++){
_101.push(_102[t].title);
}
}
return _101;
};
config.macros.allTags.handler=function(_104,_105,_106){
var tags=store.getTags(_106[0]);
var ul=createTiddlyElement(_104,"ul");
if(tags.length==0){
createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
}
var t;
for(t=0;t<tags.length;t++){
var _10a=tags[t][0];
var info=getTiddlyLinkInfo(_10a);
var li=createTiddlyElement(ul,"li");
var btn=createTiddlyButton(li,_10a+" ("+tags[t][1]+")",this.tooltip.format([_10a]),onClickTag,info.classes);
btn.setAttribute("tag",_10a);
btn.setAttribute("refresh","link");
btn.setAttribute("tiddlyLink",_10a);
if(_106[1]){
btn.setAttribute("sortby",_106[1]);
}
}
};
var macro=config.macros.timeline;
merge(macro,{handler:function(_10e,_10f,_110,_111,_112,_113){
var _114=jQuery("<div />").attr("params",_112).attr("macroName",_10f).appendTo(_10e)[0];
macro.refresh(_114);
},refresh:function(_115){
jQuery(_115).attr("refresh","macro").empty();
var _116=jQuery(_115).attr("params");
var args=_116.parseParams("anon",null,null)[0];
var _118=args.anon||[];
var _119=_118[0]||"modified";
var _11a=_119.charAt(0);
var _11b=_11a==="-"||_11a==="+"?_119.substr(1,_119.length):_119;
var _11c=_118[2]||this.dateFormat;
var _11d=macro.groupTemplate.format(_11b,_11c);
_11d=args.groupTemplate?store.getTiddlerText(args.groupTemplate[0])||_11d:_11d;
var _11e=macro.itemTemplate;
_11e=args.template?store.getTiddlerText(args.template[0])||_11e:_11e;
var _11f=args.filter?store.sortTiddlers(store.filterTiddlers(args.filter[0]),_119):store.reverseLookup("tags","excludeLists",false,_119);
var _120="",ul;
var last=_118[1]?_11f.length-Math.min(_11f.length,parseInt(_118[1],10)):0;
var t;
for(t=_11f.length-1;t>=last;t--){
var _124=_11f[t];
var _125=wikifyPlainText(_11d,0,_124);
if(typeof (ul)=="undefined"||_125!=_120){
ul=document.createElement("ul");
jQuery(ul).addClass("timeline");
_115.appendChild(ul);
createTiddlyElement(ul,"li",null,"listTitle",_125);
_120=_125;
}
var item=createTiddlyElement(ul,"li",null,"listLink");
wikify(_11e,item,null,_124);
}
},groupTemplate:"<<view %0 date '%1'>>",itemTemplate:"<<view title link>>"});
config.macros.tiddler.handler=function(_127,_128,_129,_12a,_12b,_12c){
var _12d=true;
var _12e=config.macros.tiddler.tiddlerStack;
if(_12e.length>0&&config.evaluateMacroParameters=="system"){
var _12f=_12e[_12e.length-1];
var pos=_12f.indexOf(config.textPrimitives.sectionSeparator);
if(pos!=-1){
_12f=_12f.substr(0,pos);
}
var t=store.getTiddler(_12f);
if(!t||t.tags.indexOf("systemAllowEval")==-1){
_12d=false;
}
}
_129=_12b.parseParams("name",null,_12d,false,true);
var _132=_129[0]["name"];
var _133=_132[0];
var _134=_132[1]||null;
var args=_129[0]["with"];
var _136=createTiddlyElement(_127,"span",null,_134,null,{refresh:"content",tiddler:_133});
if(args!==undefined){
_136.setAttribute("args","[["+args.join("]] [[")+"]]");
}
this.transclude(_136,_133,args);
};
config.macros.tiddler.transclude=function(_137,_138,args){
var text=store.getTiddlerText(_138);
if(!text){
return;
}
var _13b=config.macros.tiddler.tiddlerStack;
if(_13b.indexOf(_138)!==-1){
return;
}
_13b.push(_138);
try{
if(typeof args=="string"){
args=args.readBracketedList();
}
var n=args?Math.min(args.length,9):0;
var i;
for(i=0;i<n;i++){
var _13e=new RegExp("\\$"+(i+1),"mg");
text=text.replace(_13e,args[i]);
}
config.macros.tiddler.renderText(_137,text,_138);
}
finally{
_13b.pop();
}
};
config.macros.tiddler.renderText=function(_13f,text,_141){
wikify(text,_13f,null,store.getTiddler(_141));
};
config.macros.tiddler.tiddlerStack=[];
config.macros.tag.handler=function(_142,_143,_144){
var btn=createTagButton(_142,_144[0],null,_144[1],_144[2]);
if(_144[3]){
btn.setAttribute("sortby",_144[3]);
}
};
config.macros.tags.handler=function(_146,_147,_148,_149,_14a,_14b){
_148=_14a.parseParams("anon",null,true,false,false);
var ul=createTiddlyElement(_146,"ul");
var _14d=getParam(_148,"anon","");
if(_14d&&store.tiddlerExists(_14d)){
_14b=store.getTiddler(_14d);
}
var sep=getParam(_148,"sep"," ");
var _14f=config.views.wikified.tag;
var _150=null;
var t;
for(t=0;t<_14b.tags.length;t++){
var tag=store.getTiddler(_14b.tags[t]);
if(!tag||!tag.tags.contains("excludeLists")){
if(!_150){
_150=createTiddlyElement(ul,"li",null,"listTitle",_14f.labelTags.format([_14b.title]));
}
createTagButton(createTiddlyElement(ul,"li"),_14b.tags[t],_14b.title);
if(t<_14b.tags.length-1){
createTiddlyText(ul,sep);
}
}
}
if(!_150){
createTiddlyElement(ul,"li",null,"listTitle",_14f.labelNoTags.format([_14b.title]));
}
};
config.macros.tagging.handler=function(_153,_154,_155,_156,_157,_158){
_155=_157.parseParams("anon",null,true,false,false);
var ul=createTiddlyElement(_153,"ul");
var _15a=getParam(_155,"anon","");
if(_15a==""&&_158 instanceof Tiddler){
_15a=_158.title;
}
var sep=getParam(_155,"sep"," ");
ul.setAttribute("title",this.tooltip.format([_15a]));
var _15c=getParam(_155,"sortBy",false);
var _15d=store.getTaggedTiddlers(_15a,_15c);
var _15e=_15d.length==0?this.labelNotTag:this.label;
createTiddlyElement(ul,"li",null,"listTitle",_15e.format([_15a,_15d.length]));
var t;
for(t=0;t<_15d.length;t++){
createTiddlyLink(createTiddlyElement(ul,"li"),_15d[t].title,true);
if(t<_15d.length-1){
createTiddlyText(ul,sep);
}
}
};
config.macros.closeAll.handler=function(_160){
createTiddlyButton(_160,this.label,this.prompt,this.onClick);
};
config.macros.closeAll.onClick=function(e){
story.closeAllTiddlers();
return false;
};
config.macros.permaview.handler=function(_162){
createTiddlyButton(_162,this.label,this.prompt,this.onClick);
};
config.macros.permaview.onClick=function(e){
story.permaView();
return false;
};
config.macros.saveChanges.handler=function(_164,_165,_166){
if(!readOnly){
createTiddlyButton(_164,_166[0]||this.label,_166[1]||this.prompt,this.onClick,null,null,this.accessKey);
}
};
config.macros.saveChanges.onClick=function(e){
saveChanges();
return false;
};
config.macros.slider.onClickSlider=function(ev){
var n=this.nextSibling;
var _16a=n.getAttribute("cookie");
var _16b=n.style.display!="none";
if(config.options.chkAnimate&&anim&&typeof Slider=="function"){
anim.startAnimating(new Slider(n,!_16b,null,"none"));
}else{
n.style.display=_16b?"none":"block";
}
config.options[_16a]=!_16b;
saveOption(_16a);
return false;
};
config.macros.slider.createSlider=function(_16c,_16d,_16e,_16f){
var c=_16d||"";
createTiddlyButton(_16c,_16e,_16f,this.onClickSlider);
var _171=createTiddlyElement(null,"div",null,"sliderPanel");
_171.setAttribute("cookie",c);
_171.style.display=config.options[c]?"block":"none";
_16c.appendChild(_171);
return _171;
};
config.macros.slider.handler=function(_172,_173,_174){
var _175=this.createSlider(_172,_174[0],_174[2],_174[3]);
var text=store.getTiddlerText(_174[1]);
_175.setAttribute("refresh","content");
_175.setAttribute("tiddler",_174[1]);
if(text){
wikify(text,_175,null,store.getTiddler(_174[1]));
}
};
config.macros.gradient.handler=function(_177,_178,_179,_17a,_17b,_17c){
var _17d=_17a?createTiddlyElement(_177,"div",null,"gradient"):_177;
_17d.style.position="relative";
_17d.style.overflow="hidden";
_17d.style.zIndex="0";
if(_17a){
var _17e=config.formatterHelpers.inlineCssHelper(_17a);
config.formatterHelpers.applyCssHelper(_17d,_17e);
}
_179=_17b.parseParams("color");
var _17f=[],_180=[];
var t;
for(t=2;t<_179.length;t++){
var c=_179[t].value;
if(_179[t].name=="snap"){
_180[_180.length-1]=c;
}else{
_17f.push(c);
_180.push(c);
}
}
drawGradient(_17d,_179[1].value!="vert",_17f,_180);
if(_17a){
_17a.subWikify(_17d,">>");
}
if(document.all){
_17d.style.height="100%";
_17d.style.width="100%";
}
};
config.macros.message.handler=function(_183,_184,_185){
if(_185[0]){
var _186=_185[0].split(".");
var _187=function(root,_189){
if(root[_186[_189]]){
if(_189<_186.length-1){
return (_187(root[_186[_189]],_189+1));
}else{
return root[_186[_189]];
}
}else{
return null;
}
};
var m=_187(config,0);
if(m==null){
m=_187(window,0);
}
createTiddlyText(_183,m.toString().format(_185.splice(1)));
}
};
config.macros.view.depth=0;
config.macros.view.values=[];
config.macros.view.views={text:function(_18b,_18c,_18d,_18e,_18f,_190){
highlightify(_18b,_18c,highlightHack,_190);
},link:function(_191,_192,_193,_194,_195,_196){
createTiddlyLink(_192,_191,true);
},wikified:function(_197,_198,_199,_19a,_19b,_19c){
if(config.macros.view.depth>50){
return;
}
if(config.macros.view.depth>0){
if(_197==config.macros.view.values[config.macros.view.depth-1]){
return;
}
}
config.macros.view.values[config.macros.view.depth]=_197;
config.macros.view.depth++;
if(_199[2]){
_197=_199[2].unescapeLineBreaks().format([_197]);
}
wikify(_197,_198,highlightHack,_19c);
config.macros.view.depth--;
config.macros.view.values[config.macros.view.depth]=null;
},date:function(_19d,_19e,_19f,_1a0,_1a1,_1a2){
_19d=Date.convertFromYYYYMMDDHHMM(_19d);
createTiddlyText(_19e,_19d.formatString(_19f[2]||config.views.wikified.dateFormat));
}};
config.macros.view.handler=function(_1a3,_1a4,_1a5,_1a6,_1a7,_1a8){
if((_1a8 instanceof Tiddler)&&_1a5[0]){
var _1a9=store.getValue(_1a8,_1a5[0]);
if(_1a9){
var type=_1a5[1]||config.macros.view.defaultView;
var _1ab=config.macros.view.views[type];
if(_1ab){
_1ab(_1a9,_1a3,_1a5,_1a6,_1a7,_1a8);
}
}
}
};
config.macros.edit.handler=function(_1ac,_1ad,_1ae,_1af,_1b0,_1b1){
var _1b2=_1ae[0];
var rows=_1ae[1]||0;
var _1b4=_1ae[2]||"";
if((_1b1 instanceof Tiddler)&&_1b2){
story.setDirty(_1b1.title,true);
var e,v;
if(_1b2!="text"&&!rows){
e=createTiddlyElement(null,"input",null,null,null,{type:"text",edit:_1b2,size:"40",autocomplete:"off"});
e.value=store.getValue(_1b1,_1b2)||_1b4;
_1ac.appendChild(e);
}else{
var _1b7=createTiddlyElement(null,"fieldset",null,"fieldsetFix");
var _1b8=createTiddlyElement(_1b7,"div");
e=createTiddlyElement(_1b8,"textarea");
e.value=v=store.getValue(_1b1,_1b2)||_1b4;
rows=rows||10;
var _1b9=v.match(/\n/mg);
var _1ba=Math.max(parseInt(config.options.txtMaxEditRows,10),5);
if(_1b9!=null&&_1b9.length>rows){
rows=_1b9.length+5;
}
rows=Math.min(rows,_1ba);
e.setAttribute("rows",rows);
e.setAttribute("edit",_1b2);
_1ac.appendChild(_1b7);
}
if(_1b1.isReadOnly()){
e.setAttribute("readOnly","readOnly");
jQuery(e).addClass("readOnly");
}
return e;
}
};
config.macros.tagChooser.onClick=function(ev){
var e=ev||window.event;
var _1bd=config.views.editor.tagChooser;
var _1be=Popup.create(this);
var tags=store.getTags(this.getAttribute("tags"));
if(tags.length==0){
jQuery("<li/>").text(_1bd.popupNone).appendTo(_1be);
}
var t;
for(t=0;t<tags.length;t++){
var tag=createTiddlyButton(createTiddlyElement(_1be,"li"),tags[t][0],_1bd.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
tag.setAttribute("tag",tags[t][0]);
tag.setAttribute("tiddler",this.getAttribute("tiddler"));
}
Popup.show();
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
return false;
};
config.macros.tagChooser.onTagClick=function(ev){
var e=ev||window.event;
if(e.metaKey||e.ctrlKey){
stopEvent(e);
}
var tag=this.getAttribute("tag");
var _1c5=this.getAttribute("tiddler");
if(!readOnly){
story.setTiddlerTag(_1c5,tag,0);
}
return false;
};
config.macros.tagChooser.handler=function(_1c6,_1c7,_1c8,_1c9,_1ca,_1cb){
if(_1cb instanceof Tiddler){
var _1cc=config.views.editor.tagChooser;
var btn=createTiddlyButton(_1c6,_1cc.text,_1cc.tooltip,this.onClick);
btn.setAttribute("tiddler",_1cb.title);
btn.setAttribute("tags",_1c8[0]);
}
};
config.macros.refreshDisplay.handler=function(_1ce){
createTiddlyButton(_1ce,this.label,this.prompt,this.onClick);
};
config.macros.refreshDisplay.onClick=function(e){
refreshAll();
return false;
};
config.macros.annotations.handler=function(_1d0,_1d1,_1d2,_1d3,_1d4,_1d5){
var _1d6=_1d5?_1d5.title:null;
var a=_1d6?config.annotations[_1d6]:null;
if(!_1d5||!_1d6||!a){
return;
}
var text=a.format([_1d6]);
wikify(text,createTiddlyElement(_1d0,"div",null,"annotation"),null,_1d5);
};
config.macros.newTiddler.createNewTiddlerButton=function(_1d9,_1da,_1db,_1dc,_1dd,_1de,_1df,_1e0){
var tags=[];
var t;
for(t=1;t<_1db.length;t++){
if((_1db[t].name=="anon"&&t!=1)||(_1db[t].name=="tag")){
tags.push(_1db[t].value);
}
}
_1dc=getParam(_1db,"label",_1dc);
_1dd=getParam(_1db,"prompt",_1dd);
_1de=getParam(_1db,"accessKey",_1de);
_1df=getParam(_1db,"focus",_1df);
var _1e3=getParam(_1db,"fields","");
if(!_1e3&&!store.isShadowTiddler(_1da)){
_1e3=String.encodeHashMap(config.defaultCustomFields);
}
var btn=createTiddlyButton(_1d9,_1dc,_1dd,this.onClickNewTiddler,null,null,_1de);
btn.setAttribute("newTitle",_1da);
btn.setAttribute("isJournal",_1e0?"true":"false");
if(tags.length>0){
btn.setAttribute("params",tags.join("|"));
}
btn.setAttribute("newFocus",_1df);
btn.setAttribute("newTemplate",getParam(_1db,"template",DEFAULT_EDIT_TEMPLATE));
if(_1e3!==""){
btn.setAttribute("customFields",_1e3);
}
var text=getParam(_1db,"text");
if(text!==undefined){
btn.setAttribute("newText",text);
}
return btn;
};
config.macros.newTiddler.onClickNewTiddler=function(){
var _1e6=this.getAttribute("newTitle");
if(this.getAttribute("isJournal")=="true"){
_1e6=new Date().formatString(_1e6.trim());
}
var _1e7=this.getAttribute("params");
var tags=_1e7?_1e7.split("|"):[];
var _1e9=this.getAttribute("newFocus");
var _1ea=this.getAttribute("newTemplate");
var _1eb=this.getAttribute("customFields");
if(!_1eb&&!store.isShadowTiddler(_1e6)){
_1eb=String.encodeHashMap(config.defaultCustomFields);
}
story.displayTiddler(null,_1e6,_1ea,false,null,null);
var _1ec=story.getTiddler(_1e6);
if(_1eb){
story.addCustomFields(_1ec,_1eb);
}
var text=this.getAttribute("newText");
if(typeof text=="string"&&story.getTiddlerField(_1e6,"text")){
story.getTiddlerField(_1e6,"text").value=text.format([_1e6]);
}
var t;
for(t=0;t<tags.length;t++){
story.setTiddlerTag(_1e6,tags[t],+1);
}
story.focusTiddler(_1e6,_1e9);
return false;
};
config.macros.newTiddler.handler=function(_1ef,_1f0,_1f1,_1f2,_1f3){
if(!readOnly){
_1f1=_1f3.parseParams("anon",null,true,false,false);
var _1f4=_1f1[1]&&_1f1[1].name=="anon"?_1f1[1].value:this.title;
_1f4=getParam(_1f1,"title",_1f4);
this.createNewTiddlerButton(_1ef,_1f4,_1f1,this.label,this.prompt,this.accessKey,"title",false);
}
};
config.macros.newJournal.handler=function(_1f5,_1f6,_1f7,_1f8,_1f9){
if(!readOnly){
_1f7=_1f9.parseParams("anon",null,true,false,false);
var _1fa=_1f7[1]&&_1f7[1].name=="anon"?_1f7[1].value:config.macros.timeline.dateFormat;
_1fa=getParam(_1f7,"title",_1fa);
config.macros.newTiddler.createNewTiddlerButton(_1f5,_1fa,_1f7,this.label,this.prompt,this.accessKey,"text",true);
}
};
config.macros.search.handler=function(_1fb,_1fc,_1fd,_1fe,_1ff,_200){
_1fd=_1ff.parseParams("anon",null,false,false,false);
createTiddlyButton(_1fb,this.label,this.prompt,this.onClick,"searchButton");
var txt=createTiddlyElement(null,"input",null,"txtOptionInput searchField");
txt.value=getParam(_1fd,"anon","");
if(config.browser.isSafari){
txt.setAttribute("type","search");
txt.setAttribute("results","5");
}else{
txt.setAttribute("type","text");
}
_1fb.appendChild(txt);
txt.onkeyup=this.onKeyPress;
txt.onfocus=this.onFocus;
txt.setAttribute("size",this.sizeTextbox);
txt.setAttribute("accessKey",getParam(_1fd,"accesskey",this.accessKey));
txt.setAttribute("autocomplete","off");
txt.setAttribute("lastSearchText","");
txt.setAttribute("placeholder",getParam(_1fd,"placeholder",this.placeholder));
};
config.macros.search.timeout=null;
config.macros.search.doSearch=function(txt){
if(txt.value.length>0){
story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
txt.setAttribute("lastSearchText",txt.value);
}
};
config.macros.search.onClick=function(e){
config.macros.search.doSearch(this.nextSibling);
return false;
};
config.macros.search.onKeyPress=function(ev){
var me=config.macros.search;
var e=ev||window.event;
switch(e.keyCode){
case 9:
return;
case 13:
case 10:
me.doSearch(this);
break;
case 27:
this.value="";
clearMessage();
break;
}
if(config.options.chkIncrementalSearch){
if(this.value.length>2){
if(this.value!=this.getAttribute("lastSearchText")){
if(me.timeout){
clearTimeout(me.timeout);
}
var txt=this;
me.timeout=setTimeout(function(){
me.doSearch(txt);
},500);
}
}else{
if(me.timeout){
clearTimeout(me.timeout);
}
}
}
};
config.macros.search.onFocus=function(e){
this.select();
};
config.macros.tabs.handler=function(_209,_20a,_20b){
var _20c=_20b[0];
var _20d=(_20b.length-1)/3;
var _20e=createTiddlyElement(null,"div",null,"tabsetWrapper "+_20c);
var _20f=createTiddlyElement(_20e,"div",null,"tabset");
_20f.setAttribute("cookie",_20c);
var _210=false;
var t;
for(t=0;t<_20d;t++){
var _212=_20b[t*3+1];
var _213=_20b[t*3+2];
var _214=_20b[t*3+3];
var tab=createTiddlyButton(_20f,_212,_213,this.onClickTab,"tab tabUnselected");
createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
tab.setAttribute("tab",_212);
tab.setAttribute("content",_214);
tab.title=_213;
if(config.options[_20c]==_212){
_210=true;
}
}
if(!_210){
config.options[_20c]=_20b[1];
}
_209.appendChild(_20e);
this.switchTab(_20f,config.options[_20c]);
};
config.macros.tabs.onClickTab=function(e){
config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
return false;
};
config.macros.tabs.switchTab=function(_217,tab){
var _219=_217.getAttribute("cookie");
var _21a=null;
var _21b=_217.childNodes;
var t;
for(t=0;t<_21b.length;t++){
if(_21b[t].getAttribute&&_21b[t].getAttribute("tab")==tab){
_21a=_21b[t];
_21a.className="tab tabSelected";
}else{
_21b[t].className="tab tabUnselected";
}
}
if(_21a){
if(_217.nextSibling&&_217.nextSibling.className=="tabContents"){
jQuery(_217.nextSibling).remove();
}
var _21d=createTiddlyElement(null,"div",null,"tabContents");
_217.parentNode.insertBefore(_21d,_217.nextSibling);
var _21e=_21a.getAttribute("content");
wikify(store.getTiddlerText(_21e),_21d,null,store.getTiddler(_21e));
if(_219){
config.options[_219]=tab;
saveOption(_219);
}
}
};
config.macros.toolbar.createCommand=function(_21f,_220,_221,_222){
if(typeof _220!="string"){
var c=null;
var t;
for(t in config.commands){
if(config.commands[t]==_220){
c=t;
}
}
_220=c;
}
if((_221 instanceof Tiddler)&&(typeof _220=="string")){
var _225=config.commands[_220];
if(_225.isEnabled?_225.isEnabled(_221):this.isCommandEnabled(_225,_221)){
var text=_225.getText?_225.getText(_221):this.getCommandText(_225,_221);
var _227=_225.getTooltip?_225.getTooltip(_221):this.getCommandTooltip(_225,_221);
var cmd=_225.type=="popup"?this.onClickPopup:this.onClickCommand;
var btn=createTiddlyButton(null,text,_227,cmd);
btn.setAttribute("commandName",_220);
btn.setAttribute("tiddler",_221.title);
jQuery(btn).addClass("command_"+_220);
if(_222){
jQuery(btn).addClass(_222);
}
_21f.appendChild(btn);
}
}
};
config.macros.toolbar.isCommandEnabled=function(_22a,_22b){
var _22c=_22b.title;
var ro=_22b.isReadOnly();
var _22e=store.isShadowTiddler(_22c)&&!store.tiddlerExists(_22c);
return (!ro||(ro&&!_22a.hideReadOnly))&&!(_22e&&_22a.hideShadow);
};
config.macros.toolbar.getCommandText=function(_22f,_230){
return (_230.isReadOnly()&&_22f.readOnlyText)||_22f.text;
};
config.macros.toolbar.getCommandTooltip=function(_231,_232){
return (_232.isReadOnly()&&_231.readOnlyTooltip)||_231.tooltip;
};
config.macros.toolbar.onClickCommand=function(ev){
var e=ev||window.event;
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
var _235=config.commands[this.getAttribute("commandName")];
return _235.handler(e,this,this.getAttribute("tiddler"));
};
config.macros.toolbar.onClickPopup=function(ev){
var e=ev||window.event;
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
var _238=Popup.create(this);
var _239=config.commands[this.getAttribute("commandName")];
var _23a=this.getAttribute("tiddler");
_238.setAttribute("tiddler",_23a);
_239.handlePopup(_238,_23a);
Popup.show();
return false;
};
config.macros.toolbar.invokeCommand=function(_23b,_23c,_23d){
var _23e=_23b.getElementsByTagName("a");
var t;
for(t=0;t<_23e.length;t++){
var c=_23e[t];
if(jQuery(c).hasClass(_23c)&&c.getAttribute&&c.getAttribute("commandName")){
if(c.onclick instanceof Function){
c.onclick.call(c,_23d);
}
break;
}
}
};
config.macros.toolbar.onClickMore=function(ev){
var e=this.nextSibling;
e.style.display="inline";
this.style.display="none";
return false;
};
config.macros.toolbar.onClickLess=function(ev){
var e=this.parentNode;
var m=e.previousSibling;
e.style.display="none";
m.style.display="inline";
return false;
};
config.macros.toolbar.handler=function(_246,_247,_248,_249,_24a,_24b){
var t;
for(t=0;t<_248.length;t++){
var btn;
var c=_248[t];
switch(c){
case "!":
createTiddlyText(_246,this.separator);
break;
case "*":
createTiddlyElement(_246,"br");
break;
case "<":
btn=createTiddlyButton(_246,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
jQuery(btn).addClass("lessCommand");
break;
case ">":
btn=createTiddlyButton(_246,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
jQuery(btn).addClass("moreCommand");
var e=createTiddlyElement(_246,"span",null,"moreCommand");
e.style.display="none";
_246=e;
break;
default:
var _250="";
switch(c.substr(0,1)){
case "+":
_250="defaultCommand";
c=c.substr(1);
break;
case "-":
_250="cancelCommand";
c=c.substr(1);
break;
}
if(config.commands[c]){
this.createCommand(_246,c,_24b,_250);
}else{
this.customCommand(_246,c,_249,_24b);
}
break;
}
}
};
config.macros.toolbar.customCommand=function(_251,_252,_253,_254){
};
config.commands.closeTiddler.handler=function(_255,src,_257){
if(story.isDirty(_257)&&!readOnly){
if(!confirm(config.commands.cancelTiddler.warning.format([_257]))){
return false;
}
}
story.setDirty(_257,false);
story.closeTiddler(_257,true);
return false;
};
config.commands.closeOthers.handler=function(_258,src,_25a){
story.closeAllTiddlers(_25a);
return false;
};
config.commands.editTiddler.handler=function(_25b,src,_25d){
clearMessage();
var _25e=story.getTiddler(_25d);
var _25f=_25e.getAttribute("tiddlyFields");
story.displayTiddler(null,_25d,DEFAULT_EDIT_TEMPLATE,false,null,_25f);
var e=story.getTiddlerField(_25d,config.options.txtEditorFocus||"text");
if(e){
setCaretPosition(e,0);
}
return false;
};
config.commands.saveTiddler.handler=function(_261,src,_263){
var _264=story.saveTiddler(_263,_261.shiftKey);
if(_264){
story.displayTiddler(null,_264);
}
return false;
};
config.commands.cancelTiddler.handler=function(_265,src,_267){
if(story.hasChanges(_267)&&!readOnly){
if(!confirm(this.warning.format([_267]))){
return false;
}
}
story.setDirty(_267,false);
story.displayTiddler(null,_267);
return false;
};
config.commands.deleteTiddler.handler=function(_268,src,_26a){
var _26b=true;
if(config.options.chkConfirmDelete){
_26b=confirm(this.warning.format([_26a]));
}
if(_26b){
store.removeTiddler(_26a);
story.closeTiddler(_26a,true);
autoSaveChanges();
}
return false;
};
config.commands.permalink.handler=function(_26c,src,_26e){
var t=encodeURIComponent(String.encodeTiddlyLink(_26e));
if(window.location.hash!=t){
window.location.hash=t;
}
return false;
};
config.commands.references.handlePopup=function(_270,_271){
var _272=store.getReferringTiddlers(_271);
var c=false;
var r;
for(r=0;r<_272.length;r++){
if(_272[r].title!=_271&&!_272[r].isTagged("excludeLists")){
createTiddlyLink(createTiddlyElement(_270,"li"),_272[r].title,true);
c=true;
}
}
if(!c){
createTiddlyElement(_270,"li",null,"disabled",this.popupNone);
}
};
config.commands.jump.handlePopup=function(_275,_276){
story.forEachTiddler(function(_277,_278){
createTiddlyLink(createTiddlyElement(_275,"li"),_277,true,null,false,null,true);
});
};
config.commands.fields.handlePopup=function(_279,_27a){
var _27b=store.fetchTiddler(_27a);
if(!_27b){
return;
}
var _27c=[];
store.forEachField(_27b,function(_27d,_27e,_27f){
_27c.push({field:_27e,value:_27f});
},true);
_27c.sort(function(a,b){
return a.field<b.field?-1:(a.field==b.field?0:+1);
});
if(_27c.length>0){
ListView.create(_279,_27c,this.listViewTemplate);
}else{
createTiddlyElement(_279,"div",null,null,this.emptyText);
}
};
function Tiddler(_282){
this.title=_282;
this.text="";
this.creator=null;
this.modifier=null;
this.created=new Date();
this.modified=this.created;
this.links=[];
this.linksUpdated=false;
this.tags=[];
this.fields={};
return this;
}
Tiddler.prototype.getLinks=function(){
if(this.linksUpdated==false){
this.changed();
}
return this.links;
};
Tiddler.prototype.getInheritedFields=function(){
var f={};
var i;
for(i in this.fields){
if(i=="server.host"||i=="server.workspace"||i=="wikiformat"||i=="server.type"){
f[i]=this.fields[i];
}
}
return String.encodeHashMap(f);
};
Tiddler.prototype.incChangeCount=function(){
var c=this.fields["changecount"];
c=c?parseInt(c,10):0;
this.fields["changecount"]=String(c+1);
};
Tiddler.prototype.clearChangeCount=function(){
if(this.fields["changecount"]){
delete this.fields["changecount"];
}
};
Tiddler.prototype.doNotSave=function(){
return this.fields["doNotSave"];
};
Tiddler.prototype.isTouched=function(){
var _286=this.fields.changecount||0;
return _286>0;
};
Tiddler.prototype.set=function(_287,text,_289,_28a,tags,_28c,_28d,_28e){
this.assign(_287,text,_289,_28a,tags,_28c,_28d,_28e);
this.changed();
return this;
};
Tiddler.prototype.assign=function(_28f,text,_291,_292,tags,_294,_295,_296){
if(_28f!=undefined){
this.title=_28f;
}
if(text!=undefined){
this.text=text;
}
if(_291!=undefined){
this.modifier=_291;
}
if(_292!=undefined){
this.modified=_292;
}
if(_296!=undefined){
this.creator=_296;
}
if(_294!=undefined){
this.created=_294;
}
if(_295!=undefined){
this.fields=_295;
}
if(tags!=undefined){
this.tags=(typeof tags=="string")?tags.readBracketedList():tags;
}else{
if(this.tags==undefined){
this.tags=[];
}
}
return this;
};
Tiddler.prototype.getTags=function(){
return String.encodeTiddlyLinkList(this.tags);
};
Tiddler.prototype.isTagged=function(tag){
return this.tags.indexOf(tag)!=-1;
};
Tiddler.unescapeLineBreaks=function(text){
return text?text.unescapeLineBreaks():"";
};
Tiddler.prototype.escapeLineBreaks=function(){
return this.text.escapeLineBreaks();
};
Tiddler.prototype.changed=function(){
this.links=[];
var text=this.text;
text=text.replace(/\/%((?:.|\n)*?)%\//g,"").replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").replace(/"""((?:.|\n)*?)"""/g,"").replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").replace(/<script((?:.|\n)*?)<\/script\>/g,"");
var t=this.autoLinkWikiWords()?0:1;
var _29b=t==0?config.textPrimitives.tiddlerAnyLinkRegExp:config.textPrimitives.tiddlerForcedLinkRegExp;
_29b.lastIndex=0;
var _29c=_29b.exec(text);
while(_29c){
var _29d=_29b.lastIndex;
if(t==0&&_29c[1]&&_29c[1]!=this.title){
if(_29c.index>0){
var _29e=new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
_29e.lastIndex=_29c.index-1;
var _29f=_29e.exec(text);
if(_29f.index!=_29c.index-1){
this.links.pushUnique(_29c[1]);
}
}else{
this.links.pushUnique(_29c[1]);
}
}else{
if(_29c[2-t]&&!config.formatterHelpers.isExternalLink(_29c[3-t])){
this.links.pushUnique(_29c[3-t]);
}else{
if(_29c[4-t]&&_29c[4-t]!=this.title){
this.links.pushUnique(_29c[4-t]);
}
}
}
_29b.lastIndex=_29d;
_29c=_29b.exec(text);
}
this.linksUpdated=true;
};
Tiddler.prototype.getSubtitle=function(){
var _2a0=this.modifier;
if(!_2a0){
_2a0=config.messages.subtitleUnknown||"";
}
var _2a1=this.modified;
if(_2a1){
_2a1=_2a1.toLocaleString();
}else{
_2a1=config.messages.subtitleUnknown||"";
}
var f=config.messages.tiddlerLinkTooltip||"%0 - %1, %2";
return f.format([this.title,_2a0,_2a1]);
};
Tiddler.prototype.isReadOnly=function(){
return readOnly;
};
Tiddler.prototype.autoLinkWikiWords=function(){
return !(this.isTagged("systemConfig")||this.isTagged("excludeMissing"));
};
Tiddler.prototype.getServerType=function(){
var _2a3=null;
if(this.fields["server.type"]){
_2a3=this.fields["server.type"];
}
if(!_2a3){
_2a3=this.fields["wikiformat"];
}
if(_2a3&&!config.adaptors[_2a3]){
_2a3=null;
}
return _2a3;
};
Tiddler.prototype.getAdaptor=function(){
var _2a4=this.getServerType();
return _2a4?new config.adaptors[_2a4]():null;
};
function TiddlyWiki(_2a5){
var _2a6={};
if(_2a5&&_2a5.config){
this.config=config;
}
this.tiddlersUpdated=false;
this.namedNotifications=[];
this.notificationLevel=0;
this.slices={};
this.clear=function(){
_2a6={};
this.setDirty(false);
};
this.fetchTiddler=function(_2a7){
var t=_2a6[_2a7];
return t instanceof Tiddler?t:null;
};
this.deleteTiddler=function(_2a9){
delete this.slices[_2a9];
delete _2a6[_2a9];
};
this.addTiddler=function(_2aa){
delete this.slices[_2aa.title];
_2a6[_2aa.title]=_2aa;
};
this.forEachTiddler=function(_2ab){
var t;
for(t in _2a6){
var _2ad=_2a6[t];
if(_2ad instanceof Tiddler){
_2ab.call(this,t,_2ad);
}
}
};
}
TiddlyWiki.prototype.setDirty=function(_2ae){
this.dirty=_2ae;
};
TiddlyWiki.prototype.isDirty=function(){
return this.dirty;
};
TiddlyWiki.prototype.tiddlerExists=function(_2af){
var t=this.fetchTiddler(_2af);
return t!=undefined;
};
TiddlyWiki.prototype.isShadowTiddler=function(_2b1){
return config.shadowTiddlers[_2b1]===undefined?false:true;
};
TiddlyWiki.prototype.isAvailable=function(_2b2){
if(!_2b2){
return false;
}
var s=_2b2?_2b2.indexOf(config.textPrimitives.sectionSeparator):-1;
if(s!=-1){
_2b2=_2b2.substr(0,s);
}
return this.tiddlerExists(_2b2)||this.isShadowTiddler(_2b2);
};
TiddlyWiki.prototype.createTiddler=function(_2b4){
var _2b5=this.fetchTiddler(_2b4);
if(!_2b5){
_2b5=new Tiddler(_2b4);
this.addTiddler(_2b5);
this.setDirty(true);
}
return _2b5;
};
TiddlyWiki.prototype.getTiddler=function(_2b6){
var t=this.fetchTiddler(_2b6);
if(t!=undefined){
return t;
}else{
return null;
}
};
TiddlyWiki.prototype.getShadowTiddlerText=function(_2b8){
if(typeof config.shadowTiddlers[_2b8]=="string"){
return config.shadowTiddlers[_2b8];
}else{
return "";
}
};
TiddlyWiki.prototype.getTiddlerText=function(_2b9,_2ba){
if(!_2b9){
return _2ba;
}
var pos=_2b9.indexOf(config.textPrimitives.sectionSeparator);
var _2bc=null;
if(pos!=-1){
_2bc=_2b9.substr(pos+config.textPrimitives.sectionSeparator.length);
_2b9=_2b9.substr(0,pos);
}
pos=_2b9.indexOf(config.textPrimitives.sliceSeparator);
if(pos!=-1){
var _2bd=this.getTiddlerSlice(_2b9.substr(0,pos),_2b9.substr(pos+config.textPrimitives.sliceSeparator.length));
if(_2bd){
return _2bd;
}
}
var _2be=this.fetchTiddler(_2b9);
var text=_2be?_2be.text:null;
if(!_2be&&this.isShadowTiddler(_2b9)){
text=this.getShadowTiddlerText(_2b9);
}
if(text){
if(!_2bc){
return text;
}
var re=new RegExp("(^!{1,6}[ \t]*"+_2bc.escapeRegExp()+"[ \t]*\n)","mg");
re.lastIndex=0;
var _2c1=re.exec(text);
if(_2c1){
var t=text.substr(_2c1.index+_2c1[1].length);
var re2=/^!/mg;
re2.lastIndex=0;
_2c1=re2.exec(t);
if(_2c1){
t=t.substr(0,_2c1.index-1);
}
return t;
}
return _2ba;
}
if(_2ba!=undefined){
return _2ba;
}
return null;
};
TiddlyWiki.prototype.getRecursiveTiddlerText=function(_2c4,_2c5,_2c6){
var _2c7=new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
var text=this.getTiddlerText(_2c4,null);
if(text==null){
return _2c5;
}
var _2c9=[];
var _2ca,_2cb=0;
do{
_2ca=_2c7.exec(text);
if(_2ca){
_2c9.push(text.substr(_2cb,_2ca.index-_2cb));
if(_2ca[1]){
if(_2c6<=0){
_2c9.push(_2ca[1]);
}else{
_2c9.push(this.getRecursiveTiddlerText(_2ca[1],"",_2c6-1));
}
}
_2cb=_2ca.index+_2ca[0].length;
}else{
_2c9.push(text.substr(_2cb));
}
}while(_2ca);
return _2c9.join("");
};
TiddlyWiki.prototype.slicesRE=/(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.calcAllSlices=function(_2cc){
var _2cd={};
var text=this.getTiddlerText(_2cc,"");
this.slicesRE.lastIndex=0;
var m=this.slicesRE.exec(text);
while(m){
if(m[2]){
_2cd[m[2]]=m[3];
}else{
_2cd[m[5]]=m[6];
}
m=this.slicesRE.exec(text);
}
return _2cd;
};
TiddlyWiki.prototype.getTiddlerSlice=function(_2d0,_2d1){
var _2d2=this.slices[_2d0];
if(!_2d2){
_2d2=this.calcAllSlices(_2d0);
this.slices[_2d0]=_2d2;
}
return _2d2[_2d1];
};
TiddlyWiki.prototype.getTiddlerSlices=function(_2d3,_2d4){
var t,r={};
for(t=0;t<_2d4.length;t++){
var _2d7=this.getTiddlerSlice(_2d3,_2d4[t]);
if(_2d7){
r[_2d4[t]]=_2d7;
}
}
return r;
};
TiddlyWiki.prototype.suspendNotifications=function(){
this.notificationLevel--;
};
TiddlyWiki.prototype.resumeNotifications=function(){
this.notificationLevel++;
};
TiddlyWiki.prototype.notify=function(_2d8,_2d9){
if(!this.notificationLevel){
var t;
for(t=0;t<this.namedNotifications.length;t++){
var n=this.namedNotifications[t];
if((n.name==null&&_2d9)||(n.name==_2d8)){
n.notify(_2d8);
}
}
}
};
TiddlyWiki.prototype.notifyAll=function(){
if(!this.notificationLevel){
var t;
for(t=0;t<this.namedNotifications.length;t++){
var n=this.namedNotifications[t];
if(n.name){
n.notify(n.name);
}
}
}
};
TiddlyWiki.prototype.addNotification=function(_2de,fn){
var i;
for(i=0;i<this.namedNotifications.length;i++){
if((this.namedNotifications[i].name==_2de)&&(this.namedNotifications[i].notify==fn)){
return this;
}
}
this.namedNotifications.push({name:_2de,notify:fn});
return this;
};
TiddlyWiki.prototype.removeTiddler=function(_2e1){
var _2e2=this.fetchTiddler(_2e1);
if(_2e2){
this.deleteTiddler(_2e1);
this.notify(_2e1,true);
this.setDirty(true);
}
};
TiddlyWiki.prototype.resetTiddler=function(_2e3){
var _2e4=this.fetchTiddler(_2e3);
if(_2e4){
_2e4.clearChangeCount();
this.notify(_2e3,true);
this.setDirty(true);
}
};
TiddlyWiki.prototype.setTiddlerTag=function(_2e5,_2e6,tag){
var _2e8=this.fetchTiddler(_2e5);
if(_2e8){
var t=_2e8.tags.indexOf(tag);
if(t!=-1){
_2e8.tags.splice(t,1);
}
if(_2e6){
_2e8.tags.push(tag);
}
_2e8.changed();
_2e8.incChangeCount();
this.notify(_2e5,true);
this.setDirty(true);
}
};
TiddlyWiki.prototype.addTiddlerFields=function(_2ea,_2eb){
var _2ec=this.fetchTiddler(_2ea);
if(!_2ec){
return;
}
merge(_2ec.fields,_2eb);
_2ec.changed();
_2ec.incChangeCount();
this.notify(_2ea,true);
this.setDirty(true);
};
TiddlyWiki.prototype.saveTiddler=function(_2ed,_2ee,_2ef,_2f0,_2f1,tags,_2f3,_2f4,_2f5,_2f6){
var _2f7;
if(_2ed instanceof Tiddler){
_2f7=_2ed;
_2ed=_2f7.title;
_2ee=_2ed;
}else{
_2f7=this.fetchTiddler(_2ed);
if(_2f7){
_2f5=_2f5||_2f7.created;
_2f6=_2f6||_2f7.creator;
this.deleteTiddler(_2ed);
}else{
_2f5=_2f5||_2f1;
_2f7=new Tiddler();
}
_2f3=merge(merge({},_2f3),config.defaultCustomFields,true);
_2f7.set(_2ee,_2ef,_2f0,_2f1,tags,_2f5,_2f3,_2f6);
}
this.addTiddler(_2f7);
if(_2f4){
_2f7.clearChangeCount();
}else{
_2f7.incChangeCount();
}
if(_2ed!=_2ee){
this.notify(_2ed,true);
}
this.notify(_2ee,true);
this.setDirty(true);
return _2f7;
};
TiddlyWiki.prototype.incChangeCount=function(_2f8){
var _2f9=this.fetchTiddler(_2f8);
if(_2f9){
_2f9.incChangeCount();
}
};
TiddlyWiki.prototype.getLoader=function(){
if(!this.loader){
this.loader=new TW21Loader();
}
return this.loader;
};
TiddlyWiki.prototype.getSaver=function(){
if(!this.saver){
this.saver=new TW21Saver();
}
return this.saver;
};
TiddlyWiki.prototype.allTiddlersAsHtml=function(){
return this.getSaver().externalize(store);
};
TiddlyWiki.prototype.loadFromDiv=function(src,_2fb,_2fc){
this.idPrefix=_2fb;
var _2fd=(typeof src=="string")?document.getElementById(src):src;
if(!_2fd){
return;
}
var _2fe=this.getLoader().loadTiddlers(this,_2fd.childNodes);
this.setDirty(false);
if(!_2fc){
var i;
for(i=0;i<_2fe.length;i++){
_2fe[i].changed();
}
}
jQuery(document).trigger("loadTiddlers");
};
TiddlyWiki.prototype.importTiddlyWiki=function(text){
var _301=locateStoreArea(text);
if(!_301){
return null;
}
var _302="<"+"html><"+"body>"+text.substring(_301[0],_301[1]+endSaveArea.length)+"<"+"/body><"+"/html>";
var _303=document.createElement("iframe");
_303.style.display="none";
document.body.appendChild(_303);
var doc=_303.document;
if(_303.contentDocument){
doc=_303.contentDocument;
}else{
if(_303.contentWindow){
doc=_303.contentWindow.document;
}
}
doc.open();
doc.writeln(_302);
doc.close();
var _305=doc.getElementById("storeArea");
this.loadFromDiv(_305,"store");
_303.parentNode.removeChild(_303);
return this;
};
TiddlyWiki.prototype.updateTiddlers=function(){
this.tiddlersUpdated=true;
this.forEachTiddler(function(_306,_307){
_307.changed();
});
};
TiddlyWiki.prototype.search=function(_308,_309,_30a,_30b){
var _30c=this.reverseLookup("tags",_30a,!!_30b);
var t,_30e=[];
for(t=0;t<_30c.length;t++){
if((_30c[t].title.search(_308)!=-1)||(_30c[t].text.search(_308)!=-1)){
_30e.push(_30c[t]);
}
}
if(!_309){
_309="title";
}
_30e.sort(function(a,b){
return a[_309]<b[_309]?-1:(a[_309]==b[_309]?0:+1);
});
return _30e;
};
TiddlyWiki.prototype.getTags=function(_311){
var _312=[];
this.forEachTiddler(function(_313,_314){
var g,c;
for(g=0;g<_314.tags.length;g++){
var tag=_314.tags[g];
var n=true;
for(c=0;c<_312.length;c++){
if(_312[c][0]==tag){
n=false;
_312[c][1]++;
}
}
if(n&&_311){
var t=this.fetchTiddler(tag);
if(t&&t.isTagged(_311)){
n=false;
}
}
if(n){
_312.push([tag,1]);
}
}
});
_312.sort(function(a,b){
return a[0].toLowerCase()<b[0].toLowerCase()?-1:(a[0].toLowerCase()==b[0].toLowerCase()?0:+1);
});
return _312;
};
TiddlyWiki.prototype.getTaggedTiddlers=function(tag,_31d){
return this.reverseLookup("tags",tag,true,_31d);
};
TiddlyWiki.prototype.getValueTiddlers=function(_31e,_31f,_320){
return this.reverseLookup(_31e,_31f,true,_320);
};
TiddlyWiki.prototype.getReferringTiddlers=function(_321,_322,_323){
if(!this.tiddlersUpdated){
this.updateTiddlers();
}
return this.reverseLookup("links",_321,true,_323);
};
TiddlyWiki.prototype.reverseLookup=function(_324,_325,_326,_327){
var _328=[];
this.forEachTiddler(function(_329,_32a){
var f=!_326;
var _32c;
if(["links","tags"].contains(_324)){
_32c=_32a[_324];
}else{
var _32d=TiddlyWiki.standardFieldAccess[_324];
if(_32d){
_32c=[_32d.get(_32a)];
}else{
_32c=_32a.fields[_324]?[_32a.fields[_324]]:[];
}
}
var _32e;
for(_32e=0;_32e<_32c.length;_32e++){
if(_32c[_32e]==_325){
f=_326;
}
}
if(f){
_328.push(_32a);
}
});
if(!_327){
_327="title";
}
return this.sortTiddlers(_328,_327);
};
TiddlyWiki.prototype.getTiddlers=function(_32f,_330){
var _331=[];
this.forEachTiddler(function(_332,_333){
if(_330==undefined||!_333.isTagged(_330)){
_331.push(_333);
}
});
if(_32f){
_331.sort(function(a,b){
return a[_32f]<b[_32f]?-1:(a[_32f]==b[_32f]?0:+1);
});
}
return _331;
};
TiddlyWiki.prototype.getMissingLinks=function(){
if(!this.tiddlersUpdated){
this.updateTiddlers();
}
var _336=[];
this.forEachTiddler(function(_337,_338){
if(_338.isTagged("excludeMissing")||_338.isTagged("systemConfig")){
return;
}
var n;
for(n=0;n<_338.links.length;n++){
var link=_338.links[n];
if(this.getTiddlerText(link,null)==null&&!this.isShadowTiddler(link)&&!config.macros[link]){
_336.pushUnique(link);
}
}
});
_336.sort();
return _336;
};
TiddlyWiki.prototype.getOrphans=function(){
var _33b=[];
this.forEachTiddler(function(_33c,_33d){
if(this.getReferringTiddlers(_33c).length==0&&!_33d.isTagged("excludeLists")){
_33b.push(_33c);
}
});
_33b.sort();
return _33b;
};
TiddlyWiki.prototype.getShadowed=function(){
var t,_33f=[];
for(t in config.shadowTiddlers){
if(this.isShadowTiddler(t)){
_33f.push(t);
}
}
_33f.sort();
return _33f;
};
TiddlyWiki.prototype.getTouched=function(){
var _340=[];
this.forEachTiddler(function(_341,_342){
if(_342.isTouched()){
_340.push(_342);
}
});
_340.sort();
return _340;
};
TiddlyWiki.prototype.resolveTiddler=function(_343){
var t=(typeof _343=="string")?this.getTiddler(_343):_343;
return t instanceof Tiddler?t:null;
};
TiddlyWiki.prototype.sortTiddlers=function(_345,_346){
var asc=+1;
switch(_346.substr(0,1)){
case "-":
asc=-1;
_346=_346.substr(1);
break;
case "+":
_346=_346.substr(1);
break;
}
if(TiddlyWiki.standardFieldAccess[_346]){
if(_346=="title"){
_345.sort(function(a,b){
return a[_346].toLowerCase()<b[_346].toLowerCase()?-asc:(a[_346].toLowerCase()==b[_346].toLowerCase()?0:asc);
});
}else{
_345.sort(function(a,b){
return a[_346]<b[_346]?-asc:(a[_346]==b[_346]?0:asc);
});
}
}else{
_345.sort(function(a,b){
return a.fields[_346]<b.fields[_346]?-asc:(a.fields[_346]==b.fields[_346]?0:+asc);
});
}
return _345;
};
config.filters={tiddler:function(_34e,_34f){
var _350=_34f[1]||_34f[4];
var _351=this.fetchTiddler(_350);
if(_351){
_34e.pushUnique(_351);
}else{
if(this.isShadowTiddler(_350)){
_351=new Tiddler();
_351.set(_350,this.getTiddlerText(_350));
_34e.pushUnique(_351);
}else{
_34e.pushUnique(new Tiddler(_350));
}
}
return _34e;
},tag:function(_352,_353){
var m,_355=this.getTaggedTiddlers(_353[3]);
for(m=0;m<_355.length;m++){
_352.pushUnique(_355[m]);
}
return _352;
},sort:function(_356,_357){
return this.sortTiddlers(_356,_357[3]);
},limit:function(_358,_359){
return _358.slice(0,parseInt(_359[3],10));
},field:function(_35a,_35b){
var m,_35d=this.getValueTiddlers(_35b[2],_35b[3]);
for(m=0;m<_35d.length;m++){
_35a.pushUnique(_35d[m]);
}
return _35a;
}};
TiddlyWiki.prototype.filterTiddlers=function(_35e){
var re=/([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
var _360=[];
if(_35e){
var _361=re.exec(_35e);
while(_361){
var _362=(_361[1]||_361[4])?"tiddler":config.filters[_361[2]]?_361[2]:"field";
_360=config.filters[_362].call(this,_360,_361);
_361=re.exec(_35e);
}
}
return _360;
};
TiddlyWiki.isValidFieldName=function(name){
var _364=/[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
return _364&&(_364[0]==name);
};
TiddlyWiki.checkFieldName=function(name){
if(!TiddlyWiki.isValidFieldName(name)){
throw config.messages.invalidFieldName.format([name]);
}
};
function StringFieldAccess(n,_367){
this.set=_367?function(t,v){
if(v!=t[n]){
throw config.messages.fieldCannotBeChanged.format([n]);
}
}:function(t,v){
if(v!=t[n]){
t[n]=v;
return true;
}
};
this.get=function(t){
return t[n];
};
}
function DateFieldAccess(n){
this.set=function(t,v){
var d=v instanceof Date?v:Date.convertFromYYYYMMDDHHMM(v);
if(d!=t[n]){
t[n]=d;
return true;
}
};
this.get=function(t){
return t[n].convertToYYYYMMDDHHMM();
};
}
function LinksFieldAccess(n){
this.set=function(t,v){
var s=(typeof v=="string")?v.readBracketedList():v;
if(s.toString()!=t[n].toString()){
t[n]=s;
return true;
}
};
this.get=function(t){
return String.encodeTiddlyLinkList(t[n]);
};
}
TiddlyWiki.standardFieldAccess={"title":new StringFieldAccess("title",true),"tiddler":new StringFieldAccess("title",true),"text":new StringFieldAccess("text"),"modifier":new StringFieldAccess("modifier"),"modified":new DateFieldAccess("modified"),"creator":new StringFieldAccess("creator"),"created":new DateFieldAccess("created"),"tags":new LinksFieldAccess("tags")};
TiddlyWiki.isStandardField=function(name){
return TiddlyWiki.standardFieldAccess[name]!=undefined;
};
TiddlyWiki.prototype.setValue=function(_378,_379,_37a){
TiddlyWiki.checkFieldName(_379);
var t=this.resolveTiddler(_378);
if(!t){
return;
}
_379=_379.toLowerCase();
var _37c=(_37a===undefined)||(_37a===null);
var _37d=TiddlyWiki.standardFieldAccess[_379];
if(_37d){
if(_37c){
return;
}
var h=TiddlyWiki.standardFieldAccess[_379];
if(!h.set(t,_37a)){
return;
}
}else{
var _37f=t.fields[_379];
if(_37c){
if(_37f!==undefined){
delete t.fields[_379];
}else{
var re=new RegExp("^"+_379+"\\.");
var _381=false;
var n;
for(n in t.fields){
if(n.match(re)){
delete t.fields[n];
_381=true;
}
}
if(!_381){
return;
}
}
}else{
_37a=_37a instanceof Date?_37a.convertToYYYYMMDDHHMMSSMMM():String(_37a);
if(_37f==_37a){
return;
}
t.fields[_379]=_37a;
}
}
this.notify(t.title,true);
if(!_379.match(/^temp\./)){
this.setDirty(true);
}
};
TiddlyWiki.prototype.getValue=function(_383,_384){
var t=this.resolveTiddler(_383);
if(!t){
return undefined;
}
if(_384.indexOf(config.textPrimitives.sectionSeparator)===0||_384.indexOf(config.textPrimitives.sliceSeparator)===0){
var _386=_384.substr(0,2);
var _387=_384.substring(2);
return store.getTiddlerText("%0%1%2".format(t.title,_386,_387));
}else{
_384=_384.toLowerCase();
var _388=TiddlyWiki.standardFieldAccess[_384];
if(_388){
return _388.get(t);
}
}
return t.fields[_384];
};
TiddlyWiki.prototype.forEachField=function(_389,_38a,_38b){
var t=this.resolveTiddler(_389);
if(!t){
return undefined;
}
var n,_38e;
for(n in t.fields){
_38e=_38a(t,n,t.fields[n]);
if(_38e){
return _38e;
}
}
if(_38b){
return undefined;
}
for(n in TiddlyWiki.standardFieldAccess){
if(n!="tiddler"){
_38e=_38a(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
if(_38e){
return _38e;
}
}
}
return undefined;
};
function Story(_38f,_390){
this.container=_38f;
this.idPrefix=_390;
this.highlightRegExp=null;
this.tiddlerId=function(_391){
_391=_391.replace(/_/g,"__").replace(/ /g,"_");
var id=this.idPrefix+_391;
return id==this.container?this.idPrefix+"_"+_391:id;
};
this.containerId=function(){
return this.container;
};
}
Story.prototype.getTiddler=function(_393){
return document.getElementById(this.tiddlerId(_393));
};
Story.prototype.getContainer=function(){
return document.getElementById(this.containerId());
};
Story.prototype.forEachTiddler=function(fn){
var _395=this.getContainer();
if(!_395){
return;
}
var e=_395.firstChild;
while(e){
var n=e.nextSibling;
var _398=e.getAttribute("tiddler");
if(_398){
fn.call(this,_398,e);
}
e=n;
}
};
Story.prototype.displayDefaultTiddlers=function(){
this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};
Story.prototype.displayTiddlers=function(_399,_39a,_39b,_39c,_39d,_39e,_39f){
var t;
for(t=_39a.length-1;t>=0;t--){
this.displayTiddler(_399,_39a[t],_39b,_39c,_39d,_39e);
}
};
Story.prototype.displayTiddler=function(_3a1,_3a2,_3a3,_3a4,_3a5,_3a6,_3a7,_3a8){
var _3a9=(_3a2 instanceof Tiddler)?_3a2.title:_3a2;
var _3aa=this.getTiddler(_3a9);
if(_3aa){
if(_3a7){
if(_3aa.getAttribute("dirty")!="true"){
this.closeTiddler(_3a9,true);
}
}else{
this.refreshTiddler(_3a9,_3a3,false,_3a6);
}
}else{
var _3ab=this.getContainer();
var _3ac=this.positionTiddler(_3a1);
_3aa=this.createTiddler(_3ab,_3ac,_3a9,_3a3,_3a6);
}
if(_3a8&&typeof _3a8!=="string"){
_3a1=_3a8;
}
if(_3a1&&typeof _3a1!=="string"){
if(config.options.chkAnimate&&(_3a4==undefined||_3a4==true)&&anim&&typeof Zoomer=="function"&&typeof Scroller=="function"){
anim.startAnimating(new Zoomer(_3a9,_3a1,_3aa),new Scroller(_3aa));
}else{
window.scrollTo(0,ensureVisible(_3aa));
}
}
return _3aa;
};
Story.prototype.positionTiddler=function(_3ad){
var _3ae=this.getContainer();
var _3af=null;
if(typeof _3ad=="string"){
switch(_3ad){
case "top":
_3af=_3ae.firstChild;
break;
case "bottom":
_3af=null;
break;
}
}else{
var _3b0=this.findContainingTiddler(_3ad);
if(_3b0==null){
_3af=_3ae.firstChild;
}else{
if(_3b0.nextSibling){
_3af=_3b0.nextSibling;
if(_3af.nodeType!=1){
_3af=null;
}
}
}
}
return _3af;
};
Story.prototype.createTiddler=function(_3b1,_3b2,_3b3,_3b4,_3b5){
var _3b6=createTiddlyElement(null,"div",this.tiddlerId(_3b3),"tiddler");
_3b6.setAttribute("refresh","tiddler");
if(_3b5){
_3b6.setAttribute("tiddlyFields",_3b5);
}
_3b1.insertBefore(_3b6,_3b2);
var _3b7=null;
if(!store.tiddlerExists(_3b3)&&!store.isShadowTiddler(_3b3)){
_3b7=this.loadMissingTiddler(_3b3,_3b5);
}
this.refreshTiddler(_3b3,_3b4,false,_3b5,_3b7);
return _3b6;
};
Story.prototype.loadMissingTiddler=function(_3b8,_3b9,_3ba){
var _3bb=function(_3bc){
if(_3bc.status){
var t=_3bc.tiddler;
if(!t.created){
t.created=new Date();
}
if(!t.modified){
t.modified=t.created;
}
var _3be=store.isDirty();
_3bc.tiddler=store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
if(window.location.protocol!="file:"){
store.setDirty(_3be);
}
autoSaveChanges();
}else{
story.refreshTiddler(_3bc.title,null,true);
}
_3bc.adaptor.close();
if(_3ba){
_3ba(_3bc);
}
};
var _3bf=new Tiddler(_3b8);
_3bf.fields=typeof _3b9=="string"?_3b9.decodeHashMap():_3b9||{};
var _3c0={serverType:_3bf.getServerType()};
if(!_3c0.serverType){
return "";
}
_3c0.host=_3bf.fields["server.host"];
_3c0.workspace=_3bf.fields["server.workspace"];
var _3c1=new config.adaptors[_3c0.serverType]();
_3c1.getTiddler(_3b8,_3c0,null,_3bb);
return config.messages.loadingMissingTiddler.format([_3b8,_3c0.serverType,_3c0.host,_3c0.workspace]);
};
Story.prototype.chooseTemplateForTiddler=function(_3c2,_3c3){
if(!_3c3){
_3c3=DEFAULT_VIEW_TEMPLATE;
}
if(_3c3==DEFAULT_VIEW_TEMPLATE||_3c3==DEFAULT_EDIT_TEMPLATE){
_3c3=config.tiddlerTemplates[_3c3];
}
return _3c3;
};
Story.prototype.getTemplateForTiddler=function(_3c4,_3c5,_3c6){
return store.getRecursiveTiddlerText(_3c5,null,10);
};
Story.prototype.refreshTiddler=function(_3c7,_3c8,_3c9,_3ca,_3cb){
var _3cc=this.getTiddler(_3c7);
if(_3cc){
if(_3cc.getAttribute("dirty")=="true"&&!_3c9){
return _3cc;
}
_3c8=this.chooseTemplateForTiddler(_3c7,_3c8);
var _3cd=_3cc.getAttribute("template");
if((_3c8!=_3cd)||_3c9){
var _3ce=store.getTiddler(_3c7);
if(!_3ce){
_3ce=new Tiddler();
if(store.isShadowTiddler(_3c7)){
var tags=[];
_3ce.set(_3c7,store.getTiddlerText(_3c7),config.views.wikified.shadowModifier,version.date,tags,version.date);
}else{
var text=_3c8=="EditTemplate"?config.views.editor.defaultText.format([_3c7]):config.views.wikified.defaultText.format([_3c7]);
text=_3cb||text;
var _3d1=_3ca?_3ca.decodeHashMap():null;
_3ce.set(_3c7,text,config.views.wikified.defaultModifier,version.date,[],version.date,_3d1);
}
}
_3cc.setAttribute("tags",_3ce.tags.join(" "));
_3cc.setAttribute("tiddler",_3c7);
_3cc.setAttribute("template",_3c8);
_3cc.onmouseover=this.onTiddlerMouseOver;
_3cc.onmouseout=this.onTiddlerMouseOut;
_3cc.ondblclick=this.onTiddlerDblClick;
_3cc[window.event?"onkeydown":"onkeypress"]=this.onTiddlerKeyPress;
_3cc.innerHTML=this.getTemplateForTiddler(_3c7,_3c8,_3ce);
applyHtmlMacros(_3cc,_3ce);
if(store.getTaggedTiddlers(_3c7).length>0){
jQuery(_3cc).addClass("isTag");
}else{
jQuery(_3cc).removeClass("isTag");
}
if(store.tiddlerExists(_3c7)){
jQuery(_3cc).removeClass("shadow");
jQuery(_3cc).removeClass("missing");
}else{
jQuery(_3cc).addClass(store.isShadowTiddler(_3c7)?"shadow":"missing");
}
if(_3ca){
this.addCustomFields(_3cc,_3ca);
}
}
}
return _3cc;
};
Story.prototype.addCustomFields=function(_3d2,_3d3){
var _3d4=_3d3.decodeHashMap();
var w=createTiddlyElement(_3d2,"div",null,"customFields");
w.style.display="none";
var t;
for(t in _3d4){
var e=document.createElement("input");
e.setAttribute("type","text");
e.setAttribute("value",_3d4[t]);
w.appendChild(e);
e.setAttribute("edit",t);
}
};
Story.prototype.refreshAllTiddlers=function(_3d8){
var e=this.getContainer().firstChild;
while(e){
var _3da=e.getAttribute("template");
if(_3da&&e.getAttribute("dirty")!="true"){
this.refreshTiddler(e.getAttribute("tiddler"),_3d8?null:_3da,true);
}
e=e.nextSibling;
}
};
Story.prototype.onTiddlerMouseOver=function(e){
jQuery(this).addClass("selected");
};
Story.prototype.onTiddlerMouseOut=function(e){
jQuery(this).removeClass("selected");
};
Story.prototype.onTiddlerDblClick=function(ev){
var e=ev||window.event;
var _3df=resolveTarget(e);
if(_3df&&_3df.nodeName.toLowerCase()!="input"&&_3df.nodeName.toLowerCase()!="textarea"){
if(document.selection&&document.selection.empty){
document.selection.empty();
}
config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
return true;
}
return false;
};
Story.prototype.onTiddlerKeyPress=function(ev){
var e=ev||window.event;
clearMessage();
var _3e2=false;
var _3e3=this.getAttribute("tiddler");
var _3e4=resolveTarget(e);
switch(e.keyCode){
case 9:
var ed=story.getTiddlerField(_3e3,"text");
if(_3e4.tagName.toLowerCase()=="input"&&ed.value==config.views.editor.defaultText.format([_3e3])){
ed.focus();
ed.select();
_3e2=true;
}
if(config.options.chkInsertTabs&&_3e4.tagName.toLowerCase()=="textarea"){
replaceSelection(_3e4,String.fromCharCode(9));
_3e2=true;
}
if(config.isOpera){
_3e4.onblur=function(){
this.focus();
this.onblur=null;
};
}
break;
case 13:
case 10:
case 77:
if(e.ctrlKey){
blurElement(this);
config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
_3e2=true;
}
break;
case 27:
blurElement(this);
config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
_3e2=true;
break;
}
e.cancelBubble=_3e2;
if(_3e2){
if(e.stopPropagation){
e.stopPropagation();
}
e.returnValue=true;
if(e.preventDefault){
e.preventDefault();
}
}
return !_3e2;
};
Story.prototype.getTiddlerField=function(_3e6,_3e7){
var _3e8=this.getTiddler(_3e6);
var e=null;
if(_3e8){
var t,_3eb=_3e8.getElementsByTagName("*");
for(t=0;t<_3eb.length;t++){
var c=_3eb[t];
if(c.tagName.toLowerCase()=="input"||c.tagName.toLowerCase()=="textarea"){
if(!e){
e=c;
}
if(c.getAttribute("edit")==_3e7){
e=c;
}
}
}
}
return e;
};
Story.prototype.focusTiddler=function(_3ed,_3ee){
var e=this.getTiddlerField(_3ed,_3ee);
if(e){
e.focus();
e.select();
}
};
Story.prototype.blurTiddler=function(_3f0){
var _3f1=this.getTiddler(_3f0);
if(_3f1&&_3f1.focus&&_3f1.blur){
_3f1.focus();
_3f1.blur();
}
};
Story.prototype.setTiddlerField=function(_3f2,tag,mode,_3f5){
var c=this.getTiddlerField(_3f2,_3f5);
var tags=c.value.readBracketedList();
tags.setItem(tag,mode);
c.value=String.encodeTiddlyLinkList(tags);
};
Story.prototype.setTiddlerTag=function(_3f8,tag,mode){
this.setTiddlerField(_3f8,tag,mode,"tags");
};
Story.prototype.closeTiddler=function(_3fb,_3fc,_3fd){
var _3fe=this.getTiddler(_3fb);
if(_3fe){
clearMessage();
this.scrubTiddler(_3fe);
if(config.options.chkAnimate&&_3fc&&anim&&typeof Slider=="function"){
anim.startAnimating(new Slider(_3fe,false,null,"all"));
}else{
jQuery(_3fe).remove();
}
}
};
Story.prototype.scrubTiddler=function(_3ff){
_3ff.id=null;
};
Story.prototype.setDirty=function(_400,_401){
var _402=this.getTiddler(_400);
if(_402){
_402.setAttribute("dirty",_401?"true":"false");
}
};
Story.prototype.isDirty=function(_403){
var _404=this.getTiddler(_403);
if(_404){
return _404.getAttribute("dirty")=="true";
}
return null;
};
Story.prototype.areAnyDirty=function(){
var r=false;
this.forEachTiddler(function(_406,_407){
if(this.isDirty(_406)){
r=true;
}
});
return r;
};
Story.prototype.closeAllTiddlers=function(_408){
clearMessage();
this.forEachTiddler(function(_409,_40a){
if((_409!=_408)&&_40a.getAttribute("dirty")!="true"){
this.closeTiddler(_409);
}
});
window.scrollTo(0,ensureVisible(this.container));
};
Story.prototype.isEmpty=function(){
var _40b=this.getContainer();
return _40b&&_40b.firstChild==null;
};
Story.prototype.search=function(text,_40d,_40e){
this.closeAllTiddlers();
highlightHack=new RegExp(_40e?text:text.escapeRegExp(),_40d?"mg":"img");
var _40f=store.search(highlightHack,"title","excludeSearch");
this.displayTiddlers(null,_40f);
highlightHack=null;
var q=_40e?"/":"'";
if(_40f.length>0){
displayMessage(config.macros.search.successMsg.format([_40f.length.toString(),q+text+q]));
}else{
displayMessage(config.macros.search.failureMsg.format([q+text+q]));
}
};
Story.prototype.findContainingTiddler=function(e){
while(e&&!jQuery(e).hasClass("tiddler")){
e=jQuery(e).hasClass("popup")&&Popup.stack[0]?Popup.stack[0].root:e.parentNode;
}
return e;
};
Story.prototype.gatherSaveFields=function(e,_413){
if(e&&e.getAttribute){
var f=e.getAttribute("edit");
if(f){
_413[f]=e.value.replace(/\r/mg,"");
}
if(e.hasChildNodes()){
var t,c=e.childNodes;
for(t=0;t<c.length;t++){
this.gatherSaveFields(c[t],_413);
}
}
}
};
Story.prototype.hasChanges=function(_417){
var e=this.getTiddler(_417);
if(e){
var _419={};
this.gatherSaveFields(e,_419);
if(store.fetchTiddler(_417)){
var n;
for(n in _419){
if(store.getValue(_417,n)!=_419[n]){
return true;
}
}
}else{
if(store.isShadowTiddler(_417)&&store.getShadowTiddlerText(_417)==_419.text){
return false;
}else{
return true;
}
}
}
return false;
};
Story.prototype.saveTiddler=function(_41b,_41c){
var _41d=this.getTiddler(_41b);
if(_41d){
var _41e={};
this.gatherSaveFields(_41d,_41e);
var _41f=_41e.title||_41b;
if(!store.tiddlerExists(_41f)){
_41f=_41f.trim();
var _420=config.options.txtUserName;
}
if(store.tiddlerExists(_41f)&&_41f!=_41b){
if(!confirm(config.messages.overwriteWarning.format([_41f.toString()]))){
return null;
}
_41b=_41f;
}
if(_41f!=_41b){
this.closeTiddler(_41f,false);
}
_41d.id=this.tiddlerId(_41f);
_41d.setAttribute("tiddler",_41f);
_41d.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
_41d.setAttribute("dirty","false");
if(config.options.chkForceMinorUpdate){
_41c=!_41c;
}
if(!store.tiddlerExists(_41f)){
_41c=false;
}
var _421=new Date();
if(store.tiddlerExists(_41b)){
var t=store.fetchTiddler(_41b);
var _423=t.fields;
_420=t.creator;
}else{
_423=merge({},config.defaultCustomFields);
}
var n;
for(n in _41e){
if(!TiddlyWiki.isStandardField(n)){
_423[n]=_41e[n];
}
}
var _425=store.saveTiddler(_41b,_41f,_41e.text,_41c?undefined:config.options.txtUserName,_41c?undefined:_421,_41e.tags,_423,null,null,_420);
autoSaveChanges(null,[_425]);
return _41f;
}
return null;
};
Story.prototype.permaView=function(){
var _426=[];
this.forEachTiddler(function(_427,_428){
_426.push(String.encodeTiddlyLink(_427));
});
var t=encodeURIComponent(_426.join(" "));
if(t==""){
t="#";
}
if(window.location.hash!=t){
window.location.hash=t;
}
};
Story.prototype.switchTheme=function(_42a){
if(safeMode){
return;
}
var _42b=function(_42c,_42d){
var r;
if(readOnly){
r=store.getTiddlerSlice(_42c,_42d+"ReadOnly")||store.getTiddlerSlice(_42c,"Web"+_42d);
}
r=r||store.getTiddlerSlice(_42c,_42d);
if(r&&r.indexOf(config.textPrimitives.sectionSeparator)==0){
r=_42c+r;
}
return store.isAvailable(r)?r:_42d;
};
var _42f=function(i,name,_432,_433){
var _434=_42b(_432,_433);
if(name!=_434&&store.namedNotifications[i].name==name){
store.namedNotifications[i].name=_434;
return _434;
}
return name;
};
var pt=config.refresherData.pageTemplate;
var vi=DEFAULT_VIEW_TEMPLATE;
var vt=config.tiddlerTemplates[vi];
var ei=DEFAULT_EDIT_TEMPLATE;
var et=config.tiddlerTemplates[ei];
var i;
for(i=0;i<config.notifyTiddlers.length;i++){
var name=config.notifyTiddlers[i].name;
switch(name){
case "PageTemplate":
config.refresherData.pageTemplate=_42f(i,config.refresherData.pageTemplate,_42a,name);
break;
case "StyleSheet":
removeStyleSheet(config.refresherData.styleSheet);
config.refresherData.styleSheet=_42f(i,config.refresherData.styleSheet,_42a,name);
break;
case "ColorPalette":
config.refresherData.colorPalette=_42f(i,config.refresherData.colorPalette,_42a,name);
break;
default:
break;
}
}
config.tiddlerTemplates[vi]=_42b(_42a,"ViewTemplate");
config.tiddlerTemplates[ei]=_42b(_42a,"EditTemplate");
if(!startingUp){
if(config.refresherData.pageTemplate!=pt||config.tiddlerTemplates[vi]!=vt||config.tiddlerTemplates[ei]!=et){
refreshAll();
this.refreshAllTiddlers(true);
}else{
setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
}
config.options.txtTheme=_42a;
saveOption("txtTheme");
}
};
config.tasks.save.action=saveChanges;
var backstage={area:null,toolbar:null,button:null,showButton:null,hideButton:null,cloak:null,panel:null,panelBody:null,panelFooter:null,currTabName:null,currTabElem:null,content:null,init:function(){
var cmb=config.messages.backstage;
this.area=document.getElementById("backstageArea");
this.toolbar=jQuery("#backstageToolbar").empty()[0];
this.button=jQuery("#backstageButton").empty()[0];
this.button.style.display="block";
var t=cmb.open.text+" "+glyph("bentArrowLeft");
this.showButton=createTiddlyButton(this.button,t,cmb.open.tooltip,function(e){
backstage.show();
return false;
},null,"backstageShow");
t=glyph("bentArrowRight")+" "+cmb.close.text;
this.hideButton=createTiddlyButton(this.button,t,cmb.close.tooltip,function(e){
backstage.hide();
return false;
},null,"backstageHide");
this.cloak=document.getElementById("backstageCloak");
this.panel=document.getElementById("backstagePanel");
this.panelFooter=createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
this.panelBody=createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
this.cloak.onmousedown=function(e){
backstage.switchTab(null);
};
createTiddlyText(this.toolbar,cmb.prompt);
for(t=0;t<config.backstageTasks.length;t++){
var _441=config.backstageTasks[t];
var task=config.tasks[_441];
var _443=task.action?this.onClickCommand:this.onClickTab;
var text=task.text+(task.action?"":glyph("downTriangle"));
var btn=createTiddlyButton(this.toolbar,text,task.tooltip,_443,"backstageTab");
jQuery(btn).addClass(task.action?"backstageAction":"backstageTask");
btn.setAttribute("task",_441);
}
this.content=document.getElementById("contentWrapper");
if(config.options.chkBackstage){
this.show();
}else{
this.hide();
}
},isVisible:function(){
return this.area?this.area.style.display=="block":false;
},show:function(){
this.area.style.display="block";
if(anim&&config.options.chkAnimate){
backstage.toolbar.style.left=findWindowWidth()+"px";
var p=[{style:"left",start:findWindowWidth(),end:0,template:"%0px"}];
anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
}else{
backstage.area.style.left="0px";
}
jQuery(this.showButton).hide();
jQuery(this.hideButton).show();
config.options.chkBackstage=true;
saveOption("chkBackstage");
jQuery(this.content).addClass("backstageVisible");
},hide:function(){
if(this.currTabElem){
this.switchTab(null);
}else{
backstage.toolbar.style.left="0px";
if(anim&&config.options.chkAnimate){
var p=[{style:"left",start:0,end:findWindowWidth(),template:"%0px"}];
var c=function(_449,_44a){
backstage.area.style.display="none";
};
anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
}else{
this.area.style.display="none";
}
this.showButton.style.display="block";
this.hideButton.style.display="none";
config.options.chkBackstage=false;
saveOption("chkBackstage");
jQuery(this.content).removeClass("backstageVisible");
}
},onClickCommand:function(e){
var task=config.tasks[this.getAttribute("task")];
if(task.action){
backstage.switchTab(null);
task.action();
}
return false;
},onClickTab:function(e){
backstage.switchTab(this.getAttribute("task"));
return false;
},switchTab:function(_44e){
var _44f=null;
var e=this.toolbar.firstChild;
while(e){
if(e.getAttribute&&e.getAttribute("task")==_44e){
_44f=e;
}
e=e.nextSibling;
}
if(_44e==backstage.currTabName){
backstage.hidePanel();
return;
}
if(backstage.currTabElem){
jQuery(this.currTabElem).removeClass("backstageSelTab");
}
if(_44f&&_44e){
backstage.preparePanel();
jQuery(_44f).addClass("backstageSelTab");
var task=config.tasks[_44e];
wikify(task.content,backstage.panelBody,null,null);
backstage.showPanel();
}else{
if(backstage.currTabElem){
backstage.hidePanel();
}
}
backstage.currTabName=_44e;
backstage.currTabElem=_44f;
},isPanelVisible:function(){
return backstage.panel?backstage.panel.style.display=="block":false;
},preparePanel:function(){
backstage.cloak.style.height=findDocHeight()+"px";
backstage.cloak.style.display="block";
jQuery(backstage.panelBody).empty();
return backstage.panelBody;
},showPanel:function(){
backstage.panel.style.display="block";
if(anim&&config.options.chkAnimate){
backstage.panel.style.top=(-backstage.panel.offsetHeight)+"px";
var p=[{style:"top",start:-backstage.panel.offsetHeight,end:0,template:"%0px"}];
anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
}else{
backstage.panel.style.top="0px";
}
return backstage.panelBody;
},hidePanel:function(){
if(backstage.currTabElem){
jQuery(backstage.currTabElem).removeClass("backstageSelTab");
}
backstage.currTabElem=null;
backstage.currTabName=null;
if(anim&&config.options.chkAnimate){
var p=[{style:"top",start:0,end:-(backstage.panel.offsetHeight),template:"%0px"},{style:"display",atEnd:"none"}];
var c=function(_455,_456){
backstage.cloak.style.display="none";
};
anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
}else{
jQuery([backstage.panel,backstage.cloak]).hide();
}
}};
config.macros.backstage={};
config.macros.backstage.handler=function(_457,_458,_459){
var _45a=config.tasks[_459[0]];
if(_45a){
createTiddlyButton(_457,_45a.text,_45a.tooltip,function(e){
backstage.switchTab(_459[0]);
return false;
});
}
};
config.macros.importTiddlers.handler=function(_45c,_45d,_45e,_45f,_460,_461){
if(readOnly){
createTiddlyElement(_45c,"div",null,"marked",this.readOnlyWarning);
return;
}
var w=new Wizard();
w.createWizard(_45c,this.wizardTitle);
this.restart(w);
};
config.macros.importTiddlers.onCancel=function(e){
var _464=new Wizard(this);
_464.clear();
config.macros.importTiddlers.restart(_464);
return false;
};
config.macros.importTiddlers.onClose=function(e){
backstage.hidePanel();
return false;
};
config.macros.importTiddlers.restart=function(_466){
var me=config.macros.importTiddlers;
_466.addStep(this.step1Title,this.step1Html);
var t,s=_466.getElement("selTypes");
for(t in config.adaptors){
var e=createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel||t);
e.value=t;
}
if(config.defaultAdaptor){
s.value=config.defaultAdaptor;
}
s=_466.getElement("selFeeds");
var _46b=this.getFeeds();
for(t in _46b){
e=createTiddlyElement(s,"option",null,null,t);
e.value=t;
}
_466.setValue("feeds",_46b);
s.onchange=me.onFeedChange;
var _46c=_466.getElement("txtBrowse");
_46c.onchange=me.onBrowseChange;
_46c.onkeyup=me.onBrowseChange;
_466.setButtons([{caption:this.openLabel,tooltip:this.openPrompt,onClick:me.onOpen}]);
_466.formElem.action="javascript:;";
_466.formElem.onsubmit=function(){
if(!this.txtPath||this.txtPath.value.length){
this.lastChild.firstChild.onclick();
}
};
};
config.macros.importTiddlers.getFeeds=function(){
var _46d={};
var t,_46f=store.getTaggedTiddlers("systemServer","title");
for(t=0;t<_46f.length;t++){
var _470=_46f[t].title;
var _471=store.getTiddlerSlice(_470,"Type");
if(!_471){
_471="file";
}
_46d[_470]={title:_470,url:store.getTiddlerSlice(_470,"URL"),workspace:store.getTiddlerSlice(_470,"Workspace"),workspaceList:store.getTiddlerSlice(_470,"WorkspaceList"),tiddlerFilter:store.getTiddlerSlice(_470,"TiddlerFilter"),serverType:_471,description:store.getTiddlerSlice(_470,"Description")};
}
return _46d;
};
config.macros.importTiddlers.onFeedChange=function(e){
var _473=new Wizard(this);
var _474=_473.getElement("selTypes");
var _475=_473.getElement("txtPath");
var _476=_473.getValue("feeds");
var f=_476[this.value];
if(f){
_474.value=f.serverType;
_475.value=f.url;
_473.setValue("feedName",f.serverType);
_473.setValue("feedHost",f.url);
_473.setValue("feedWorkspace",f.workspace);
_473.setValue("feedWorkspaceList",f.workspaceList);
_473.setValue("feedTiddlerFilter",f.tiddlerFilter);
}
return false;
};
config.macros.importTiddlers.onBrowseChange=function(e){
var _479=new Wizard(this);
var file=this.value;
if(this.files&&this.files[0]){
file=this.files[0].fileName;
try{
if(typeof (netscape)!=="undefined"){
netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
}
}
catch(ex){
showException(ex);
}
}
var _47b=_479.getElement("txtPath");
_47b.value=config.macros.importTiddlers.getURLFromLocalPath(file);
var _47c=_479.getElement("selTypes");
_47c.value="file";
return true;
};
config.macros.importTiddlers.getURLFromLocalPath=function(v){
if(!v||!v.length){
return v;
}
v=v.replace(/\\/g,"/");
var u;
var t=v.split(":");
var p=t[1]||t[0];
if(t[1]&&(t[0]=="http"||t[0]=="https"||t[0]=="file")){
u=v;
}else{
if(p.substr(0,1)=="/"){
u=document.location.protocol+"//"+document.location.hostname+(t[1]?"/":"")+v;
}else{
var c=document.location.href.replace(/\\/g,"/");
var pos=c.lastIndexOf("/");
if(pos!=-1){
c=c.substr(0,pos);
}
u=c+"/"+p;
}
}
return u;
};
config.macros.importTiddlers.onOpen=function(e){
var me=config.macros.importTiddlers;
var _485=new Wizard(this);
var _486=_485.getElement("txtPath");
var url=_486.value;
var _488=_485.getElement("selTypes").value||config.defaultAdaptor;
var _489=new config.adaptors[_488]();
_485.setValue("adaptor",_489);
_485.setValue("serverType",_488);
_485.setValue("host",url);
_489.openHost(url,null,_485,me.onOpenHost);
_485.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusOpenHost);
return false;
};
config.macros.importTiddlers.onOpenHost=function(_48a,_48b){
var me=config.macros.importTiddlers;
var _48d=_48b.getValue("adaptor");
if(_48a.status!==true){
displayMessage("Error in importTiddlers.onOpenHost: "+_48a.statusText);
}
_48d.getWorkspaceList(_48a,_48b,me.onGetWorkspaceList);
_48b.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusGetWorkspaceList);
};
config.macros.importTiddlers.onGetWorkspaceList=function(_48e,_48f){
var me=config.macros.importTiddlers;
if(_48e.status!==true){
displayMessage("Error in importTiddlers.onGetWorkspaceList: "+_48e.statusText);
}
_48f.setValue("context",_48e);
var _491=_48f.getValue("feedWorkspace");
if(!_491&&_48e.workspaces.length==1){
_491=_48e.workspaces[0].title;
}
if(_491){
_48e.adaptor.openWorkspace(_491,_48e,_48f,me.onOpenWorkspace);
_48f.setValue("workspace",_491);
_48f.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusOpenWorkspace);
return;
}
_48f.addStep(me.step2Title,me.step2Html);
var t,s=_48f.getElement("selWorkspace");
s.onchange=me.onWorkspaceChange;
for(t=0;t<_48e.workspaces.length;t++){
var e=createTiddlyElement(s,"option",null,null,_48e.workspaces[t].title);
e.value=_48e.workspaces[t].title;
}
var _495=_48f.getValue("feedWorkspaceList");
if(_495){
var n,list=_495.parseParams("workspace",null,false,true);
for(n=1;n<list.length;n++){
if(_48e.workspaces.findByField("title",list[n].value)==null){
e=createTiddlyElement(s,"option",null,null,list[n].value);
e.value=list[n].value;
}
}
}
if(_491){
t=_48f.getElement("txtWorkspace");
t.value=_491;
}
_48f.setButtons([{caption:me.openLabel,tooltip:me.openPrompt,onClick:me.onChooseWorkspace}]);
};
config.macros.importTiddlers.onWorkspaceChange=function(e){
var _499=new Wizard(this);
var t=_499.getElement("txtWorkspace");
t.value=this.value;
this.selectedIndex=0;
return false;
};
config.macros.importTiddlers.onChooseWorkspace=function(e){
var me=config.macros.importTiddlers;
var _49d=new Wizard(this);
var _49e=_49d.getValue("adaptor");
var _49f=_49d.getElement("txtWorkspace").value;
_49d.setValue("workspace",_49f);
var _4a0=_49d.getValue("context");
_49e.openWorkspace(_49f,_4a0,_49d,me.onOpenWorkspace);
_49d.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusOpenWorkspace);
return false;
};
config.macros.importTiddlers.onOpenWorkspace=function(_4a1,_4a2){
var me=config.macros.importTiddlers;
if(_4a1.status!==true){
displayMessage("Error in importTiddlers.onOpenWorkspace: "+_4a1.statusText);
}
var _4a4=_4a2.getValue("adaptor");
_4a4.getTiddlerList(_4a1,_4a2,me.onGetTiddlerList,_4a2.getValue("feedTiddlerFilter"));
_4a2.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusGetTiddlerList);
};
config.macros.importTiddlers.onGetTiddlerList=function(_4a5,_4a6){
var me=config.macros.importTiddlers;
if(_4a5.status!==true){
var _4a8=_4a5.statusText||me.errorGettingTiddlerList;
if(_4a5.host.indexOf("file://")===0){
_4a8=me.errorGettingTiddlerListFile;
}else{
_4a8=_4a5.xhr&&_4a5.xhr.status==404?me.errorGettingTiddlerListHttp404:me.errorGettingTiddlerListHttp;
}
_4a6.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],"");
jQuery("span.status",_4a6.footerEl).html(_4a8);
return;
}
var _4a9=[];
if(_4a5.tiddlers){
var n;
for(n=0;n<_4a5.tiddlers.length;n++){
var _4ab=_4a5.tiddlers[n];
_4a9.push({title:_4ab.title,modified:_4ab.modified,modifier:_4ab.modifier,text:_4ab.text?wikifyPlainText(_4ab.text,100):"",tags:_4ab.tags,size:_4ab.text?_4ab.text.length:0,tiddler:_4ab});
}
}
_4a9.sort(function(a,b){
return a.title<b.title?-1:(a.title==b.title?0:+1);
});
_4a6.addStep(me.step3Title,me.step3Html);
var _4ae=_4a6.getElement("markList");
var _4af=document.createElement("div");
_4ae.parentNode.insertBefore(_4af,_4ae);
var _4b0=ListView.create(_4af,_4a9,me.listViewTemplate);
_4a6.setValue("listView",_4b0);
_4a6.setValue("context",_4a5);
var _4b1=_4a6.getElement("txtSaveTiddler");
_4b1.value=me.generateSystemServerName(_4a6);
_4a6.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel},{caption:me.importLabel,tooltip:me.importPrompt,onClick:me.doImport}]);
};
config.macros.importTiddlers.generateSystemServerName=function(_4b2){
var _4b3=_4b2.getValue("serverType");
var host=_4b2.getValue("host");
var _4b5=_4b2.getValue("workspace");
var _4b6=config.macros.importTiddlers[_4b5?"systemServerNamePattern":"systemServerNamePatternNoWorkspace"];
return _4b6.format([_4b3,host,_4b5]);
};
config.macros.importTiddlers.saveServerTiddler=function(_4b7){
var me=config.macros.importTiddlers;
var _4b9=_4b7.getElement("txtSaveTiddler").value;
if(store.tiddlerExists(_4b9)){
if(!confirm(me.confirmOverwriteSaveTiddler.format([_4b9]))){
return;
}
store.suspendNotifications();
store.removeTiddler(_4b9);
store.resumeNotifications();
}
var _4ba=_4b7.getValue("serverType");
var host=_4b7.getValue("host");
var _4bc=_4b7.getValue("workspace");
var text=me.serverSaveTemplate.format([_4ba,host,_4bc]);
store.saveTiddler(_4b9,_4b9,text,me.serverSaveModifier,new Date(),["systemServer"]);
};
config.macros.importTiddlers.doImport=function(e){
var me=config.macros.importTiddlers;
var _4c0=new Wizard(this);
if(_4c0.getElement("chkSave").checked){
me.saveServerTiddler(_4c0);
}
var _4c1=_4c0.getElement("chkSync").checked;
_4c0.setValue("sync",_4c1);
var _4c2=_4c0.getValue("listView");
var _4c3=ListView.getSelectedRows(_4c2);
var _4c4=_4c0.getValue("adaptor");
var _4c5=[];
var t;
for(t=0;t<_4c3.length;t++){
if(store.tiddlerExists(_4c3[t])){
_4c5.push(_4c3[t]);
}
}
if(_4c5.length>0){
if(!confirm(me.confirmOverwriteText.format([_4c5.join(", ")]))){
return false;
}
}
_4c0.addStep(me.step4Title.format([_4c3.length]),me.step4Html);
for(t=0;t<_4c3.length;t++){
var link=document.createElement("div");
createTiddlyLink(link,_4c3[t],true);
var _4c8=_4c0.getElement("markReport");
_4c8.parentNode.insertBefore(link,_4c8);
}
_4c0.setValue("remainingImports",_4c3.length);
_4c0.setButtons([{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}],me.statusDoingImport);
var _4c9=_4c0.getValue("context");
var _4ca=_4c9?_4c9.tiddlers:[];
for(t=0;t<_4c3.length;t++){
var _4cb={allowSynchronous:true,tiddler:_4ca[_4ca.findByField("title",_4c3[t])]};
_4c4.getTiddler(_4c3[t],_4cb,_4c0,me.onGetTiddler);
}
return false;
};
config.macros.importTiddlers.onGetTiddler=function(_4cc,_4cd){
var me=config.macros.importTiddlers;
if(!_4cc.status){
displayMessage("Error in importTiddlers.onGetTiddler: "+_4cc.statusText);
}
var _4cf=_4cc.tiddler;
store.suspendNotifications();
store.saveTiddler(_4cf.title,_4cf.title,_4cf.text,_4cf.modifier,_4cf.modified,_4cf.tags,_4cf.fields,true,_4cf.created);
if(!_4cd.getValue("sync")){
store.setValue(_4cf.title,"server",null);
}
store.resumeNotifications();
if(!_4cc.isSynchronous){
store.notify(_4cf.title,true);
}
var _4d0=_4cd.getValue("remainingImports")-1;
_4cd.setValue("remainingImports",_4d0);
if(_4d0==0){
if(_4cc.isSynchronous){
store.notifyAll();
refreshDisplay();
}
_4cd.setButtons([{caption:me.doneLabel,tooltip:me.donePrompt,onClick:me.onClose}],me.statusDoneImport);
autoSaveChanges();
}
};
config.macros.upgrade.handler=function(_4d1){
var w=new Wizard();
w.createWizard(_4d1,this.wizardTitle);
w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
w.setButtons([{caption:this.upgradeLabel,tooltip:this.upgradePrompt,onClick:this.onClickUpgrade}]);
};
config.macros.upgrade.onClickUpgrade=function(e){
var me=config.macros.upgrade;
var w=new Wizard(this);
if(window.location.protocol!="file:"){
alert(me.errorCantUpgrade);
return false;
}
if(story.areAnyDirty()||store.isDirty()){
alert(me.errorNotSaved);
return false;
}
var _4d6=getLocalPath(document.location.toString());
var _4d7=getBackupPath(_4d6,me.backupExtension);
w.setValue("backupPath",_4d7);
w.setButtons([],me.statusPreparingBackup);
var _4d8=loadOriginal(_4d6);
w.setButtons([],me.statusSavingBackup);
var _4d9=copyFile(_4d7,_4d6);
if(!_4d9){
_4d9=saveFile(_4d7,_4d8);
}
if(!_4d9){
w.setButtons([],me.errorSavingBackup);
alert(me.errorSavingBackup);
return false;
}
w.setButtons([],me.statusLoadingCore);
var _4da={type:"GET",url:me.source,processData:false,success:function(data,_4dc,_4dd){
me.onLoadCore(true,w,_4dd.responseText,me.source,_4dd);
},error:function(_4de,_4df,_4e0){
me.onLoadCore(false,w,null,me.source,_4de);
}};
ajaxReq(_4da);
return false;
};
config.macros.upgrade.onLoadCore=function(_4e1,_4e2,_4e3,url,xhr){
var me=config.macros.upgrade;
var w=_4e2;
var _4e8;
if(!_4e1){
_4e8=me.errorLoadingCore;
}
var _4e9=me.extractVersion(_4e3);
if(!_4e9){
_4e8=me.errorCoreFormat;
}
if(_4e8){
w.setButtons([],_4e8);
alert(_4e8);
return;
}
var _4ea=function(e){
w.setButtons([],me.statusSavingCore);
var _4ec=getLocalPath(document.location.toString());
saveFile(_4ec,_4e3);
w.setButtons([],me.statusReloadingCore);
var _4ed=w.getValue("backupPath");
var _4ee=document.location.toString()+"?time="+new Date().convertToYYYYMMDDHHMM()+"#upgrade:[["+encodeURI(_4ed)+"]]";
window.setTimeout(function(){
window.location=_4ee;
},10);
};
var _4ef=[me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,_4e9)+1];
w.addStep(me.step2Title,_4ef.format([formatVersion(_4e9),formatVersion(version)]));
w.setButtons([{caption:me.startLabel,tooltip:me.startPrompt,onClick:_4ea},{caption:me.cancelLabel,tooltip:me.cancelPrompt,onClick:me.onCancel}]);
};
config.macros.upgrade.onCancel=function(e){
var me=config.macros.upgrade;
var w=new Wizard(this);
w.addStep(me.step3Title,me.step3Html);
w.setButtons([]);
return false;
};
config.macros.upgrade.extractVersion=function(_4f3){
var re=/^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
var m=re.exec(_4f3);
return m?{title:m[1],major:m[2],minor:m[3],revision:m[4],beta:m[6],date:new Date(m[7])}:null;
};
function upgradeFrom(path){
var _4f7=new TiddlyWiki();
var tw=loadFile(path);
if(window.netscape!==undefined){
tw=convertUTF8ToUnicode(tw);
}
_4f7.importTiddlyWiki(tw);
_4f7.forEachTiddler(function(_4f9,_4fa){
if(!store.getTiddler(_4f9)){
store.addTiddler(_4fa);
}
});
refreshDisplay();
saveChanges();
alert(config.messages.upgradeDone.format([formatVersion()]));
window.location=window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}
config.macros.plugins.handler=function(_4fb,_4fc,_4fd,_4fe,_4ff){
var _500=new Wizard();
_500.createWizard(_4fb,this.wizardTitle);
_500.addStep(this.step1Title,this.step1Html);
var _501=_500.getElement("markList");
var _502=document.createElement("div");
_501.parentNode.insertBefore(_502,_501);
_502.setAttribute("refresh","macro");
_502.setAttribute("macroName","plugins");
_502.setAttribute("params",_4ff);
this.refresh(_502,_4ff);
};
config.macros.plugins.refresh=function(_503,_504){
var me=config.macros.plugins;
var _506=new Wizard(_503);
var _507=[];
ListView.forEachSelector(_503,function(e,_509){
if(e.checked){
_507.push(e.getAttribute("rowName"));
}
});
jQuery(_503).empty();
_504=_504.parseParams("anon");
var _50a=installedPlugins.slice(0);
var t,_50c,p;
var _50e=store.getTaggedTiddlers("systemConfig");
for(t=0;t<_50e.length;t++){
_50c=_50e[t];
if(_50a.findByField("title",_50c.title)==null){
p=getPluginInfo(_50c);
p.executed=false;
p.log.splice(0,0,this.skippedText);
_50a.push(p);
}
}
for(t=0;t<_50a.length;t++){
p=_50a[t];
p.size=p.tiddler.text?p.tiddler.text.length:0;
p.forced=p.tiddler.isTagged("systemConfigForce");
p.disabled=p.tiddler.isTagged("systemConfigDisable");
p.Selected=_507.indexOf(_50a[t].title)!=-1;
}
if(_50a.length==0){
createTiddlyElement(_503,"em",null,null,this.noPluginText);
_506.setButtons([]);
}else{
var _50f=readOnly?this.listViewTemplateReadOnly:this.listViewTemplate;
var _510=ListView.create(_503,_50a,_50f,this.onSelectCommand);
_506.setValue("listView",_510);
if(!readOnly){
_506.setButtons([{caption:me.removeLabel,tooltip:me.removePrompt,onClick:me.doRemoveTag},{caption:me.deleteLabel,tooltip:me.deletePrompt,onClick:me.doDelete}]);
}
}
};
config.macros.plugins.doRemoveTag=function(e){
var _512=new Wizard(this);
var _513=_512.getValue("listView");
var _514=ListView.getSelectedRows(_513);
if(_514.length==0){
alert(config.messages.nothingSelected);
}else{
var t;
for(t=0;t<_514.length;t++){
store.setTiddlerTag(_514[t],false,"systemConfig");
}
autoSaveChanges();
}
};
config.macros.plugins.doDelete=function(e){
var _517=new Wizard(this);
var _518=_517.getValue("listView");
var _519=ListView.getSelectedRows(_518);
if(_519.length==0){
alert(config.messages.nothingSelected);
}else{
if(confirm(config.macros.plugins.confirmDeleteText.format([_519.join(", ")]))){
var t;
for(t=0;t<_519.length;t++){
store.removeTiddler(_519[t]);
story.closeTiddler(_519[t],true);
}
}
autoSaveChanges();
}
};
function getMessageDiv(){
var _51b=document.getElementById("messageArea");
if(!_51b){
return null;
}
if(!_51b.hasChildNodes()){
createTiddlyButton(createTiddlyElement(_51b,"div",null,"messageToolbar"),config.messages.messageClose.text,config.messages.messageClose.tooltip,clearMessage);
}
_51b.style.display="block";
return createTiddlyElement(_51b,"div");
}
function displayMessage(text,_51d){
var e=getMessageDiv();
if(!e){
alert(text);
return;
}
if(_51d){
var link=createTiddlyElement(e,"a",null,null,text);
link.href=_51d;
link.target="_blank";
}else{
e.appendChild(document.createTextNode(text));
}
}
function clearMessage(){
var _520=document.getElementById("messageArea");
if(_520){
jQuery(_520).empty();
_520.style.display="none";
}
return false;
}
config.notifyTiddlers=[{name:"SystemSettings",notify:onSystemSettingsChange},{name:"StyleSheetLayout",notify:refreshStyles},{name:"StyleSheetColors",notify:refreshStyles},{name:"StyleSheet",notify:refreshStyles},{name:"StyleSheetPrint",notify:refreshStyles},{name:"PageTemplate",notify:refreshPageTemplate},{name:"SiteTitle",notify:refreshPageTitle},{name:"SiteSubtitle",notify:refreshPageTitle},{name:"WindowTitle",notify:refreshPageTitle},{name:"ColorPalette",notify:refreshColorPalette},{name:null,notify:refreshDisplay}];
config.refreshers={link:function(e,_522){
var _523=e.getAttribute("tiddlyLink");
refreshTiddlyLink(e,_523);
return true;
},tiddler:function(e,_525){
var _526=e.getAttribute("tiddler");
var _527=e.getAttribute("template");
if(_525&&(_525.indexOf&&_525.indexOf(_526)!=-1)&&!story.isDirty(_526)){
story.refreshTiddler(_526,_527,true);
}else{
refreshElements(e,_525);
}
return true;
},content:function(e,_529){
var _52a=e.getAttribute("tiddler");
var _52b=e.getAttribute("force");
var args=e.getAttribute("args");
if(_52b!=null||_529==null||(_529.indexOf&&_529.indexOf(_52a)!=-1)){
jQuery(e).empty();
config.macros.tiddler.transclude(e,_52a,args);
return true;
}else{
return false;
}
},macro:function(e,_52e){
var _52f=e.getAttribute("macroName");
var _530=e.getAttribute("params");
if(_52f){
_52f=config.macros[_52f];
}
if(_52f&&_52f.refresh){
_52f.refresh(e,_530);
}
return true;
}};
config.refresherData={styleSheet:"StyleSheet",defaultStyleSheet:"StyleSheet",pageTemplate:"PageTemplate",defaultPageTemplate:"PageTemplate",colorPalette:"ColorPalette",defaultColorPalette:"ColorPalette"};
function refreshElements(root,_532){
var c,_534=root.childNodes;
for(c=0;c<_534.length;c++){
var e=_534[c],type=null;
if(e.getAttribute&&(e.tagName?e.tagName!="IFRAME":true)){
type=e.getAttribute("refresh");
}
var _537=config.refreshers[type];
var _538=false;
if(_537!=undefined){
_538=_537(e,_532);
}
if(e.hasChildNodes()&&!_538){
refreshElements(e,_532);
}
}
}
function applyHtmlMacros(root,_53a){
var e=root.firstChild;
while(e){
var _53c=e.nextSibling;
if(e.getAttribute){
var _53d=e.getAttribute("macro");
if(_53d){
e.removeAttribute("macro");
var _53e="";
var p=_53d.indexOf(" ");
if(p!=-1){
_53e=_53d.substr(p+1);
_53d=_53d.substr(0,p);
}
invokeMacro(e,_53d,_53e,null,_53a);
}
}
if(e.hasChildNodes()){
applyHtmlMacros(e,_53a);
}
e=_53c;
}
}
function refreshPageTemplate(_540){
var _541=jQuery("<div/>").appendTo("body").hide()[0];
var _542=story.getContainer();
var _543,t;
if(_542){
_543=_542.childNodes;
for(t=_543.length-1;t>=0;t--){
_541.appendChild(_543[t]);
}
}
var _545=document.getElementById("contentWrapper");
if(!_540||!store.isAvailable(_540)){
_540=config.refresherData.pageTemplate;
}
if(!store.isAvailable(_540)){
_540=config.refresherData.defaultPageTemplate;
}
_545.innerHTML=store.getRecursiveTiddlerText(_540,null,10);
applyHtmlMacros(_545);
refreshElements(_545);
_542=story.getContainer();
jQuery(_542).empty();
if(!_542){
_542=createTiddlyElement(_545,"div",story.containerId());
}
_543=_541.childNodes;
for(t=_543.length-1;t>=0;t--){
_542.appendChild(_543[t]);
}
jQuery(_541).remove();
}
function refreshDisplay(hint){
if(typeof hint=="string"){
hint=[hint];
}
var e=document.getElementById("contentWrapper");
refreshElements(e,hint);
if(backstage.isPanelVisible()){
e=document.getElementById("backstage");
refreshElements(e,hint);
}
}
function refreshPageTitle(){
document.title=getPageTitle();
}
function getPageTitle(){
return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}
function refreshStyles(_548,doc){
setStylesheet(_548==null?"":store.getRecursiveTiddlerText(_548,"",10),_548,doc||document);
}
function refreshColorPalette(_54a){
if(!startingUp){
refreshAll();
}
}
function refreshAll(){
refreshPageTemplate();
refreshDisplay();
refreshStyles("StyleSheetLayout");
refreshStyles("StyleSheetColors");
refreshStyles(config.refresherData.styleSheet);
refreshStyles("StyleSheetPrint");
}
config.optionHandlers={"txt":{get:function(name){
return encodeCookie(config.options[name].toString());
},set:function(name,_54d){
config.options[name]=decodeCookie(_54d);
}},"chk":{get:function(name){
return config.options[name]?"true":"false";
},set:function(name,_550){
config.options[name]=_550=="true";
}}};
function setOption(name,_552){
var _553=name.substr(0,3);
if(config.optionHandlers[_553]&&config.optionHandlers[_553].set){
config.optionHandlers[_553].set(name,_552);
}
}
function getOption(name){
var _555=name.substr(0,3);
return config.optionHandlers[_555]&&config.optionHandlers[_555].get?config.optionHandlers[_555].get(name):null;
}
function loadOptions(){
if(safeMode){
return;
}
loadCookies();
loadSystemSettings();
}
var loadOptionsCookie=loadOptions;
function getCookies(){
var _556=document.cookie.split(";");
var i,_558={};
for(i=0;i<_556.length;i++){
var p=_556[i].indexOf("=");
if(p!=-1){
var name=_556[i].substr(0,p).trim();
var _55b=_556[i].substr(p+1).trim();
_558[name]=_55b;
}
}
return _558;
}
function loadCookies(){
var i,_55d=getCookies();
if(_55d["TiddlyWiki"]){
_55d=_55d["TiddlyWiki"].decodeHashMap();
}
for(i in _55d){
if(config.optionsSource[i]!="setting"){
setOption(i,_55d[i]);
}
}
}
function loadSystemSettings(){
var key,_55f=store.calcAllSlices("SystemSettings");
config.optionsSource={};
for(key in _55f){
setOption(key,_55f[key]);
config.optionsSource[key]="setting";
}
}
function onSystemSettingsChange(){
if(!startingUp){
loadSystemSettings();
}
}
function saveOption(name){
if(safeMode){
return;
}
if(name.match(/[()\s]/g,"_")){
alert(config.messages.invalidCookie.format([name]));
return;
}
saveCookie(name);
if(config.optionsSource[name]=="setting"){
saveSystemSetting(name,true);
}
}
var saveOptionCookie=saveOption;
function removeCookie(name){
document.cookie=name+"=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}
function saveCookie(name){
var key,_564={};
for(key in config.options){
var _565=getOption(key);
_565=_565==null?"false":_565;
_564[key]=_565;
}
document.cookie="TiddlyWiki="+String.encodeHashMap(_564)+"; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
_564=getCookies();
var c;
for(c in _564){
var _567=c.substr(0,3);
if(config.optionHandlers[_567]){
removeCookie(c);
}
}
}
var systemSettingSave;
function commitSystemSettings(_568){
if(systemSettingSave){
window.clearTimeout(systemSettingSave);
}
systemSettingSave=window.setTimeout(function(){
var _569=store.getTiddler("SystemSettings");
autoSaveChanges(null,[_569]);
},1000);
}
function saveSystemSetting(name,_56b){
var _56c="SystemSettings";
var _56d=store.getTiddlerSlice(_56c,name);
if(readOnly||_56d===getOption(name)){
return;
}
var _56e=store.calcAllSlices(_56c);
var key;
for(key in config.optionsSource){
var _570=getOption(key)||"";
if(_56e[key]!==_570){
_56e[key]=_570;
}
}
var text=[];
for(key in _56e){
text.push("%0: %1".format([key,_56e[key]]));
}
text=text.sort().join("\n");
var _572=store.isDirty();
var _573=store.getTiddler(_56c);
if(_573){
_573.text=text;
_573=store.saveTiddler(_573);
}else{
_573=store.saveTiddler(_56c,_56c,text,"System",new Date(),["excludeLists"],config.defaultCustomFields);
}
if(_56b){
commitSystemSettings(_572);
}
}
function encodeCookie(s){
return escape(convertUnicodeToHtmlEntities(s));
}
function decodeCookie(s){
s=unescape(s);
var re=/&#[0-9]{1,5};/g;
return s.replace(re,function($0){
return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));
});
}
config.macros.option.genericCreate=function(_578,type,opt,_57b,desc){
var _57d=config.macros.option.types[type];
var c=document.createElement(_57d.elementType);
if(_57d.typeValue){
c.setAttribute("type",_57d.typeValue);
}
c[_57d.eventName]=_57d.onChange;
c.setAttribute("option",opt);
c.className=_57b||_57d.className;
if(config.optionsDesc[opt]){
c.setAttribute("title",config.optionsDesc[opt]);
}
_578.appendChild(c);
if(desc!="no"){
createTiddlyText(_578,config.optionsDesc[opt]||opt);
}
c[_57d.valueField]=config.options[opt];
return c;
};
config.macros.option.genericOnChange=function(e){
var opt=this.getAttribute("option");
if(opt){
var _581=opt.substr(0,3);
var _582=config.macros.option.types[_581];
if(_582.elementType&&_582.valueField){
config.macros.option.propagateOption(opt,_582.valueField,this[_582.valueField],_582.elementType,this);
}
}
return true;
};
config.macros.option.types={"txt":{elementType:"input",valueField:"value",eventName:"onchange",className:"txtOptionInput",create:config.macros.option.genericCreate,onChange:config.macros.option.genericOnChange},"chk":{elementType:"input",valueField:"checked",eventName:"onclick",className:"chkOptionInput",typeValue:"checkbox",create:config.macros.option.genericCreate,onChange:config.macros.option.genericOnChange}};
config.macros.option.propagateOption=function(opt,_584,_585,_586,elem){
config.options[opt]=_585;
saveOption(opt);
var t,_589=document.getElementsByTagName(_586);
for(t=0;t<_589.length;t++){
var _58a=_589[t].getAttribute("option");
if(opt==_58a&&_589[t]!=elem){
_589[t][_584]=_585;
}
}
};
config.macros.option.handler=function(_58b,_58c,_58d,_58e,_58f){
_58d=_58f.parseParams("anon",null,true,false,false);
var opt=(_58d[1]&&_58d[1].name=="anon")?_58d[1].value:getParam(_58d,"name",null);
var _591=(_58d[2]&&_58d[2].name=="anon")?_58d[2].value:getParam(_58d,"class",null);
var desc=getParam(_58d,"desc","no");
var type=opt.substr(0,3);
var h=config.macros.option.types[type];
if(h&&h.create){
h.create(_58b,type,opt,_591,desc);
}
};
config.macros.options.handler=function(_595,_596,_597,_598,_599){
_597=_599.parseParams("anon",null,true,false,false);
var _59a=getParam(_597,"showUnknown","no");
var _59b=new Wizard();
_59b.createWizard(_595,this.wizardTitle);
_59b.addStep(this.step1Title,this.step1Html);
var _59c=_59b.getElement("markList");
var _59d=_59b.getElement("chkUnknown");
_59d.checked=_59a=="yes";
_59d.onchange=this.onChangeUnknown;
var _59e=document.createElement("div");
_59c.parentNode.insertBefore(_59e,_59c);
_59b.setValue("listWrapper",_59e);
this.refreshOptions(_59e,_59a=="yes");
};
config.macros.options.refreshOptions=function(_59f,_5a0){
var n,opts=[];
for(n in config.options){
var opt={};
opt.option="";
opt.name=n;
opt.lowlight=!config.optionsDesc[n];
opt.description=opt.lowlight?this.unknownDescription:config.optionsDesc[n];
if(!opt.lowlight||_5a0){
opts.push(opt);
}
}
opts.sort(function(a,b){
return a.name.substr(3)<b.name.substr(3)?-1:(a.name.substr(3)==b.name.substr(3)?0:+1);
});
ListView.create(_59f,opts,this.listViewTemplate);
for(n=0;n<opts.length;n++){
var type=opts[n].name.substr(0,3);
var h=config.macros.option.types[type];
if(h&&h.create){
h.create(opts[n].colElements["option"],type,opts[n].name,null,"no");
}
}
};
config.macros.options.onChangeUnknown=function(e){
var _5a9=new Wizard(this);
var _5aa=_5a9.getValue("listWrapper");
jQuery(_5aa).empty();
config.macros.options.refreshOptions(_5aa,this.checked);
return false;
};
var saveUsingSafari=false;
var startSaveArea="<div id=\""+"storeArea\">";
var startSaveAreaRE=/<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/;
var endSaveArea="</d"+"iv>";
var endSaveAreaCaps="</D"+"IV>";
function confirmExit(){
hadConfirmExit=true;
if((store&&store.isDirty&&store.isDirty())||(story&&story.areAnyDirty&&story.areAnyDirty())){
return config.messages.confirmExit;
}
}
function checkUnsavedChanges(){
if(store&&store.isDirty&&store.isDirty()&&window.hadConfirmExit===false){
if(confirm(config.messages.unsavedChangesWarning)){
saveChanges();
}
}
}
function updateLanguageAttribute(s){
if(config.locale){
var mRE=/(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
var m=mRE.exec(s);
if(m){
var t=m[1];
if(m[2]){
t+=" xml:lang=\""+config.locale+"\"";
}
if(m[3]){
t+=" lang=\""+config.locale+"\"";
}
t+=">";
s=s.substr(0,m.index)+t+s.substr(m.index+m[0].length);
}
}
return s;
}
function updateMarkupBlock(s,_5b0,_5b1){
return s.replaceChunk("<!--%0-START-->".format([_5b0]),"<!--%0-END-->".format([_5b0]),"\n"+convertUnicodeToFileFormat(store.getRecursiveTiddlerText(_5b1,""))+"\n");
}
function updateOriginal(_5b2,_5b3,_5b4){
if(!_5b3){
_5b3=locateStoreArea(_5b2);
}
if(!_5b3){
alert(config.messages.invalidFileError.format([_5b4]));
return null;
}
var _5b5=_5b2.substr(0,_5b3[0]+startSaveArea.length)+"\n"+convertUnicodeToFileFormat(store.allTiddlersAsHtml())+"\n"+_5b2.substr(_5b3[1]);
var _5b6=convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
_5b5=_5b5.replaceChunk("<title"+">","</title"+">"," "+_5b6+" ");
_5b5=updateLanguageAttribute(_5b5);
_5b5=updateMarkupBlock(_5b5,"PRE-HEAD","MarkupPreHead");
_5b5=updateMarkupBlock(_5b5,"POST-HEAD","MarkupPostHead");
_5b5=updateMarkupBlock(_5b5,"PRE-BODY","MarkupPreBody");
_5b5=updateMarkupBlock(_5b5,"POST-SCRIPT","MarkupPostBody");
return _5b5;
}
function locateStoreArea(_5b7){
if(!_5b7){
return null;
}
var _5b8=_5b7.search(startSaveAreaRE);
var _5b9=_5b7.indexOf("<"+"!--POST-STOREAREA--"+">");
if(_5b9==-1){
_5b9=_5b7.indexOf("<"+"!--POST-BODY-START--"+">");
}
var _5ba=_5b9==-1?_5b7.length:_5b9;
var _5bb=_5b7.lastIndexOf(endSaveArea,_5ba);
if(_5bb==-1){
_5bb=_5b7.lastIndexOf(endSaveAreaCaps,_5ba);
}
return (_5b8!=-1&&_5bb!=-1)?[_5b8,_5bb]:null;
}
function autoSaveChanges(_5bc,_5bd){
if(config.options.chkAutoSave){
saveChanges(_5bc,_5bd);
}
}
function loadOriginal(_5be){
return loadFile(_5be);
}
function saveChanges(_5bf,_5c0){
if(_5bf&&!store.isDirty()){
return;
}
clearMessage();
var t0=new Date();
var msg=config.messages;
var _5c3=document.location.toString();
if(_5c3.substr(0,5)!="file:"){
alert(msg.notFileUrlError);
if(store.tiddlerExists(msg.saveInstructions)){
story.displayTiddler(null,msg.saveInstructions);
}
return;
}
var _5c4=getLocalPath(_5c3);
var _5c5=loadOriginal(_5c4);
if(_5c5==null){
alert(msg.cantSaveError);
if(store.tiddlerExists(msg.saveInstructions)){
story.displayTiddler(null,msg.saveInstructions);
}
return;
}
var _5c6=locateStoreArea(_5c5);
if(!_5c6){
alert(msg.invalidFileError.format([_5c4]));
return;
}
saveMain(_5c4,_5c5,_5c6);
if(config.options.chkSaveBackups){
saveBackup(_5c4,_5c5);
}
if(config.options.chkSaveEmptyTemplate){
saveEmpty(_5c4,_5c5,_5c6);
}
if(config.options.chkGenerateAnRssFeed&&saveRss instanceof Function){
saveRss(_5c4);
}
if(config.options.chkDisplayInstrumentation){
displayMessage("saveChanges "+(new Date()-t0)+" ms");
}
}
function saveMain(_5c7,_5c8,_5c9){
var save;
try{
var _5cb=updateOriginal(_5c8,_5c9,_5c7);
save=saveFile(_5c7,_5cb);
}
catch(ex){
showException(ex);
}
if(save){
displayMessage(config.messages.mainSaved,"file://"+_5c7);
store.setDirty(false);
}else{
alert(config.messages.mainFailed);
}
}
function saveBackup(_5cc,_5cd){
var _5ce=getBackupPath(_5cc);
var _5cf=copyFile(_5ce,_5cc);
if(!_5cf){
_5cf=saveFile(_5ce,_5cd);
}
if(_5cf){
displayMessage(config.messages.backupSaved,"file://"+_5ce);
}else{
alert(config.messages.backupFailed);
}
}
function saveEmpty(_5d0,_5d1,_5d2){
var _5d3,p;
if((p=_5d0.lastIndexOf("/"))!=-1){
_5d3=_5d0.substr(0,p)+"/";
}else{
if((p=_5d0.lastIndexOf("\\"))!=-1){
_5d3=_5d0.substr(0,p)+"\\";
}else{
_5d3=_5d0+".";
}
}
_5d3+="empty.html";
var _5d5=_5d1.substr(0,_5d2[0]+startSaveArea.length)+_5d1.substr(_5d2[1]);
var _5d6=saveFile(_5d3,_5d5);
if(_5d6){
displayMessage(config.messages.emptySaved,"file://"+_5d3);
}else{
alert(config.messages.emptyFailed);
}
}
function getLocalPath(_5d7){
var _5d8=convertUriToUTF8(_5d7,config.options.txtFileSystemCharSet);
var _5d9=_5d8.indexOf("?");
if(_5d9!=-1){
_5d8=_5d8.substr(0,_5d9);
}
var _5da=_5d8.indexOf("#");
if(_5da!=-1){
_5d8=_5d8.substr(0,_5da);
}
if(_5d8.indexOf("file://localhost/")==0){
_5d8="file://"+_5d8.substr(16);
}
var _5db;
if(_5d8.charAt(9)==":"){
_5db=unescape(_5d8.substr(8)).replace(new RegExp("/","g"),"\\");
}else{
if(_5d8.indexOf("file://///")==0){
_5db="\\\\"+unescape(_5d8.substr(10)).replace(new RegExp("/","g"),"\\");
}else{
if(_5d8.indexOf("file:///")==0){
_5db=unescape(_5d8.substr(7));
}else{
if(_5d8.indexOf("file:/")==0){
_5db=unescape(_5d8.substr(5));
}else{
_5db="\\\\"+unescape(_5d8.substr(7)).replace(new RegExp("/","g"),"\\");
}
}
}
}
return _5db;
}
function getBackupPath(_5dc,_5dd,_5de){
var _5df="\\";
var _5e0=_5dc.lastIndexOf("\\");
if(_5e0==-1){
_5e0=_5dc.lastIndexOf("/");
_5df="/";
}
var _5e1=config.options.txtBackupFolder;
if(!_5e1||_5e1==""){
_5e1=".";
}
var _5e2=_5dc.substr(0,_5e0)+_5df+_5e1+_5dc.substr(_5e0);
_5e2=_5e2.substr(0,_5e2.lastIndexOf("."))+".";
if(_5dd){
_5e2+=_5dd.replace(/[\\\/\*\?\":<> ]/g,"_")+".";
}
_5e2+=(new Date()).convertToYYYYMMDDHHMMSSMMM()+"."+(_5de||"html");
return _5e2;
}
function saveRss(_5e3){
var _5e4=_5e3.substr(0,_5e3.lastIndexOf("."))+".xml";
if(saveFile(_5e4,convertUnicodeToFileFormat(generateRss()))){
displayMessage(config.messages.rssSaved,"file://"+_5e4);
}else{
alert(config.messages.rssFailed);
}
}
tiddlerToRssItem=function(_5e5,uri){
var s="<title"+">"+_5e5.title.htmlEncode()+"</title"+">\n";
s+="<description>"+wikifyStatic(_5e5.text,null,_5e5).htmlEncode()+"</description>\n";
var i;
for(i=0;i<_5e5.tags.length;i++){
s+="<category>"+_5e5.tags[i]+"</category>\n";
}
s+="<link>"+uri+"#"+encodeURIComponent(String.encodeTiddlyLink(_5e5.title))+"</link>\n";
s+="<pubDate>"+_5e5.modified.toGMTString()+"</pubDate>\n";
return s;
};
function generateRss(){
var s=[];
var d=new Date();
var u=store.getTiddlerText("SiteUrl");
s.push("<"+"?xml version=\"1.0\"?"+">");
s.push("<rss version=\"2.0\">");
s.push("<channel>");
s.push("<title"+">"+wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode()+"</title"+">");
if(u){
s.push("<link>"+u.htmlEncode()+"</link>");
}
s.push("<description>"+wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode()+"</description>");
s.push("<language>"+config.locale+"</language>");
s.push("<copyright>Copyright "+d.getFullYear()+" "+config.options.txtUserName.htmlEncode()+"</copyright>");
s.push("<pubDate>"+d.toGMTString()+"</pubDate>");
s.push("<lastBuildDate>"+d.toGMTString()+"</lastBuildDate>");
s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
s.push("<generator>TiddlyWiki "+formatVersion()+"</generator>");
var _5ec=store.getTiddlers("modified","excludeLists");
var i,n=config.numRssItems>_5ec.length?0:_5ec.length-config.numRssItems;
for(i=_5ec.length-1;i>=n;i--){
s.push("<item>\n"+tiddlerToRssItem(_5ec[i],u)+"\n</item>");
}
s.push("</channel>");
s.push("</rss>");
return s.join("\n");
}
function copyFile(dest,_5f0){
return config.browser.isIE?ieCopyFile(dest,_5f0):false;
}
function saveFile(_5f1,_5f2){
var r=mozillaSaveFile(_5f1,_5f2);
if(!r){
r=ieSaveFile(_5f1,_5f2);
}
if(!r){
r=javaSaveFile(_5f1,_5f2);
}
return r;
}
function loadFile(_5f4){
var r=mozillaLoadFile(_5f4);
if((r==null)||(r==false)){
r=ieLoadFile(_5f4);
}
if((r==null)||(r==false)){
r=javaLoadFile(_5f4);
}
return r;
}
function ieCreatePath(path){
try{
var fso=new ActiveXObject("Scripting.FileSystemObject");
}
catch(ex){
return null;
}
var pos=path.lastIndexOf("\\");
if(pos==-1){
pos=path.lastIndexOf("/");
}
if(pos!=-1){
path=path.substring(0,pos+1);
}
var scan=[path];
var _5fa=fso.GetParentFolderName(path);
while(_5fa&&!fso.FolderExists(_5fa)){
scan.push(_5fa);
_5fa=fso.GetParentFolderName(_5fa);
}
for(i=scan.length-1;i>=0;i--){
if(!fso.FolderExists(scan[i])){
fso.CreateFolder(scan[i]);
}
}
return true;
}
function ieSaveFile(_5fb,_5fc){
ieCreatePath(_5fb);
try{
var fso=new ActiveXObject("Scripting.FileSystemObject");
}
catch(ex){
return null;
}
var file=fso.OpenTextFile(_5fb,2,-1,0);
file.Write(_5fc);
file.Close();
return true;
}
function ieLoadFile(_5ff){
try{
var fso=new ActiveXObject("Scripting.FileSystemObject");
var file=fso.OpenTextFile(_5ff,1);
var _602=file.ReadAll();
file.Close();
}
catch(ex){
return null;
}
return _602;
}
function ieCopyFile(dest,_604){
ieCreatePath(dest);
try{
var fso=new ActiveXObject("Scripting.FileSystemObject");
fso.GetFile(_604).Copy(dest);
}
catch(ex){
return false;
}
return true;
}
function mozillaSaveFile(_606,_607){
if(window.Components){
try{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var file=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
file.initWithPath(_606);
if(!file.exists()){
file.create(0,436);
}
var out=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
out.init(file,34,4,null);
out.write(_607,_607.length);
out.flush();
out.close();
return true;
}
catch(ex){
return false;
}
}
return null;
}
function mozillaLoadFile(_60a){
if(window.Components){
try{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var file=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
file.initWithPath(_60a);
if(!file.exists()){
return null;
}
var _60c=Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
_60c.init(file,1,4,null);
var _60d=Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
_60d.init(_60c);
var _60e=_60d.read(_60d.available());
_60d.close();
_60c.close();
return _60e;
}
catch(ex){
return false;
}
}
return null;
}
function javaUrlToFilename(url){
var f="//localhost";
if(url.indexOf(f)==0){
return url.substring(f.length);
}
var i=url.indexOf(":");
return i>0?url.substring(i-1):url;
}
function javaSaveFile(_612,_613){
try{
if(document.applets["TiddlySaver"]){
return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(_612),"UTF-8",_613);
}
}
catch(ex){
}
try{
var s=new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(_612)));
s.print(_613);
s.close();
}
catch(ex2){
return null;
}
return true;
}
function javaLoadFile(_615){
try{
if(document.applets["TiddlySaver"]){
var ret=document.applets["TiddlySaver"].loadFile(javaUrlToFilename(_615),"UTF-8");
if(!ret){
return null;
}
return String(ret);
}
}
catch(ex){
}
var _617=[];
try{
var r=new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(_615)));
var line;
while((line=r.readLine())!=null){
_617.push(String(line));
}
r.close();
}
catch(ex2){
return null;
}
return _617.join("\n");
}
function convertUTF8ToUnicode(u){
return config.browser.isOpera||!window.netscape?manualConvertUTF8ToUnicode(u):mozConvertUTF8ToUnicode(u);
}
function manualConvertUTF8ToUnicode(utf){
var uni=utf;
var src=0;
var dst=0;
var b1,b2,b3;
var c;
while(src<utf.length){
b1=utf.charCodeAt(src++);
if(b1<128){
dst++;
}else{
if(b1<224){
b2=utf.charCodeAt(src++);
c=String.fromCharCode(((b1&31)<<6)|(b2&63));
uni=uni.substring(0,dst++).concat(c,utf.substr(src));
}else{
b2=utf.charCodeAt(src++);
b3=utf.charCodeAt(src++);
c=String.fromCharCode(((b1&15)<<12)|((b2&63)<<6)|(b3&63));
uni=uni.substring(0,dst++).concat(c,utf.substr(src));
}
}
}
return uni;
}
function mozConvertUTF8ToUnicode(u){
try{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var _624=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
_624.charset="UTF-8";
}
catch(ex){
return manualConvertUTF8ToUnicode(u);
}
var s=_624.ConvertToUnicode(u);
var fin=_624.Finish();
return fin.length>0?s+fin:s;
}
function convertUnicodeToFileFormat(s){
return config.browser.isOpera||!window.netscape?(config.browser.isIE?convertUnicodeToHtmlEntities(s):s):mozConvertUnicodeToUTF8(s);
}
function convertUnicodeToHtmlEntities(s){
var re=/[^\u0000-\u007F]/g;
return s.replace(re,function($0){
return "&#"+$0.charCodeAt(0).toString()+";";
});
}
function convertUnicodeToUTF8(s){
return convertUnicodeToFileFormat(s);
}
function manualConvertUnicodeToUTF8(s){
return unescape(encodeURIComponent(s));
}
function mozConvertUnicodeToUTF8(s){
try{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var _62e=Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
_62e.charset="UTF-8";
}
catch(ex){
return manualConvertUnicodeToUTF8(s);
}
var u=_62e.ConvertFromUnicode(s);
var fin=_62e.Finish();
return fin.length>0?u+fin:u;
}
function convertUriToUTF8(uri,_632){
if(window.netscape==undefined||_632==undefined||_632==""){
return uri;
}
try{
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
var _633=Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
}
catch(ex){
return uri;
}
return _633.convertURISpecToUTF8(uri,_632);
}
function AdaptorBase(){
this.host=null;
this.store=null;
return this;
}
AdaptorBase.prototype.close=function(){
return true;
};
AdaptorBase.prototype.fullHostName=function(host){
if(!host){
return "";
}
host=host.trim();
if(!host.match(/:\/\//)){
host="http://"+host;
}
if(host.substr(host.length-1)=="/"){
host=host.substr(0,host.length-1);
}
return host;
};
AdaptorBase.minHostName=function(host){
return host;
};
AdaptorBase.prototype.setContext=function(_636,_637,_638){
if(!_636){
_636={};
}
_636.userParams=_637;
if(_638){
_636.callback=_638;
}
_636.adaptor=this;
if(!_636.host){
_636.host=this.host;
}
_636.host=this.fullHostName(_636.host);
if(!_636.workspace){
_636.workspace=this.workspace;
}
return _636;
};
AdaptorBase.prototype.openHost=function(host,_63a,_63b,_63c){
this.host=host;
_63a=this.setContext(_63a,_63b,_63c);
_63a.status=true;
if(_63c){
window.setTimeout(function(){
_63a.callback(_63a,_63b);
},10);
}
return true;
};
AdaptorBase.prototype.openWorkspace=function(_63d,_63e,_63f,_640){
this.workspace=_63d;
_63e=this.setContext(_63e,_63f,_640);
_63e.status=true;
if(_640){
window.setTimeout(function(){
_640(_63e,_63f);
},10);
}
return true;
};
function FileAdaptor(){
}
FileAdaptor.prototype=new AdaptorBase();
FileAdaptor.serverType="file";
FileAdaptor.serverLabel="TiddlyWiki";
FileAdaptor.loadTiddlyWikiSuccess=function(_641,_642){
_641.status=true;
_641.adaptor.store=new TiddlyWiki();
if(!_641.adaptor.store.importTiddlyWiki(_642.responseText)){
_641.statusText=config.messages.invalidFileError.format([_641.host]);
_641.status=false;
}
_641.complete(_641,_641.userParams);
};
FileAdaptor.loadTiddlyWikiError=function(_643,_644){
_643.status=false;
_643.statusText=_644.message;
_643.complete(_643,_643.userParams);
};
FileAdaptor.prototype.getWorkspaceList=function(_645,_646,_647){
_645=this.setContext(_645,_646,_647);
_645.workspaces=[{title:"(default)"}];
_645.status=true;
if(_647){
window.setTimeout(function(){
_647(_645,_646);
},10);
}
return true;
};
FileAdaptor.prototype.getTiddlerList=function(_648,_649,_64a,_64b){
_648=this.setContext(_648,_649,_64a);
if(!_648.filter){
_648.filter=_64b;
}
_648.complete=FileAdaptor.getTiddlerListComplete;
if(this.store){
return _648.complete(_648,_648.userParams);
}
var _64c={type:"GET",url:_648.host,processData:false,success:function(data,_64e,_64f){
FileAdaptor.loadTiddlyWikiSuccess(_648,_64f);
},error:function(_650,_651,_652){
_648.xhr=_650;
FileAdaptor.loadTiddlyWikiError(_648,_650);
}};
return ajaxReq(_64c);
};
FileAdaptor.getTiddlerListComplete=function(_653,_654){
if(_653.status){
if(_653.filter){
_653.tiddlers=_653.adaptor.store.filterTiddlers(_653.filter);
}else{
_653.tiddlers=[];
_653.adaptor.store.forEachTiddler(function(_655,_656){
_653.tiddlers.push(_656);
});
}
var i;
for(i=0;i<_653.tiddlers.length;i++){
_653.tiddlers[i].fields["server.type"]=FileAdaptor.serverType;
_653.tiddlers[i].fields["server.host"]=AdaptorBase.minHostName(_653.host);
_653.tiddlers[i].fields["server.page.revision"]=_653.tiddlers[i].modified.convertToYYYYMMDDHHMM();
}
_653.status=true;
}
if(_653.callback){
window.setTimeout(function(){
_653.callback(_653,_654);
},10);
}
return true;
};
FileAdaptor.prototype.generateTiddlerInfo=function(_658){
var info={};
info.uri=_658.fields["server.host"]+"#"+_658.title;
return info;
};
FileAdaptor.prototype.getTiddler=function(_65a,_65b,_65c,_65d){
_65b=this.setContext(_65b,_65c,_65d);
_65b.title=_65a;
_65b.complete=FileAdaptor.getTiddlerComplete;
if(_65b.adaptor.store){
return _65b.complete(_65b,_65b.userParams);
}
var _65e={type:"GET",url:_65b.host,processData:false,success:function(data,_660,_661){
FileAdaptor.loadTiddlyWikiSuccess(_65b,_661);
},error:function(_662,_663,_664){
FileAdaptor.loadTiddlyWikiError(_65b,_662);
}};
return ajaxReq(_65e);
};
FileAdaptor.getTiddlerComplete=function(_665,_666){
var t=_665.adaptor.store.fetchTiddler(_665.title);
if(t){
t.fields["server.type"]=FileAdaptor.serverType;
t.fields["server.host"]=AdaptorBase.minHostName(_665.host);
t.fields["server.page.revision"]=t.modified.convertToYYYYMMDDHHMM();
_665.tiddler=t;
_665.status=true;
}else{
_665.status=false;
}
if(_665.allowSynchronous){
_665.isSynchronous=true;
_665.callback(_665,_666);
}else{
window.setTimeout(function(){
_665.callback(_665,_666);
},10);
}
return true;
};
FileAdaptor.prototype.close=function(){
this.store=null;
};
config.adaptors[FileAdaptor.serverType]=FileAdaptor;
config.defaultAdaptor=FileAdaptor.serverType;
function ajaxReq(args){
if(window.Components&&window.netscape&&window.netscape.security&&document.location.protocol.indexOf("http")==-1){
window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
}
return jQuery.ajax(args);
}
function httpReq(type,url,_66b,_66c,_66d,data,_66f,_670,_671,_672){
var _673=function(xhr){
try{
return (!xhr.status&&location.protocol==="file:")||(xhr.status>=200&&xhr.status<300)||xhr.status===304||xhr.status===1223;
}
catch(e){
}
return false;
};
var _675={type:type,url:url,processData:false,data:data,cache:!!_672,beforeSend:function(xhr){
var i;
for(i in _66d){
xhr.setRequestHeader(i,_66d[i]);
}
}};
if(_66b){
_675.complete=function(xhr,_679){
if(_673(xhr)){
_66b(true,_66c,xhr.responseText,url,xhr);
}else{
_66b(false,_66c,null,url,xhr);
}
};
}
if(_66f){
_675.contentType=_66f;
}
if(_670){
_675.username=_670;
}
if(_671){
_675.password=_671;
}
if(window.Components&&window.netscape&&window.netscape.security&&document.location.protocol.indexOf("http")==-1){
window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
}
return jQuery.ajax(_675);
}
function formatVersion(v){
v=v||version;
return v.major+"."+v.minor+"."+v.revision+(v.alpha?" (alpha "+v.alpha+")":"")+(v.beta?" (beta "+v.beta+")":"");
}
function compareVersions(v1,v2){
var x1,x2,i,a=["major","minor","revision"];
for(i=0;i<a.length;i++){
x1=v1[a[i]]||0;
x2=v2[a[i]]||0;
if(x1<x2){
return 1;
}
if(x1>x2){
return -1;
}
}
x1=v1.beta||9999;
x2=v2.beta||9999;
if(x1<x2){
return 1;
}
return x1>x2?-1:0;
}
function merge(dst,src,_683){
var i;
for(i in src){
if(!_683||dst[i]===undefined){
dst[i]=src[i];
}
}
return dst;
}
function resolveTarget(e){
var obj;
if(e.target){
obj=e.target;
}else{
if(e.srcElement){
obj=e.srcElement;
}
}
if(obj.nodeType==3){
obj=obj.parentNode;
}
return obj;
}
function exceptionText(e,_688){
var s=e.description||e.toString();
return _688?"%0:\n%1".format([_688,s]):s;
}
function showException(e,_68b){
alert(exceptionText(e,_68b));
}
function alertAndThrow(m){
alert(m);
throw (m);
}
function glyph(name){
var g=config.glyphs;
var b=g.currBrowser;
if(b==null){
b=0;
while(b<g.browsers.length-1&&!g.browsers[b]()){
b++;
}
g.currBrowser=b;
}
if(!g.codes[name]){
return "";
}
return g.codes[name][b];
}
function createTiddlyText(_690,text){
return _690.appendChild(document.createTextNode(text));
}
function createTiddlyCheckbox(_692,_693,_694,_695){
var cb=document.createElement("input");
cb.setAttribute("type","checkbox");
cb.onclick=_695;
_692.appendChild(cb);
cb.checked=_694;
cb.className="chkOptionInput";
if(_693){
wikify(_693,_692);
}
return cb;
}
function createTiddlyElement(_697,_698,id,_69a,text,_69c){
var n,e=document.createElement(_698);
if(_69a!=null){
e.className=_69a;
}
if(id!=null){
e.setAttribute("id",id);
}
if(text!=null){
e.appendChild(document.createTextNode(text));
}
if(_69c){
for(n in _69c){
e.setAttribute(n,_69c[n]);
}
}
if(_697!=null){
_697.appendChild(e);
}
return e;
}
function createTiddlyButton(_69f,text,_6a1,_6a2,_6a3,id,_6a5,_6a6){
var i,btn=document.createElement("a");
btn.setAttribute("href","javascript:;");
if(_6a2){
btn.onclick=_6a2;
}
if(_6a1){
btn.setAttribute("title",_6a1);
}
if(text){
btn.appendChild(document.createTextNode(text));
}
btn.className=_6a3||"button";
if(id){
btn.id=id;
}
if(_6a6){
for(i in _6a6){
btn.setAttribute(i,_6a6[i]);
}
}
if(_69f){
_69f.appendChild(btn);
}
if(_6a5){
btn.setAttribute("accessKey",_6a5);
}
return btn;
}
function createExternalLink(_6a9,url,_6ab){
var link=document.createElement("a");
link.className="externalLink";
link.href=url;
var f=config.messages.externalLinkTooltip;
link.title=f?f.format([url]):url;
if(config.options.chkOpenInNewWindow){
link.target="_blank";
}
_6a9.appendChild(link);
if(_6ab){
createTiddlyText(link,_6ab);
}
return link;
}
function getTiddlyLinkInfo(_6ae,_6af){
var _6b0=_6af?_6af.split(" "):[];
_6b0.pushUnique("tiddlyLink");
var _6b1=store.fetchTiddler(_6ae);
var _6b2;
if(_6b1){
_6b2=_6b1.getSubtitle();
_6b0.pushUnique("tiddlyLinkExisting");
_6b0.remove("tiddlyLinkNonExisting");
_6b0.remove("shadow");
}else{
var f;
_6b0.remove("tiddlyLinkExisting");
_6b0.pushUnique("tiddlyLinkNonExisting");
if(store.isShadowTiddler(_6ae)){
f=config.messages.shadowedTiddlerToolTip;
_6b0.pushUnique("shadow");
}else{
f=config.messages.undefinedTiddlerToolTip;
_6b0.remove("shadow");
}
_6b2=f?f.format([_6ae]):"";
}
if(typeof config.annotations[_6ae]=="string"){
_6b2=config.annotations[_6ae];
}
return {classes:_6b0.join(" "),subTitle:_6b2};
}
function onClickTiddlerLink(ev){
var e=ev||window.event;
var _6b6=resolveTarget(e);
var link=_6b6;
var _6b8=null;
var _6b9=null;
var _6ba=null;
do{
_6b8=link.getAttribute("tiddlyLink");
_6b9=link.getAttribute("tiddlyFields");
_6ba=link.getAttribute("noToggle");
link=link.parentNode;
}while(_6b8==null&&link!=null);
if(!store.isShadowTiddler(_6b8)){
var f=_6b9?_6b9.decodeHashMap():{};
_6b9=String.encodeHashMap(merge(f,config.defaultCustomFields,true));
}
if(_6b8){
var _6bc=e.metaKey||e.ctrlKey;
if(config.options.chkToggleLinks){
_6bc=!_6bc;
}
if(_6ba){
_6bc=false;
}
if(store.getTiddler(_6b8)){
_6b9=null;
}
story.displayTiddler(_6b6,_6b8,null,true,null,_6b9,_6bc);
}
clearMessage();
return false;
}
function createTiddlyLink(_6bd,_6be,_6bf,_6c0,_6c1,_6c2,_6c3){
var _6be=jQuery.trim(_6be);
var text=_6bf?_6be:null;
var i=getTiddlyLinkInfo(_6be,_6c0);
var btn=_6c1?createExternalLink(_6bd,store.getTiddlerText("SiteUrl",null)+"#"+_6be):createTiddlyButton(_6bd,text,i.subTitle,onClickTiddlerLink,i.classes);
if(_6c1){
btn.className+=" "+_6c0;
}
btn.setAttribute("refresh","link");
btn.setAttribute("tiddlyLink",_6be);
if(_6c3){
btn.setAttribute("noToggle","true");
}
if(_6c2){
var _6c7=_6c2.getInheritedFields();
if(_6c7){
btn.setAttribute("tiddlyFields",_6c7);
}
}
return btn;
}
function refreshTiddlyLink(e,_6c9){
var i=getTiddlyLinkInfo(_6c9,e.className);
e.className=i.classes;
e.title=i.subTitle;
}
function createTiddlyDropDown(_6cb,_6cc,_6cd,_6ce){
var sel=createTiddlyElement(_6cb,"select");
sel.onchange=_6cc;
var t;
for(t=0;t<_6cd.length;t++){
var e=createTiddlyElement(sel,"option",null,null,_6cd[t].caption);
e.value=_6cd[t].name;
if(_6cd[t].name==_6ce){
e.selected=true;
}
}
return sel;
}
function onClickTagOpenAll(ev){
var _6d3=store.getTaggedTiddlers(this.getAttribute("tag"));
var _6d4=this.getAttribute("sortby");
if(_6d4&&_6d4.length){
store.sortTiddlers(_6d3,_6d4);
}
story.displayTiddlers(this,_6d3);
return false;
}
function onClickTag(ev){
var e=ev||window.event;
var _6d7=Popup.create(this);
jQuery(_6d7).addClass("taggedTiddlerList");
var tag=this.getAttribute("tag");
var _6d9=this.getAttribute("tiddler");
if(_6d7&&tag){
var _6da=tag.indexOf("[")==-1?store.getTaggedTiddlers(tag):store.filterTiddlers(tag);
var _6db=this.getAttribute("sortby");
if(_6db&&_6db.length){
store.sortTiddlers(_6da,_6db);
}
var _6dc=[];
var r;
for(r=0;r<_6da.length;r++){
if(_6da[r].title!=_6d9){
_6dc.push(_6da[r].title);
}
}
var _6de=config.views.wikified.tag;
if(_6dc.length>0){
var _6df=createTiddlyButton(createTiddlyElement(_6d7,"li"),_6de.openAllText.format([tag]),_6de.openAllTooltip,onClickTagOpenAll);
_6df.setAttribute("tag",tag);
_6df.setAttribute("sortby",_6db);
createTiddlyElement(createTiddlyElement(_6d7,"li",null,"listBreak"),"div");
for(r=0;r<_6dc.length;r++){
createTiddlyLink(createTiddlyElement(_6d7,"li"),_6dc[r],true);
}
}else{
createTiddlyElement(_6d7,"li",null,"disabled",_6de.popupNone.format([tag]));
}
createTiddlyElement(createTiddlyElement(_6d7,"li",null,"listBreak"),"div");
var h=createTiddlyLink(createTiddlyElement(_6d7,"li"),tag,false);
createTiddlyText(h,_6de.openTag.format([tag]));
}
Popup.show();
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
return false;
}
function createTagButton(_6e1,tag,_6e3,_6e4,_6e5){
var btn=createTiddlyButton(_6e1,_6e4||tag,(_6e5||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
btn.setAttribute("tag",tag);
if(_6e3){
btn.setAttribute("tiddler",_6e3);
}
return btn;
}
function onClickTiddlyPopup(ev){
var e=ev||window.event;
var _6e9=this.tiddler;
if(_6e9.text){
var _6ea=Popup.create(this,"div","popupTiddler");
wikify(_6e9.text,_6ea,null,_6e9);
Popup.show();
}
if(e){
e.cancelBubble=true;
}
if(e&&e.stopPropagation){
e.stopPropagation();
}
return false;
}
function createTiddlyPopup(_6eb,_6ec,_6ed,_6ee){
if(_6ee.text){
createTiddlyLink(_6eb,_6ec,true);
var btn=createTiddlyButton(_6eb,glyph("downArrow"),_6ed,onClickTiddlyPopup,"tiddlerPopupButton");
btn.tiddler=_6ee;
}else{
createTiddlyText(_6eb,_6ec);
}
}
function onClickError(ev){
var e=ev||window.event;
var _6f2=Popup.create(this);
var _6f3=this.getAttribute("errorText").split("\n");
var t;
for(t=0;t<_6f3.length;t++){
createTiddlyElement(_6f2,"li",null,null,_6f3[t]);
}
Popup.show();
e.cancelBubble=true;
if(e.stopPropagation){
e.stopPropagation();
}
return false;
}
function createTiddlyError(_6f5,_6f6,text){
var btn=createTiddlyButton(_6f5,_6f6,null,onClickError,"errorButton");
if(text){
btn.setAttribute("errorText",text);
}
}
function Animator(){
this.running=0;
this.timerID=0;
this.animations=[];
return this;
}
Animator.prototype.startAnimating=function(){
var t;
for(t=0;t<arguments.length;t++){
this.animations.push(arguments[t]);
}
if(this.running==0){
var me=this;
this.timerID=window.setInterval(function(){
me.doAnimate(me);
},10);
}
this.running+=arguments.length;
};
Animator.prototype.doAnimate=function(me){
var a=0;
while(a<me.animations.length){
var _6fd=me.animations[a];
if(_6fd.tick()){
a++;
}else{
me.animations.splice(a,1);
if(--me.running==0){
window.clearInterval(me.timerID);
}
}
}
};
Animator.slowInSlowOut=function(_6fe){
return (1-((Math.cos(_6fe*Math.PI)+1)/2));
};
function Morpher(_6ff,_700,_701,_702){
this.element=_6ff;
this.duration=_700;
this.properties=_701;
this.startTime=new Date();
this.endTime=Number(this.startTime)+_700;
this.callback=_702;
this.tick();
return this;
}
Morpher.prototype.assignStyle=function(_703,_704,_705){
switch(_704){
case "-tw-vertScroll":
window.scrollTo(findScrollX(),_705);
break;
case "-tw-horizScroll":
window.scrollTo(_705,findScrollY());
break;
default:
_703.style[_704]=_705;
break;
}
};
Morpher.prototype.stop=function(){
var t;
for(t=0;t<this.properties.length;t++){
var p=this.properties[t];
if(p.atEnd!==undefined){
this.assignStyle(this.element,p.style,p.atEnd);
}
}
if(this.callback){
this.callback(this.element,this.properties);
}
};
Morpher.prototype.tick=function(){
var _708=Number(new Date());
var t,_70a=Animator.slowInSlowOut(Math.min(1,(_708-this.startTime)/this.duration));
for(t=0;t<this.properties.length;t++){
var p=this.properties[t];
if(p.start!==undefined&&p.end!==undefined){
var _70c=p.template||"%0";
switch(p.format){
case undefined:
case "style":
var v=p.start+(p.end-p.start)*_70a;
this.assignStyle(this.element,p.style,_70c.format([v]));
break;
case "color":
break;
}
}
}
if(_708>=this.endTime){
this.stop();
return false;
}
return true;
};
function Zoomer(text,_70f,_710,_711){
var e=createTiddlyElement(document.body,"div",null,"zoomer");
createTiddlyElement(e,"div",null,null,text);
var _713=findWindowWidth();
var _714=findWindowHeight();
var p=[{style:"left",start:findPosX(_70f),end:findPosX(_710),template:"%0px"},{style:"top",start:findPosY(_70f),end:findPosY(_710),template:"%0px"},{style:"width",start:Math.min(_70f.scrollWidth,_713),end:Math.min(_710.scrollWidth,_713),template:"%0px",atEnd:"auto"},{style:"height",start:Math.min(_70f.scrollHeight,_714),end:Math.min(_710.scrollHeight,_714),template:"%0px",atEnd:"auto"},{style:"fontSize",start:8,end:24,template:"%0pt"}];
var c=function(_717,_718){
jQuery(_717).remove();
};
return new Morpher(e,config.animDuration,p,c);
}
function Scroller(_719){
var p=[{style:"-tw-vertScroll",start:findScrollY(),end:ensureVisible(_719)}];
return new Morpher(_719,config.animDuration,p);
}
function Slider(_71b,_71c,_71d,_71e){
_71b.style.overflow="hidden";
if(_71c){
_71b.style.height="0px";
}
_71b.style.display="block";
var _71f=_71b.scrollHeight;
var p=[];
var c=null;
if(_71c){
p.push({style:"height",start:0,end:_71f,template:"%0px",atEnd:"auto"});
p.push({style:"opacity",start:0,end:1,template:"%0"});
p.push({style:"filter",start:0,end:100,template:"alpha(opacity:%0)"});
}else{
p.push({style:"height",start:_71f,end:0,template:"%0px"});
p.push({style:"display",atEnd:"none"});
p.push({style:"opacity",start:1,end:0,template:"%0"});
p.push({style:"filter",start:100,end:0,template:"alpha(opacity:%0)"});
switch(_71e){
case "all":
c=function(_722,_723){
jQuery(_722).remove();
};
break;
case "children":
c=function(_724,_725){
jQuery(_724).empty();
};
break;
}
}
return new Morpher(_71b,config.animDuration,p,c);
}
var Popup={stack:[]};
Popup.create=function(root,elem,_728){
var _729=this.find(root,"popup");
Popup.remove(_729+1);
var _72a=createTiddlyElement(document.body,elem||"ol","popup",_728||"popup");
_72a.stackPosition=_729;
Popup.stack.push({root:root,popup:_72a});
return _72a;
};
Popup.onDocumentClick=function(ev){
var e=ev||window.event;
if(e.eventPhase==undefined){
Popup.remove();
}else{
if(e.eventPhase==Event.BUBBLING_PHASE||e.eventPhase==Event.AT_TARGET){
Popup.remove();
}
}
return true;
};
Popup.show=function(_72d,_72e,_72f){
var curr=Popup.stack[Popup.stack.length-1];
this.place(curr.root,curr.popup,_72d,_72e,_72f);
jQuery(curr.root).addClass("highlight");
if(config.options.chkAnimate&&anim&&typeof Scroller=="function"){
anim.startAnimating(new Scroller(curr.popup));
}else{
window.scrollTo(0,ensureVisible(curr.popup));
}
};
Popup.place=function(root,_732,_733,_734,_735){
if(!_735){
_735={x:0,y:0};
}
if(_732.stackPosition>=0&&!_733&&!_734){
_735.x=_735.x+root.offsetWidth;
}else{
_735.x=(_734=="right")?_735.x+root.offsetWidth:_735.x;
_735.y=(_733=="top")?_735.y:_735.y+root.offsetHeight;
}
var _736=findPosX(root);
var _737=findPosY(root);
var _738=_736+_735.x;
var _739=_737+_735.y;
var _73a=findWindowWidth();
if(_732.offsetWidth>_73a*0.75){
_732.style.width=_73a*0.75+"px";
}
var _73b=_732.offsetWidth;
var _73c=_73a-document.body.offsetWidth;
if(_738+_73b>_73a-_73c-1){
if(_734=="right"){
_738=_738-root.offsetWidth-_73b;
}else{
_738=_73a-_73b-_73c-1;
}
}
_732.style.left=_738+"px";
_732.style.top=_739+"px";
_732.style.display="block";
};
Popup.find=function(e){
var t,pos=-1;
for(t=this.stack.length-1;t>=0;t--){
if(isDescendant(e,this.stack[t].popup)){
pos=t;
}
}
return pos;
};
Popup.remove=function(pos){
if(!pos){
pos=0;
}
if(Popup.stack.length>pos){
Popup.removeFrom(pos);
}
};
Popup.removeFrom=function(from){
var t;
for(t=Popup.stack.length-1;t>=from;t--){
var p=Popup.stack[t];
jQuery(p.root).removeClass("highlight");
jQuery(p.popup).remove();
}
Popup.stack=Popup.stack.slice(0,from);
};
function Wizard(elem){
if(elem){
this.formElem=findRelated(elem,"wizard","className");
this.bodyElem=findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
this.footElem=findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
}else{
this.formElem=null;
this.bodyElem=null;
this.footElem=null;
}
}
Wizard.prototype.setValue=function(name,_746){
jQuery(this.formElem).data(name,_746);
};
Wizard.prototype.getValue=function(name){
return this.formElem?jQuery(this.formElem).data(name):null;
};
Wizard.prototype.createWizard=function(_748,_749){
this.formElem=createTiddlyElement(_748,"form",null,"wizard");
createTiddlyElement(this.formElem,"h1",null,null,_749);
this.bodyElem=createTiddlyElement(this.formElem,"div",null,"wizardBody");
this.footElem=createTiddlyElement(this.formElem,"div",null,"wizardFooter");
return this.formElem;
};
Wizard.prototype.clear=function(){
jQuery(this.bodyElem).empty();
};
Wizard.prototype.setButtons=function(_74a,_74b){
jQuery(this.footElem).empty();
var t;
for(t=0;t<_74a.length;t++){
createTiddlyButton(this.footElem,_74a[t].caption,_74a[t].tooltip,_74a[t].onClick);
insertSpacer(this.footElem);
}
if(typeof _74b=="string"){
createTiddlyElement(this.footElem,"span",null,"status",_74b);
}
};
Wizard.prototype.addStep=function(_74d,html){
jQuery(this.bodyElem).empty();
var w=createTiddlyElement(this.bodyElem,"div");
createTiddlyElement(w,"h2",null,null,_74d);
var step=createTiddlyElement(w,"div",null,"wizardStep");
step.innerHTML=html;
applyHtmlMacros(step,tiddler);
};
Wizard.prototype.getElement=function(name){
return this.formElem.elements[name];
};
var ListView={};
ListView.create=function(_752,_753,_754,_755,_756){
var _757=createTiddlyElement(_752,"table",null,_756||"listView twtable");
var _758=createTiddlyElement(_757,"thead");
var t,r=createTiddlyElement(_758,"tr");
for(t=0;t<_754.columns.length;t++){
var _75b=_754.columns[t];
var c=createTiddlyElement(r,"th");
var _75d=ListView.columnTypes[_75b.type];
if(_75d&&_75d.createHeader){
_75d.createHeader(c,_75b,t);
if(_75b.className){
jQuery(c).addClass(_75b.className);
}
}
}
var rc,_75f=createTiddlyElement(_757,"tbody");
for(rc=0;rc<_753.length;rc++){
var _760=_753[rc];
r=createTiddlyElement(_75f,"tr");
for(c=0;c<_754.rowClasses.length;c++){
if(_760[_754.rowClasses[c].field]){
jQuery(r).addClass(_754.rowClasses[c].className);
}
}
_760.rowElement=r;
_760.colElements={};
var cc;
for(cc=0;cc<_754.columns.length;cc++){
c=createTiddlyElement(r,"td");
_75b=_754.columns[cc];
var _762=_75b.field;
_75d=ListView.columnTypes[_75b.type];
if(_75d&&_75d.createItem){
_75d.createItem(c,_760,_762,_75b,cc,rc);
if(_75b.className){
jQuery(c).addClass(_75b.className);
}
}
_760.colElements[_762]=c;
}
}
if(_755&&_754.actions){
createTiddlyDropDown(_752,ListView.getCommandHandler(_755),_754.actions);
}
if(_755&&_754.buttons){
for(t=0;t<_754.buttons.length;t++){
var a=_754.buttons[t];
if(a&&a.name!=""){
createTiddlyButton(_752,a.caption,null,ListView.getCommandHandler(_755,a.name,a.allowEmptySelection));
}
}
}
return _757;
};
ListView.getCommandHandler=function(_764,name,_766){
return function(e){
var view=findRelated(this,"TABLE",null,"previousSibling");
var _769=[];
ListView.forEachSelector(view,function(e,_76b){
if(e.checked){
_769.push(_76b);
}
});
if(_769.length==0&&!_766){
alert(config.messages.nothingSelected);
}else{
if(this.nodeName.toLowerCase()=="select"){
_764(view,this.value,_769);
this.selectedIndex=0;
}else{
_764(view,name,_769);
}
}
};
};
ListView.forEachSelector=function(view,_76d){
var _76e=view.getElementsByTagName("input");
var t,_770=false;
for(t=0;t<_76e.length;t++){
var cb=_76e[t];
if(cb.getAttribute("type")=="checkbox"){
var rn=cb.getAttribute("rowName");
if(rn){
_76d(cb,rn);
_770=true;
}
}
}
return _770;
};
ListView.getSelectedRows=function(view){
var _774=[];
ListView.forEachSelector(view,function(e,_776){
if(e.checked){
_774.push(_776);
}
});
return _774;
};
ListView.columnTypes={};
ListView.columnTypes.String={createHeader:function(_777,_778,col){
createTiddlyText(_777,_778.title);
},createItem:function(_77a,_77b,_77c,_77d,col,row){
var v=_77b[_77c];
if(v!=undefined){
createTiddlyText(_77a,v);
}
}};
ListView.columnTypes.WikiText={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_781,_782,_783,_784,col,row){
var v=_782[_783];
if(v!=undefined){
wikify(v,_781,null,null);
}
}};
ListView.columnTypes.Tiddler={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_788,_789,_78a,_78b,col,row){
var v=_789[_78a];
if(v!=undefined&&v.title){
createTiddlyPopup(_788,v.title,config.messages.listView.tiddlerTooltip,v);
}
}};
ListView.columnTypes.Size={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_78f,_790,_791,_792,col,row){
var msg=config.messages.sizeTemplates;
var v=_790[_791];
if(v!=undefined){
var t=0;
while(t<msg.length-1&&v<msg[t].unit){
t++;
}
createTiddlyText(_78f,msg[t].template.format([Math.round(v/msg[t].unit)]));
}
}};
ListView.columnTypes.Link={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_798,_799,_79a,_79b,col,row){
var v=_799[_79a];
var c=_79b.text;
if(v!=undefined){
createExternalLink(_798,v,c||v);
}
}};
ListView.columnTypes.Date={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7a0,_7a1,_7a2,_7a3,col,row){
var v=_7a1[_7a2];
if(v!=undefined){
createTiddlyText(_7a0,v.formatString(_7a3.dateFormat));
}
}};
ListView.columnTypes.StringList={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7a7,_7a8,_7a9,_7aa,col,row){
var v=_7a8[_7a9];
if(v!=undefined){
var t;
for(t=0;t<v.length;t++){
createTiddlyText(_7a7,v[t]);
createTiddlyElement(_7a7,"br");
}
}
}};
ListView.columnTypes.Selector={createHeader:function(_7af,_7b0,col){
createTiddlyCheckbox(_7af,null,false,this.onHeaderChange);
},createItem:function(_7b2,_7b3,_7b4,_7b5,col,row){
var e=createTiddlyCheckbox(_7b2,null,_7b3[_7b4],null);
e.setAttribute("rowName",_7b3[_7b5.rowName]);
},onHeaderChange:function(e){
var _7ba=this.checked;
var view=findRelated(this,"TABLE");
if(!view){
return;
}
ListView.forEachSelector(view,function(e,_7bd){
e.checked=_7ba;
});
}};
ListView.columnTypes.Tags={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7be,_7bf,_7c0,_7c1,col,row){
var tags=_7bf[_7c0];
createTiddlyText(_7be,String.encodeTiddlyLinkList(tags));
}};
ListView.columnTypes.Boolean={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7c5,_7c6,_7c7,_7c8,col,row){
if(_7c6[_7c7]==true){
createTiddlyText(_7c5,_7c8.trueText);
}
if(_7c6[_7c7]==false){
createTiddlyText(_7c5,_7c8.falseText);
}
}};
ListView.columnTypes.TagCheckbox={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7cb,_7cc,_7cd,_7ce,col,row){
var e=createTiddlyCheckbox(_7cb,null,_7cc[_7cd],this.onChange);
e.setAttribute("tiddler",_7cc.title);
e.setAttribute("tag",_7ce.tag);
},onChange:function(e){
var tag=this.getAttribute("tag");
var _7d4=this.getAttribute("tiddler");
store.setTiddlerTag(_7d4,this.checked,tag);
}};
ListView.columnTypes.TiddlerLink={createHeader:ListView.columnTypes.String.createHeader,createItem:function(_7d5,_7d6,_7d7,_7d8,col,row){
var v=_7d6[_7d7];
if(v!=undefined){
var link=createTiddlyLink(_7d5,_7d6[_7d8.tiddlerLink],false,null);
createTiddlyText(link,_7d6[_7d7]);
}
}};
if(!Array.indexOf){
Array.prototype.indexOf=function(item,from){
if(!from){
from=0;
}
var i;
for(i=from;i<this.length;i++){
if(this[i]===item){
return i;
}
}
return -1;
};
}
Array.prototype.findByField=function(_7e0,_7e1){
var t;
for(t=0;t<this.length;t++){
if(this[t][_7e0]===_7e1){
return t;
}
}
return null;
};
Array.prototype.contains=function(item){
return this.indexOf(item)!=-1;
};
Array.prototype.setItem=function(_7e4,mode){
var p=this.indexOf(_7e4);
if(mode==0){
mode=(p==-1)?+1:-1;
}
if(mode==+1){
if(p==-1){
this.push(_7e4);
}
}else{
if(mode==-1){
if(p!=-1){
this.splice(p,1);
}
}
}
};
Array.prototype.containsAny=function(_7e7){
var i;
for(i=0;i<_7e7.length;i++){
if(this.indexOf(_7e7[i])!=-1){
return true;
}
}
return false;
};
Array.prototype.containsAll=function(_7e9){
var i;
for(i=0;i<_7e9.length;i++){
if(this.indexOf(_7e9[i])==-1){
return false;
}
}
return true;
};
Array.prototype.pushUnique=function(item,_7ec){
if(_7ec===false){
this.push(item);
}else{
if(this.indexOf(item)==-1){
this.push(item);
}
}
};
Array.prototype.remove=function(item){
var p=this.indexOf(item);
if(p!=-1){
this.splice(p,1);
}
};
if(!Array.prototype.map){
Array.prototype.map=function(fn,_7f0){
var _7f1=_7f0||window;
var i,j,a=[];
for(i=0,j=this.length;i<j;++i){
a.push(fn.call(_7f1,this[i],i,this));
}
return a;
};
}
String.prototype.right=function(n){
return n<this.length?this.slice(this.length-n):this;
};
String.prototype.trim=function(){
return this.replace(/^\s*|\s*$/g,"");
};
String.prototype.unDash=function(){
var t,s=this.split("-");
if(s.length>1){
for(t=1;t<s.length;t++){
s[t]=s[t].substr(0,1).toUpperCase()+s[t].substr(1);
}
}
return s.join("");
};
String.prototype.format=function(s){
var _7f9=s&&s.constructor==Array?s:arguments;
var _7fa=/(?:%(\d+))/mg;
var _7fb=0;
var _7fc,r=[];
do{
_7fc=_7fa.exec(this);
if(_7fc&&_7fc[1]){
if(_7fc.index>_7fb){
r.push(this.substring(_7fb,_7fc.index));
}
r.push(_7f9[parseInt(_7fc[1],10)]);
_7fb=_7fa.lastIndex;
}
}while(_7fc);
if(_7fb<this.length){
r.push(this.substring(_7fb,this.length));
}
return r.join("");
};
String.prototype.escapeRegExp=function(){
var s="\\^$*+?()=!|,{}[].";
var t,c=this;
for(t=0;t<s.length;t++){
c=c.replace(new RegExp("\\"+s.substr(t,1),"g"),"\\"+s.substr(t,1));
}
return c;
};
String.prototype.escapeLineBreaks=function(){
return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};
String.prototype.unescapeLineBreaks=function(){
return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};
String.prototype.htmlEncode=function(){
return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};
String.prototype.htmlDecode=function(){
return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};
String.prototype.parseParams=function(_801,_802,_803,_804,_805){
var _806=function(_807,p){
var n;
if(_807[p]){
n=_807[p];
}else{
if(_807[p+1]){
n=_807[p+1];
}else{
if(_807[p+2]){
n=_807[p+2];
}else{
if(_807[p+3]){
try{
n=_807[p+3];
if(_803&&config.evaluateMacroParameters!="none"){
if(config.evaluateMacroParameters=="restricted"){
if(window.restrictedEval){
n=window.restrictedEval(n);
}
}else{
n=window.eval(n);
}
}
}
catch(ex){
throw "Unable to evaluate {{"+_807[p+3]+"}}: "+exceptionText(ex);
}
}else{
if(_807[p+4]){
n=_807[p+4];
}else{
if(_807[p+5]){
n="";
}
}
}
}
}
}
return n;
};
var r=[{}];
var _80b="(?:\"((?:(?:\\\\\")|[^\"])+)\")";
var _80c="(?:'((?:(?:\\\\')|[^'])+)')";
var _80d="(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
var _80e="(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
var _80f=_804?"([^\"'\\s]\\S*)":"([^\"':\\s][^\\s:]*)";
var _810="((?:\"\")|(?:''))";
var _811="(?:\\s*)";
var _812="(?:"+_80b+"|"+_80c+"|"+_80d+"|"+_80e+"|"+_80f+"|"+_810+")";
var re=_804?new RegExp(_812,"mg"):new RegExp(_811+_812+_811+"(?:(\\:)"+_811+_812+")?","mg");
var _814;
do{
_814=re.exec(this);
if(_814){
var n=_806(_814,1);
if(_804){
r.push({name:"",value:n});
}else{
var v=_806(_814,8);
if(v==null&&_801){
v=n;
n=_801;
}else{
if(v==null&&_802){
v=_802;
}
}
r.push({name:n,value:v});
if(_805){
_801=n;
_802=v;
}
}
}
}while(_814);
var t;
for(t=1;t<r.length;t++){
if(r[0][r[t].name]){
r[0][r[t].name].push(r[t].value);
}else{
r[0][r[t].name]=[r[t].value];
}
}
return r;
};
String.prototype.readMacroParams=function(_818){
var p=this.parseParams("list",null,!_818,true);
var t,n=[];
for(t=1;t<p.length;t++){
n.push(p[t].value);
}
return n;
};
String.prototype.readBracketedList=function(_81c){
var p=this.parseParams("list",null,false,true);
var t,n=[];
for(t=1;t<p.length;t++){
if(p[t].value){
n.pushUnique(p[t].value,_81c);
}
}
return n;
};
String.prototype.getChunkRange=function(_820,end){
var s=this.indexOf(_820);
if(s!=-1){
s+=_820.length;
var e=this.indexOf(end,s);
if(e!=-1){
return [s,e];
}
}
};
String.prototype.replaceChunk=function(_824,end,sub){
var r=this.getChunkRange(_824,end);
return r?this.substring(0,r[0])+sub+this.substring(r[1]):this;
};
String.prototype.getChunk=function(_828,end){
var r=this.getChunkRange(_828,end);
if(r){
return this.substring(r[0],r[1]);
}
};
String.encodeTiddlyLink=function(_82b){
return _82b.indexOf(" ")==-1?_82b:"[["+_82b+"]]";
};
String.encodeTiddlyLinkList=function(list){
if(list){
var t,_82e=[];
for(t=0;t<list.length;t++){
_82e.push(String.encodeTiddlyLink(list[t]));
}
return _82e.join(" ");
}else{
return "";
}
};
String.prototype.decodeHashMap=function(){
var _82f=this.parseParams("anon","",false);
var t,r={};
for(t=1;t<_82f.length;t++){
r[_82f[t].name]=_82f[t].value;
}
return r;
};
String.encodeHashMap=function(_832){
var t,r=[];
for(t in _832){
r.push(t+":\""+_832[t]+"\"");
}
return r.join(" ");
};
String.zeroPad=function(n,d){
var s=n.toString();
if(s.length<d){
s="000000000000000000000000000".substr(0,d-s.length)+s;
}
return s;
};
String.prototype.startsWith=function(_838){
return !_838||this.substring(0,_838.length)==_838;
};
function getParam(_839,name,_83b){
if(!_839){
return _83b;
}
var p=_839[0][name];
return p?p[0]:_83b;
}
function getFlag(_83d,name,_83f){
return !!getParam(_83d,name,_83f);
}
Date.prototype.formatString=function(_840){
var t=_840.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
t=t.replace(/hh12/g,this.getHours12());
t=t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
t=t.replace(/hh/g,this.getHours());
t=t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
t=t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
t=t.replace(/mm/g,this.getMinutes());
t=t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
t=t.replace(/ss/g,this.getSeconds());
t=t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
t=t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
t=t.replace(/wYYYY/g,this.getYearForWeekNo());
t=t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
t=t.replace(/YYYY/g,this.getFullYear());
t=t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
t=t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
t=t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
t=t.replace(/MM/g,this.getMonth()+1);
t=t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
t=t.replace(/WW/g,this.getWeek());
t=t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
t=t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
t=t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
t=t.replace(/DDth/g,this.getDate()+this.daySuffix());
t=t.replace(/DD/g,this.getDate());
var tz=this.getTimezoneOffset();
var atz=Math.abs(tz);
t=t.replace(/TZD/g,(tz<0?"+":"-")+String.zeroPad(Math.floor(atz/60),2)+":"+String.zeroPad(atz%60,2));
t=t.replace(/\\/g,"");
return t;
};
Date.prototype.getWeek=function(){
var dt=new Date(this.getTime());
var d=dt.getDay();
if(d==0){
d=7;
}
dt.setTime(dt.getTime()+(4-d)*86400000);
var n=Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
return Math.floor(n/7)+1;
};
Date.prototype.getYearForWeekNo=function(){
var dt=new Date(this.getTime());
var d=dt.getDay();
if(d==0){
d=7;
}
dt.setTime(dt.getTime()+(4-d)*86400000);
return dt.getFullYear();
};
Date.prototype.getHours12=function(){
var h=this.getHours();
return h>12?h-12:(h>0?h:12);
};
Date.prototype.getAmPm=function(){
return this.getHours()>=12?config.messages.dates.pm:config.messages.dates.am;
};
Date.prototype.daySuffix=function(){
return config.messages.dates.daySuffixes[this.getDate()-1];
};
Date.prototype.convertToLocalYYYYMMDDHHMM=function(){
return this.getFullYear()+String.zeroPad(this.getMonth()+1,2)+String.zeroPad(this.getDate(),2)+String.zeroPad(this.getHours(),2)+String.zeroPad(this.getMinutes(),2);
};
Date.prototype.convertToYYYYMMDDHHMM=function(){
return this.getUTCFullYear()+String.zeroPad(this.getUTCMonth()+1,2)+String.zeroPad(this.getUTCDate(),2)+String.zeroPad(this.getUTCHours(),2)+String.zeroPad(this.getUTCMinutes(),2);
};
Date.prototype.convertToYYYYMMDDHHMMSSMMM=function(){
return this.getUTCFullYear()+String.zeroPad(this.getUTCMonth()+1,2)+String.zeroPad(this.getUTCDate(),2)+"."+String.zeroPad(this.getUTCHours(),2)+String.zeroPad(this.getUTCMinutes(),2)+String.zeroPad(this.getUTCSeconds(),2)+String.zeroPad(this.getUTCMilliseconds(),3)+"0";
};
Date.convertFromYYYYMMDDHHMM=function(d){
d=d?d.replace(/[^0-9]/g,""):"";
return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};
Date.convertFromYYYYMMDDHHMMSS=function(d){
d=d?d.replace(/[^0-9]/g,""):"";
return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};
Date.convertFromYYYYMMDDHHMMSSMMM=function(d){
d=d?d.replace(/[^0-9]/g,""):"";
return new Date(Date.UTC(parseInt(d.substr(0,4),10),parseInt(d.substr(4,2),10)-1,parseInt(d.substr(6,2),10),parseInt(d.substr(8,2)||"00",10),parseInt(d.substr(10,2)||"00",10),parseInt(d.substr(12,2)||"00",10),parseInt(d.substr(14,3)||"000",10)));
};
function RGB(r,g,b){
this.r=0;
this.g=0;
this.b=0;
if(typeof r=="string"){
if(r.substr(0,1)=="#"){
if(r.length==7){
this.r=parseInt(r.substr(1,2),16)/255;
this.g=parseInt(r.substr(3,2),16)/255;
this.b=parseInt(r.substr(5,2),16)/255;
}else{
this.r=parseInt(r.substr(1,1),16)/15;
this.g=parseInt(r.substr(2,1),16)/15;
this.b=parseInt(r.substr(3,1),16)/15;
}
}else{
var _850=/rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
var c=r.match(_850);
if(c){
this.r=parseInt(c[1],10)/255;
this.g=parseInt(c[2],10)/255;
this.b=parseInt(c[3],10)/255;
}
}
}else{
this.r=r;
this.g=g;
this.b=b;
}
return this;
}
RGB.prototype.mix=function(c,f){
return new RGB(this.r+(c.r-this.r)*f,this.g+(c.g-this.g)*f,this.b+(c.b-this.b)*f);
};
RGB.prototype.toString=function(){
var _854=function(x,min,max){
return x<min?min:(x>max?max:x);
};
return "#"+("0"+Math.floor(_854(this.r,0,1)*255).toString(16)).right(2)+("0"+Math.floor(_854(this.g,0,1)*255).toString(16)).right(2)+("0"+Math.floor(_854(this.b,0,1)*255).toString(16)).right(2);
};
function drawGradient(_858,_859,_85a,_85b){
if(!_85b){
_85b=_85a;
}
var t;
for(t=0;t<=100;t+=2){
var bar=document.createElement("div");
_858.appendChild(bar);
bar.style.position="absolute";
bar.style.left=_859?t+"%":0;
bar.style.top=_859?0:t+"%";
bar.style.width=_859?(101-t)+"%":"100%";
bar.style.height=_859?"100%":(101-t)+"%";
bar.style.zIndex=-1;
var p=t/100*(_85a.length-1);
var hc=_85b[Math.floor(p)];
if(typeof hc=="string"){
hc=new RGB(hc);
}
var lc=_85a[Math.ceil(p)];
if(typeof lc=="string"){
lc=new RGB(lc);
}
bar.style.backgroundColor=hc.mix(lc,p-Math.floor(p)).toString();
}
}
function addEvent(obj,type,fn){
if(obj.attachEvent){
obj["e"+type+fn]=fn;
obj[type+fn]=function(){
obj["e"+type+fn](window.event);
};
obj.attachEvent("on"+type,obj[type+fn]);
}else{
obj.addEventListener(type,fn,false);
}
}
function removeEvent(obj,type,fn){
if(obj.detachEvent){
obj.detachEvent("on"+type,obj[type+fn]);
obj[type+fn]=null;
}else{
obj.removeEventListener(type,fn,false);
}
}
function findRelated(e,_868,name,_86a){
name=name||"tagName";
_86a=_86a||"parentNode";
if(name=="className"){
while(e&&!jQuery(e).hasClass(_868)){
e=e[_86a];
}
}else{
while(e&&e[name]!=_868){
e=e[_86a];
}
}
return e;
}
function ensureVisible(e){
var _86c=findPosY(e);
var _86d=_86c+e.offsetHeight;
var _86e=findScrollY();
var _86f=findWindowHeight();
var _870=_86e+_86f;
if(_86c<_86e){
return _86c;
}else{
if(_86d>_870){
if(e.offsetHeight<_86f){
return _86c-(_86f-e.offsetHeight);
}else{
return _86c;
}
}else{
return _86e;
}
}
}
function findWindowWidth(){
return window.innerWidth||document.documentElement.clientWidth;
}
function findWindowHeight(){
return window.innerHeight||document.documentElement.clientHeight;
}
function findDocHeight(){
var D=document;
return Math.max(Math.max(D.body.scrollHeight,D.documentElement.scrollHeight),Math.max(D.body.offsetHeight,D.documentElement.offsetHeight),Math.max(D.body.clientHeight,D.documentElement.clientHeight));
}
function findScrollX(){
return window.scrollX||document.documentElement.scrollLeft;
}
function findScrollY(){
return window.scrollY||document.documentElement.scrollTop;
}
function findPosX(obj){
var _873=0;
while(obj.offsetParent){
_873+=obj.offsetLeft;
obj=obj.offsetParent;
}
return _873;
}
function findPosY(obj){
var _875=0;
while(obj.offsetParent){
_875+=obj.offsetTop;
obj=obj.offsetParent;
}
return _875;
}
function blurElement(e){
if(e&&e.focus&&e.blur){
e.focus();
e.blur();
}
}
function insertSpacer(_877){
var e=document.createTextNode(String.fromCharCode(160));
if(_877){
_877.appendChild(e);
}
return e;
}
function replaceSelection(e,text){
if(e.setSelectionRange){
var _87b=e.selectionStart;
var _87c=e.selectionEnd>e.selectionStart;
e.value=e.value.substr(0,e.selectionStart)+text+e.value.substr(e.selectionEnd);
e.setSelectionRange(_87c?_87b:_87b+text.length,_87b+text.length);
var _87d=e.value.split("\n").length;
var _87e=e.value.substr(0,e.selectionStart).split("\n").length-1;
e.scrollTop=Math.floor((_87e-e.rows/2)*e.scrollHeight/_87d);
}else{
if(document.selection){
var _87f=document.selection.createRange();
if(_87f.parentElement()==e){
var _880=_87f.text=="";
_87f.text=text;
if(!_880){
_87f.moveStart("character",-text.length);
_87f.select();
}
}
}
}
}
function setCaretPosition(e,pos){
if(e.selectionStart||e.selectionStart=="0"){
e.selectionStart=pos;
e.selectionEnd=pos;
e.focus();
}else{
if(document.selection){
e.focus();
var sel=document.selection.createRange();
sel.moveStart("character",-e.value.length);
sel.moveStart("character",pos);
sel.moveEnd("character",0);
sel.select();
}
}
}
function getNodeText(e){
var t="";
while(e&&e.nodeName=="#text"){
t+=e.nodeValue;
e=e.nextSibling;
}
return t;
}
function isDescendant(e,_887){
while(e){
if(e===_887){
return true;
}
e=e.parentNode;
}
return false;
}
function stopEvent(e){
var ev=e||window.event;
ev.cancelBubble=true;
if(ev.stopPropagation){
ev.stopPropagation();
}
return false;
}
function scrubNode(e){
if(!config.browser.isIE){
return;
}
var att=e.attributes;
if(att){
var t;
for(t=0;t<att.length;t++){
var n=att[t].name;
if(n!=="style"&&(typeof e[n]==="function"||(typeof e[n]==="object"&&e[n]!=null))){
try{
e[n]=null;
}
catch(ex){
}
}
}
}
var c=e.firstChild;
while(c){
scrubNode(c);
c=c.nextSibling;
}
}
function setStylesheet(s,id,doc){
jQuery.twStylesheet(s,{id:id,doc:doc});
}
function removeStyleSheet(id){
jQuery.twStylesheet.remove({id:id});
}
function LoaderBase(){
}
LoaderBase.prototype.loadTiddler=function(_893,node,_895){
var _896=this.getTitle(_893,node);
if(safeMode&&_893.isShadowTiddler(_896)){
return;
}
if(_896){
var _897=_893.createTiddler(_896);
this.internalizeTiddler(_893,_897,_896,node);
_895.push(_897);
}
};
LoaderBase.prototype.loadTiddlers=function(_898,_899){
var t,_89b=[];
for(t=0;t<_899.length;t++){
try{
this.loadTiddler(_898,_899[t],_89b);
}
catch(ex){
showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(_898,_899[t])]));
}
}
return _89b;
};
function SaverBase(){
}
SaverBase.prototype.externalize=function(_89c){
var _89d=[];
var t,_89f=_89c.getTiddlers("title");
for(t=0;t<_89f.length;t++){
if(!_89f[t].doNotSave()){
_89d.push(this.externalizeTiddler(_89c,_89f[t]));
}
}
return _89d.join("\n");
};
function TW21Loader(){
}
TW21Loader.prototype=new LoaderBase();
TW21Loader.prototype.getTitle=function(_8a0,node){
var _8a2=null;
if(node.getAttribute){
_8a2=node.getAttribute("title");
if(!_8a2){
_8a2=node.getAttribute("tiddler");
}
}
if(!_8a2&&node.id){
var _8a3=_8a0.idPrefix.length;
if(node.id.substr(0,_8a3)==_8a0.idPrefix){
_8a2=node.id.substr(_8a3);
}
}
return _8a2;
};
TW21Loader.prototype.internalizeTiddler=function(_8a4,_8a5,_8a6,node){
var e=node.firstChild;
var text=null;
if(node.getAttribute("tiddler")){
text=getNodeText(e).unescapeLineBreaks();
}else{
while(e.nodeName!="PRE"&&e.nodeName!="pre"){
e=e.nextSibling;
}
text=e.innerHTML.replace(/\r/mg,"").htmlDecode();
}
var _8aa=node.getAttribute("creator");
var _8ab=node.getAttribute("modifier");
var c=node.getAttribute("created");
var m=node.getAttribute("modified");
var _8ae=c?Date.convertFromYYYYMMDDHHMMSS(c):version.date;
var _8af=m?Date.convertFromYYYYMMDDHHMMSS(m):_8ae;
var tags=node.getAttribute("tags");
var _8b1={};
var i,_8b3=node.attributes;
for(i=_8b3.length-1;i>=0;i--){
var name=_8b3[i].name;
if(_8b3[i].specified&&!TiddlyWiki.isStandardField(name)){
_8b1[name]=_8b3[i].value.unescapeLineBreaks();
}
}
_8a5.assign(_8a6,text,_8ab,_8af,tags,_8ae,_8b1,_8aa);
return _8a5;
};
function TW21Saver(){
}
TW21Saver.prototype=new SaverBase();
TW21Saver.prototype.externalizeTiddler=function(_8b5,_8b6){
try{
var _8b7="";
var _8b8=config.options.chkUsePreForStorage;
_8b5.forEachField(_8b6,function(_8b9,_8ba,_8bb){
if(typeof _8bb!="string"){
_8bb="";
}
if(!_8ba.match(/^temp\./)){
_8b7+=" %0=\"%1\"".format([_8ba,_8bb.escapeLineBreaks().htmlEncode()]);
}
},true);
var _8bc=_8b6.created;
var _8bd=_8b6.modified;
var _8be=_8b6.creator?" creator=\""+_8b6.creator.htmlEncode()+"\"":"";
_8be+=_8b6.modifier?" modifier=\""+_8b6.modifier.htmlEncode()+"\"":"";
_8be+=(_8b8&&_8bc==version.date)?"":" created=\""+_8bc.convertToYYYYMMDDHHMM()+"\"";
_8be+=(_8b8&&_8bd==_8bc)?"":" modified=\""+_8bd.convertToYYYYMMDDHHMM()+"\"";
var tags=_8b6.getTags();
if(!_8b8||tags){
_8be+=" tags=\""+tags.htmlEncode()+"\"";
}
return ("<div %0=\"%1\"%2%3>%4</"+"div>").format([_8b8?"title":"tiddler",_8b6.title.htmlEncode(),_8be,_8b7,_8b8?"\n<pre>"+_8b6.text.htmlEncode()+"</pre>\n":_8b6.text.escapeLineBreaks().htmlEncode()]);
}
catch(ex){
throw exceptionText(ex,config.messages.tiddlerSaveError.format([_8b6.title]));
}
};

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
function Crypto(){
}
Crypto.strToBe32s=function(_1){
return jQuery.encoding.strToBe32s(_1);
};
Crypto.be32sToStr=function(be){
return jQuery.encoding.be32sToStr(be);
};
Crypto.be32sToHex=function(be){
return jQuery.encoding.be32sToHex(be);
};
Crypto.hexSha1Str=function(_4){
return jQuery.encoding.digests.hexSha1Str(_4);
};
Crypto.sha1Str=function(_5){
return jQuery.encoding.digests.sha1Str(_5);
};
Crypto.sha1=function(x,_7){
return jQuery.encoding.digests.sha1(x,_7);
};
config.formatterHelpers.charFormatHelper=function(w){
w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};
config.formatterHelpers.monospacedByLineHelper=function(w){
var _a=new RegExp(this.lookahead,"mg");
_a.lastIndex=w.matchStart;
var _b=_a.exec(w.source);
if(_b&&_b.index==w.matchStart){
var _c=_b[1];
if(config.browser.isIE){
_c=_c.replace(/\n/g,"\r");
}
createTiddlyElement(w.output,"pre",null,null,_c);
w.nextMatch=_a.lastIndex;
}
};
config.macros.br={};
config.macros.br.handler=function(_d){
createTiddlyElement(_d,"br");
};
Array.prototype.find=function(_e){
var i=this.indexOf(_e);
return i==-1?null:i;
};
Tiddler.prototype.loadFromDiv=function(_10,_11){
return store.getLoader().internalizeTiddler(store,this,_11,_10);
};
Tiddler.prototype.saveToDiv=function(){
return store.getSaver().externalizeTiddler(store,this);
};
function allTiddlersAsHtml(){
return store.allTiddlersAsHtml();
}
function applyPageTemplate(_12){
refreshPageTemplate(_12);
}
function displayTiddlers(_13,_14,_15,_16,_17,_18,_19){
story.displayTiddlers(_13,_14,_15,_18);
}
function displayTiddler(_1a,_1b,_1c,_1d,_1e,_1f,_20){
story.displayTiddler(_1a,_1b,_1c,_1f);
}
var createTiddlerPopup=Popup.create;
var scrollToTiddlerPopup=Popup.show;
var hideTiddlerPopup=Popup.remove;
var regexpBackSlashEn=new RegExp("\\\\n","mg");
var regexpBackSlash=new RegExp("\\\\","mg");
var regexpBackSlashEss=new RegExp("\\\\s","mg");
var regexpNewLine=new RegExp("\n","mg");
var regexpCarriageReturn=new RegExp("\r","mg");
FileAdaptor.loadTiddlyWikiCallback=function(_21,_22,_23,url,xhr){
_22.status=_21;
if(!_21){
_22.statusText="Error reading file";
}else{
_22.adaptor.store=new TiddlyWiki();
if(!_22.adaptor.store.importTiddlyWiki(_23)){
_22.statusText=config.messages.invalidFileError.format([url]);
_22.status=false;
}
}
_22.complete(_22,_22.userParams);
};
function loadRemoteFile(url,_27,_28){
return httpReq("GET",url,_27,_28);
}
function doHttp(_29,url,_2b,_2c,_2d,_2e,_2f,_30,_31,_32){
return httpReq(_29,url,_2f,_30,_31,_2b,_2c,_2d,_2e,_32);
}
String.prototype.toJSONString=function(){
var m={"\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\"":"\\\"","\\":"\\\\"};
var _34=function(a,b){
var c=m[b];
if(c){
return c;
}
c=b.charCodeAt();
return "\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);
};
if(/["\\\x00-\x1f]/.test(this)){
return "\""+this.replace(/([\x00-\x1f\\"])/g,_34)+"\"";
}
return "\""+this+"\"";
};
Tiddler.prototype.toRssItem=function(uri){
return tiddlerToRssItem(this,uri);
};
Tiddler.prototype.saveToRss=function(uri){
return "<item>\n"+tiddlerToRssItem(this,uri)+"\n</item>";
};
Tiddler.prototype.generateFingerprint=function(){
return "0x"+Crypto.hexSha1Str(this.text);
};
Number.prototype.clamp=function(min,max){
var c=this;
if(c<min){
c=min;
}
if(c>max){
c=max;
}
return Number(c);
};
function removeChildren(e){
jQuery(e).empty();
}
function removeNode(e){
jQuery(e).remove();
}
function getPlainText(e){
return jQuery(e).text();
}
function addClass(e,_41){
jQuery(e).addClass(_41);
}
function removeClass(e,_43){
jQuery(e).removeClass(_43);
}
function hasClass(e,_45){
return jQuery(e).hasClass(_45);
}
function wikifyPlain(_46,_47,_48){
if(!_47){
_47=store;
}
if(_47.tiddlerExists(_46)||_47.isShadowTiddler(_46)){
return wikifyPlainText(_47.getTiddlerText(_46),_48,tiddler);
}else{
return "";
}
}

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.6.4 http://jquery.com/ | http://jquery.org/license */
(function(a,b){function cu(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cr(a){if(!cg[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){ch||(ch=c.createElement("iframe"),ch.frameBorder=ch.width=ch.height=0),b.appendChild(ch);if(!ci||!ch.createElement)ci=(ch.contentWindow||ch.contentDocument).document,ci.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),ci.close();d=ci.createElement(a),ci.body.appendChild(d),e=f.css(d,"display"),b.removeChild(ch)}cg[a]=e}return cg[a]}function cq(a,b){var c={};f.each(cm.concat.apply([],cm.slice(0,b)),function(){c[this]=a});return c}function cp(){cn=b}function co(){setTimeout(cp,0);return cn=f.now()}function cf(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ce(){try{return new a.XMLHttpRequest}catch(b){}}function b$(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function bZ(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function bY(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bA.test(a)?d(a,e):bY(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)bY(a+"["+e+"]",b[e],c,d);else d(a,b)}function bX(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function bW(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bP,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=bW(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=bW(a,c,d,e,"*",g));return l}function bV(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bL),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function by(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bt:bu;if(d>0){c!=="border"&&f.each(e,function(){c||(d-=parseFloat(f.css(a,"padding"+this))||0),c==="margin"?d+=parseFloat(f.css(a,c+this))||0:d-=parseFloat(f.css(a,"border"+this+"Width"))||0});return d+"px"}d=bv(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0,c&&f.each(e,function(){d+=parseFloat(f.css(a,"padding"+this))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+this+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+this))||0)});return d+"px"}function bl(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bd,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bk(a){f.nodeName(a,"input")?bj(a):"getElementsByTagName"in a&&f.grep(a.getElementsByTagName("input"),bj)}function bj(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bi(a){return"getElementsByTagName"in a?a.getElementsByTagName("*"):"querySelectorAll"in a?a.querySelectorAll("*"):[]}function bh(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bg(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c=f.expando,d=f.data(a),e=f.data(b,d);if(d=d[c]){var g=d.events;e=e[c]=f.extend({},d);if(g){delete e.handle,e.events={};for(var h in g)for(var i=0,j=g[h].length;i<j;i++)f.event.add(b,h+(g[h][i].namespace?".":"")+g[h][i].namespace,g[h][i],g[h][i].data)}}}}function bf(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function V(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(Q.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function U(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function M(a,b){return(a&&a!=="*"?a+".":"")+b.replace(y,"`").replace(z,"&")}function L(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p=[],q=[],r=f._data(this,"events");if(!(a.liveFired===this||!r||!r.live||a.target.disabled||a.button&&a.type==="click")){a.namespace&&(n=new RegExp("(^|\\.)"+a.namespace.split(".").join("\\.(?:.*\\.)?")+"(\\.|$)")),a.liveFired=this;var s=r.live.slice(0);for(i=0;i<s.length;i++)g=s[i],g.origType.replace(w,"")===a.type?q.push(g.selector):s.splice(i--,1);e=f(a.target).closest(q,a.currentTarget);for(j=0,k=e.length;j<k;j++){m=e[j];for(i=0;i<s.length;i++){g=s[i];if(m.selector===g.selector&&(!n||n.test(g.namespace))&&!m.elem.disabled){h=m.elem,d=null;if(g.preType==="mouseenter"||g.preType==="mouseleave")a.type=g.preType,d=f(a.relatedTarget).closest(g.selector)[0],d&&f.contains(h,d)&&(d=h);(!d||d!==h)&&p.push({elem:h,handleObj:g,level:m.level})}}}for(j=0,k=p.length;j<k;j++){e=p[j];if(c&&e.level>c)break;a.currentTarget=e.elem,a.data=e.handleObj.data,a.handleObj=e.handleObj,o=e.handleObj.origHandler.apply(e.elem,arguments);if(o===!1||a.isPropagationStopped()){c=e.level,o===!1&&(b=!1);if(a.isImmediatePropagationStopped())break}}return b}}function J(a,c,d){var e=f.extend({},d[0]);e.type=a,e.originalEvent={},e.liveFired=b,f.event.handle.call(c,e),e.isDefaultPrevented()&&d[0].preventDefault()}function D(){return!0}function C(){return!1}function m(a,c,d){var e=c+"defer",g=c+"queue",h=c+"mark",i=f.data(a,e,b,!0);i&&(d==="queue"||!f.data(a,g,b,!0))&&(d==="mark"||!f.data(a,h,b,!0))&&setTimeout(function(){!f.data(a,g,b,!0)&&!f.data(a,h,b,!0)&&(f.removeData(a,e,!0),i.resolve())},0)}function l(a){for(var b in a)if(b!=="toJSON")return!1;return!0}function k(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(j,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNaN(d)?i.test(d)?f.parseJSON(d):d:parseFloat(d)}catch(g){}f.data(a,c,d)}else d=b}return d}var c=a.document,d=a.navigator,e=a.location,f=function(){function K(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(K,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/\d/,n=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,o=/^[\],:{}\s]*$/,p=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,q=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,s=/(webkit)[ \/]([\w.]+)/,t=/(opera)(?:.*version)?[ \/]([\w.]+)/,u=/(msie) ([\w.]+)/,v=/(mozilla)(?:.*? rv:([\w.]+))?/,w=/-([a-z]|[0-9])/ig,x=/^-ms-/,y=function(a,b){return(b+"").toUpperCase()},z=d.userAgent,A,B,C,D=Object.prototype.toString,E=Object.prototype.hasOwnProperty,F=Array.prototype.push,G=Array.prototype.slice,H=String.prototype.trim,I=Array.prototype.indexOf,J={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=n.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.6.4",length:0,size:function(){return this.length},toArray:function(){return G.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?F.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),B.done(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(G.apply(this,arguments),"slice",G.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:F,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;B.resolveWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").unbind("ready")}},bindReady:function(){if(!B){B=e._Deferred();if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",C,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",C),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&K()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNaN:function(a){return a==null||!m.test(a)||isNaN(a)},type:function(a){return a==null?String(a):J[D.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!E.call(a,"constructor")&&!E.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||E.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(o.test(b.replace(p,"@").replace(q,"]").replace(r,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(x,"ms-").replace(w,y)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:H?function(a){return a==null?"":H.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?F.call(c,a):e.merge(c,a)}return c},inArray:function(a,b){if(!b)return-1;if(I)return I.call(b,a);for(var c=0,d=b.length;c<d;c++)if(b[c]===a)return c;return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=G.call(arguments,2),g=function(){return a.apply(c,f.concat(G.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=s.exec(a)||t.exec(a)||u.exec(a)||a.indexOf("compatible")<0&&v.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){J["[object "+b+"]"]=b.toLowerCase()}),A=e.uaMatch(z),A.browser&&(e.browser[A.browser]=!0,e.browser.version=A.version),e.browser.webkit&&(e.browser.safari=!0),j.test("")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?C=function(){c.removeEventListener("DOMContentLoaded",C,!1),e.ready()}:c.attachEvent&&(C=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",C),e.ready())});return e}(),g="done fail isResolved isRejected promise then always pipe".split(" "),h=[].slice;f.extend({_Deferred:function(){var a=[],b,c,d,e={done:function(){if(!d){var c=arguments,g,h,i,j,k;b&&(k=b,b=0);for(g=0,h=c.length;g<h;g++)i=c[g],j=f.type(i),j==="array"?e.done.apply(e,i):j==="function"&&a.push(i);k&&e.resolveWith(k[0],k[1])}return this},resolveWith:function(e,f){if(!d&&!b&&!c){f=f||[],c=1;try{while(a[0])a.shift().apply(e,f)}finally{b=[e,f],c=0}}return this},resolve:function(){e.resolveWith(this,arguments);return this},isResolved:function(){return!!c||!!b},cancel:function(){d=1,a=[];return this}};return e},Deferred:function(a){var b=f._Deferred(),c=f._Deferred(),d;f.extend(b,{then:function(a,c){b.done(a).fail(c);return this},always:function(){return b.done.apply(b,arguments).fail.apply(this,arguments)},fail:c.done,rejectWith:c.resolveWith,reject:c.resolve,isRejected:c.isResolved,pipe:function(a,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[c,"reject"]},function(a,c){var e=c[0],g=c[1],h;f.isFunction(e)?b[a](function(){h=e.apply(this,arguments),h&&f.isFunction(h.promise)?h.promise().then(d.resolve,d.reject):d[g+"With"](this===b?d:this,[h])}):b[a](d[g])})}).promise()},promise:function(a){if(a==null){if(d)return d;d=a={}}var c=g.length;while(c--)a[g[c]]=b[g[c]];return a}}),b.done(c.cancel).fail(b.cancel),delete b.cancel,a&&a.call(b,b);return b},when:function(a){function i(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--e||g.resolveWith(g,h.call(b,0))}}var b=arguments,c=0,d=b.length,e=d,g=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred();if(d>1){for(;c<d;c++)b[c]&&f.isFunction(b[c].promise)?b[c].promise().then(i(c),g.reject):--e;e||g.resolveWith(g,b)}else g!==a&&g.resolveWith(g,d?[a]:[]);return g.promise()}}),f.support=function(){var a=c.createElement("div"),b=c.documentElement,d,e,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=a.getElementsByTagName("*"),e=a.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=a.getElementsByTagName("input")[0],k={leadingWhitespace:a.firstChild.nodeType===3,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55$/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:a.className!=="t",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,k.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,k.optDisabled=!h.disabled;try{delete a.test}catch(v){k.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function(){k.noCloneEvent=!1}),a.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),k.radioValue=i.value==="t",i.setAttribute("checked","checked"),a.appendChild(i),l=c.createDocumentFragment(),l.appendChild(a.firstChild),k.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",m=c.getElementsByTagName("body")[0],o=c.createElement(m?"div":"body"),p={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},m&&f.extend(p,{position:"absolute",left:"-1000px",top:"-1000px"});for(t in p)o.style[t]=p[t];o.appendChild(a),n=m||b,n.insertBefore(o,n.firstChild),k.appendChecked=i.checked,k.boxModel=a.offsetWidth===2,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,k.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",k.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",q=a.getElementsByTagName("td"),u=q[0].offsetHeight===0,q[0].style.display="",q[1].style.display="none",k.reliableHiddenOffsets=u&&q[0].offsetHeight===0,a.innerHTML="",c.defaultView&&c.defaultView.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",a.appendChild(j),k.reliableMarginRight=(parseInt((c.defaultView.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0),o.innerHTML="",n.removeChild(o);if(a.attachEvent)for(t in{submit:1,change:1,focusin:1})s="on"+t,u=s in a,u||(a.setAttribute(s,"return;"),u=typeof a[s]=="function"),k[t+"Bubbles"]=u;o=l=g=h=m=j=a=i=null;return k}(),f.boxModel=f.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!l(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i=f.expando,j=typeof c=="string",k=a.nodeType,l=k?f.cache:a,m=k?a[f.expando]:a[f.expando]&&f.expando;if((!m||e&&m&&l[m]&&!l[m][i])&&j&&d===b)return;m||(k?a[f.expando]=m=++f.uuid:m=f.expando),l[m]||(l[m]={},k||(l[m].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?l[m][i]=f.extend(l[m][i],c):l[m]=f.extend(l[m],c);g=l[m],e&&(g[i]||(g[i]={}),g=g[i]),d!==b&&(g[f.camelCase(c)]=d);if(c==="events"&&!g[c])return g[i]&&g[i].events;j?(h=g[c],h==null&&(h=g[f.camelCase(c)])):h=g;return h}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e=f.expando,g=a.nodeType,h=g?f.cache:a,i=g?a[f.expando]:f.expando;if(!h[i])return;if(b){d=c?h[i][e]:h[i];if(d){d[b]||(b=f.camelCase(b)),delete d[b];if(!l(d))return}}if(c){delete h[i][e];if(!l(h[i]))return}var j=h[i][e];f.support.deleteExpando||!h.setInterval?delete h[i]:h[i]=null,j?(h[i]={},g||(h[i].toJSON=f.noop),h[i][e]=j):g&&(f.support.deleteExpando?delete a[f.expando]:a.removeAttribute?a.removeAttribute(f.expando):a[f.expando]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d=null;if(typeof a=="undefined"){if(this.length){d=f.data(this[0]);if(this[0].nodeType===1){var e=this[0].attributes,g;for(var h=0,i=e.length;h<i;h++)g=e[h].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),k(this[0],g,d[g]))}}return d}if(typeof a=="object")return this.each(function(){f.data(this,a)});var j=a.split(".");j[1]=j[1]?"."+j[1]:"";if(c===b){d=this.triggerHandler("getData"+j[1]+"!",[j[0]]),d===b&&this.length&&(d=f.data(this[0],a),d=k(this[0],a,d));return d===b&&j[1]?this.data(j[0]):d}return this.each(function(){var b=f(this),d=[j[0],c];b.triggerHandler("setData"+j[1]+"!",d),f.data(this,a,c),b.triggerHandler("changeData"+j[1]+"!",d)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,c){a&&(c=(c||"fx")+"mark",f.data(a,c,(f.data(a,c,b,!0)||0)+1,!0))},_unmark:function(a,c,d){a!==!0&&(d=c,c=a,a=!1);if(c){d=d||"fx";var e=d+"mark",g=a?0:(f.data(c,e,b,!0)||1)-1;g?f.data(c,e,g,!0):(f.removeData(c,e,!0),m(c,d,"mark"))}},queue:function(a,c,d){if(a){c=(c||"fx")+"queue";var e=f.data(a,c,b,!0);d&&(!e||f.isArray(d)?e=f.data(a,c,f.makeArray(d),!0):e.push(d));return e||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e;d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),d.call(a,function(){f.dequeue(a,b)})),c.length||(f.removeData(a,b+"queue",!0),m(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(){var c=this;setTimeout(function(){f.dequeue(c,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f._Deferred(),!0))h++,l.done(m);m();return d.promise()}});var n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u,v;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(o);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(o);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(n," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(o);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ";for(var c=0,d=this.length;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(n," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e=this[0];if(!arguments.length){if(e){c=f.valHooks[e.nodeName.toLowerCase()]||f.valHooks[e.type];if(c&&"get"in c&&(d=c.get(e,"value"))!==b)return d;d=e.value;return typeof d=="string"?d.replace(p,""):d==null?"":d}return b}var g=f.isFunction(a);return this.each(function(d){var e=f(this),h;if(this.nodeType===1){g?h=a.call(this,d,e.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c=a.selectedIndex,d=[],e=a.options,g=a.type==="select-one";if(c<0)return null;for(var h=g?c:0,i=g?c+1:e.length;h<i;h++){var j=e[h];if(j.selected&&(f.support.optDisabled?!j.disabled:j.getAttribute("disabled")===null)&&(!j.parentNode.disabled||!f.nodeName(j.parentNode,"optgroup"))){b=f(j).val();if(g)return b;d.push(b)}}if(g&&!d.length&&e.length)return f(e[c]).val();return d},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attrFix:{tabindex:"tabIndex"},attr:function(a,c,d,e){var g=a.nodeType;if(!a||g===3||g===8||g===2)return b;if(e&&c in f.attrFn)return f(a)[c](d);if(!("getAttribute"in a))return f.prop(a,c,d);var h,i,j=g!==1||!f.isXMLDoc(a);j&&(c=f.attrFix[c]||c,i=f.attrHooks[c],i||(t.test(c)?i=v:u&&(i=u)));if(d!==b){if(d===null){f.removeAttr(a,c);return b}if(i&&"set"in i&&j&&(h=i.set(a,d,c))!==b)return h;a.setAttribute(c,""+d);return d}if(i&&"get"in i&&j&&(h=i.get(a,c))!==null)return h;h=a.getAttribute(c);return h===null?b:h},removeAttr:function(a,b){var c;a.nodeType===1&&(b=f.attrFix[b]||b,f.attr(a,b,""),a.removeAttribute(b),t.test(b)&&(c=f.propFix[b]||b)in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(u&&f.nodeName(a,"button"))return u.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(u&&f.nodeName(a,"button"))return u.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e=a.nodeType;if(!a||e===3||e===8||e===2)return b;var g,h,i=e!==1||!f.isXMLDoc(a);i&&(c=f.propFix[c]||c,h=f.propHooks[c]);return d!==b?h&&"set"in h&&(g=h.set(a,d,c))!==b?g:a[c]=d:h&&"get"in h&&(g=h.get(a,c))!==null?g:a[c]},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabIndex=f.propHooks.tabIndex,v={get:function(a,c){var d;return f.prop(a,c)===!0||(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},f.support.getSetAttribute||(u=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&d.nodeValue!==""?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})})),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var w=/\.(.*)$/,x=/^(?:textarea|input|select)$/i,y=/\./g,z=/ /g,A=/[^\w\s.|`]/g,B=function(a){return a.replace(A,"\\$&")};f.event={add:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){if(d===!1)d=C;else if(!d)return;var g,h;d.handler&&(g=d,d=g.handler),d.guid||(d.guid=f.guid++);var i=f._data(a);if(!i)return;var j=i.events,k=i.handle;j||(i.events=j={}),k||(i.handle=k=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.handle.apply(k.elem,arguments):b}),k.elem=a,c=c.split(" ");var l,m=0,n;while(l=c[m++]){h=g?f.extend({},g):{handler:d,data:e},l.indexOf(".")>-1?(n=l.split("."),l=n.shift(),h.namespace=n.slice(0).sort().join(".")):(n=[],h.namespace=""),h.type=l,h.guid||(h.guid=d.guid);var o=j[l],p=f.event.special[l]||{};if(!o){o=j[l]=[];if(!p.setup||p.setup.call(a,e,n,k)===!1)a.addEventListener?a.addEventListener(l,k,!1):a.attachEvent&&a.attachEvent("on"+l,k)}p.add&&(p.add.call(a,h),h.handler.guid||(h.handler.guid=d.guid)),o.push(h),f.event.global[l]=!0}a=null}},global:{},remove:function(a,c,d,e){if(a.nodeType!==3&&a.nodeType!==8){d===!1&&(d=C);var g,h,i,j,k=0,l,m,n,o,p,q,r,s=f.hasData(a)&&f._data(a),t=s&&s.events;if(!s||!t)return;c&&c.type&&(d=c.handler,c=c.type);if(!c||typeof c=="string"&&c.charAt(0)==="."){c=c||"";for(h in t)f.event.remove(a,h+c);return}c=c.split(" ");while(h=c[k++]){r=h,q=null,l=h.indexOf(".")<0,m=[],l||(m=h.split("."),h=m.shift(),n=new RegExp("(^|\\.)"+f.map(m.slice(0).sort(),B).join("\\.(?:.*\\.)?")+"(\\.|$)")),p=t[h];if(!p)continue;if(!d){for(j=0;j<p.length;j++){q=p[j];if(l||n.test(q.namespace))f.event.remove(a,r,q.handler,j),p.splice(j--,1)}continue}o=f.event.special[h]||{};for(j=e||0;j<p.length;j++){q=p[j];if(d.guid===q.guid){if(l||n.test(q.namespace))e==null&&p.splice(j--,1),o.remove&&o.remove.call(a,q);if(e!=null)break}}if(p.length===0||e!=null&&p.length===1)(!o.teardown||o.teardown.call(a,m)===!1)&&f.removeEvent(a,h,s.handle),g=null,delete 
t[h]}if(f.isEmptyObject(t)){var u=s.handle;u&&(u.elem=null),delete s.events,delete s.handle,f.isEmptyObject(s)&&f.removeData(a,b,!0)}}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){var h=c.type||c,i=[],j;h.indexOf("!")>=0&&(h=h.slice(0,-1),j=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if(!!e&&!f.event.customEvent[h]||!!f.event.global[h]){c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.exclusive=j,c.namespace=i.join("."),c.namespace_re=new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)");if(g||!e)c.preventDefault(),c.stopPropagation();if(!e){f.each(f.cache,function(){var a=f.expando,b=this[a];b&&b.events&&b.events[h]&&f.event.trigger(c,d,b.handle.elem)});return}if(e.nodeType===3||e.nodeType===8)return;c.result=b,c.target=e,d=d!=null?f.makeArray(d):[],d.unshift(c);var k=e,l=h.indexOf(":")<0?"on"+h:"";do{var m=f._data(k,"handle");c.currentTarget=k,m&&m.apply(k,d),l&&f.acceptData(k)&&k[l]&&k[l].apply(k,d)===!1&&(c.result=!1,c.preventDefault()),k=k.parentNode||k.ownerDocument||k===c.target.ownerDocument&&a}while(k&&!c.isPropagationStopped());if(!c.isDefaultPrevented()){var n,o=f.event.special[h]||{};if((!o._default||o._default.call(e.ownerDocument,c)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)){try{l&&e[h]&&(n=e[l],n&&(e[l]=null),f.event.triggered=h,e[h]())}catch(p){}n&&(e[l]=n),f.event.triggered=b}}return c.result}},handle:function(c){c=f.event.fix(c||a.event);var d=((f._data(this,"events")||{})[c.type]||[]).slice(0),e=!c.exclusive&&!c.namespace,g=Array.prototype.slice.call(arguments,0);g[0]=c,c.currentTarget=this;for(var h=0,i=d.length;h<i;h++){var j=d[h];if(e||c.namespace_re.test(j.namespace)){c.handler=j.handler,c.data=j.data,c.handleObj=j;var k=j.handler.apply(this,g);k!==b&&(c.result=k,k===!1&&(c.preventDefault(),c.stopPropagation()));if(c.isImmediatePropagationStopped())break}}return c.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[f.expando])return a;var d=a;a=f.Event(d);for(var e=this.props.length,g;e;)g=this.props[--e],a[g]=d[g];a.target||(a.target=a.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),!a.relatedTarget&&a.fromElement&&(a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement);if(a.pageX==null&&a.clientX!=null){var h=a.target.ownerDocument||c,i=h.documentElement,j=h.body;a.pageX=a.clientX+(i&&i.scrollLeft||j&&j.scrollLeft||0)-(i&&i.clientLeft||j&&j.clientLeft||0),a.pageY=a.clientY+(i&&i.scrollTop||j&&j.scrollTop||0)-(i&&i.clientTop||j&&j.clientTop||0)}a.which==null&&(a.charCode!=null||a.keyCode!=null)&&(a.which=a.charCode!=null?a.charCode:a.keyCode),!a.metaKey&&a.ctrlKey&&(a.metaKey=a.ctrlKey),!a.which&&a.button!==b&&(a.which=a.button&1?1:a.button&2?3:a.button&4?2:0);return a},guid:1e8,proxy:f.proxy,special:{ready:{setup:f.bindReady,teardown:f.noop},live:{add:function(a){f.event.add(this,M(a.origType,a.selector),f.extend({},a,{handler:L,guid:a.handler.guid}))},remove:function(a){f.event.remove(this,M(a.origType,a.selector),a)}},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}}},f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!this.preventDefault)return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?D:C):this.type=a,b&&f.extend(this,b),this.timeStamp=f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=D;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=D;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=D,this.stopPropagation()},isDefaultPrevented:C,isPropagationStopped:C,isImmediatePropagationStopped:C};var E=function(a){var b=a.relatedTarget,c=!1,d=a.type;a.type=a.data,b!==this&&(b&&(c=f.contains(this,b)),c||(f.event.handle.apply(this,arguments),a.type=d))},F=function(a){a.type=a.data,f.event.handle.apply(this,arguments)};f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={setup:function(c){f.event.add(this,b,c&&c.selector?F:E,a)},teardown:function(a){f.event.remove(this,b,a&&a.selector?F:E)}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(a,b){if(!f.nodeName(this,"form"))f.event.add(this,"click.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="submit"||c==="image")&&f(b).closest("form").length&&J("submit",this,arguments)}),f.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,c=f.nodeName(b,"input")||f.nodeName(b,"button")?b.type:"";(c==="text"||c==="password")&&f(b).closest("form").length&&a.keyCode===13&&J("submit",this,arguments)});else return!1},teardown:function(a){f.event.remove(this,".specialSubmit")}});if(!f.support.changeBubbles){var G,H=function(a){var b=f.nodeName(a,"input")?a.type:"",c=a.value;b==="radio"||b==="checkbox"?c=a.checked:b==="select-multiple"?c=a.selectedIndex>-1?f.map(a.options,function(a){return a.selected}).join("-"):"":f.nodeName(a,"select")&&(c=a.selectedIndex);return c},I=function(c){var d=c.target,e,g;if(!!x.test(d.nodeName)&&!d.readOnly){e=f._data(d,"_change_data"),g=H(d),(c.type!=="focusout"||d.type!=="radio")&&f._data(d,"_change_data",g);if(e===b||g===e)return;if(e!=null||g)c.type="change",c.liveFired=b,f.event.trigger(c,arguments[1],d)}};f.event.special.change={filters:{focusout:I,beforedeactivate:I,click:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(c==="radio"||c==="checkbox"||f.nodeName(b,"select"))&&I.call(this,a)},keydown:function(a){var b=a.target,c=f.nodeName(b,"input")?b.type:"";(a.keyCode===13&&!f.nodeName(b,"textarea")||a.keyCode===32&&(c==="checkbox"||c==="radio")||c==="select-multiple")&&I.call(this,a)},beforeactivate:function(a){var b=a.target;f._data(b,"_change_data",H(b))}},setup:function(a,b){if(this.type==="file")return!1;for(var c in G)f.event.add(this,c+".specialChange",G[c]);return x.test(this.nodeName)},teardown:function(a){f.event.remove(this,".specialChange");return x.test(this.nodeName)}},G=f.event.special.change.filters,G.focus=G.beforeactivate}f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){function e(a){var c=f.event.fix(a);c.type=b,c.originalEvent={},f.event.trigger(c,null,c.target),c.isDefaultPrevented()&&a.preventDefault()}var d=0;f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.each(["bind","one"],function(a,c){f.fn[c]=function(a,d,e){var g;if(typeof a=="object"){for(var h in a)this[c](h,d,a[h],e);return this}if(arguments.length===2||d===!1)e=d,d=b;c==="one"?(g=function(a){f(this).unbind(a,g);return e.apply(this,arguments)},g.guid=e.guid||f.guid++):g=e;if(a==="unload"&&c!=="one")this.one(a,d,e);else for(var i=0,j=this.length;i<j;i++)f.event.add(this[i],a,g,d);return this}}),f.fn.extend({unbind:function(a,b){if(typeof a=="object"&&!a.preventDefault)for(var c in a)this.unbind(c,a[c]);else for(var d=0,e=this.length;d<e;d++)f.event.remove(this[d],a,b);return this},delegate:function(a,b,c,d){return this.live(b,c,d,a)},undelegate:function(a,b,c){return arguments.length===0?this.unbind("live"):this.die(b,null,c,a)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f.data(this,"lastToggle"+a.guid)||0)%d;f.data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var K={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};f.each(["live","die"],function(a,c){f.fn[c]=function(a,d,e,g){var h,i=0,j,k,l,m=g||this.selector,n=g?this:f(this.context);if(typeof a=="object"&&!a.preventDefault){for(var o in a)n[c](o,d,a[o],m);return this}if(c==="die"&&!a&&g&&g.charAt(0)==="."){n.unbind(g);return this}if(d===!1||f.isFunction(d))e=d||C,d=b;a=(a||"").split(" ");while((h=a[i++])!=null){j=w.exec(h),k="",j&&(k=j[0],h=h.replace(w,""));if(h==="hover"){a.push("mouseenter"+k,"mouseleave"+k);continue}l=h,K[h]?(a.push(K[h]+k),h=h+k):h=(K[h]||h)+k;if(c==="live")for(var p=0,q=n.length;p<q;p++)f.event.add(n[p],"live."+M(h,m),{data:d,selector:m,handler:e,origType:h,origHandler:e,preType:l});else n.unbind("live."+M(h,m),e)}return this}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.bind(b,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0)}),function(){function u(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}if(i.nodeType===1){f||(i.sizcache=c,i.sizset=g);if(typeof b!="string"){if(i===b){j=!0;break}}else if(k.filter(b,[i]).length>0){j=i;break}}i=i[a]}d[g]=j}}}function t(a,b,c,d,e,f){for(var g=0,h=d.length;g<h;g++){var i=d[g];if(i){var j=!1;i=i[a];while(i){if(i.sizcache===c){j=d[i.sizset];break}i.nodeType===1&&!f&&(i.sizcache=c,i.sizset=g);if(i.nodeName.toLowerCase()===b){j=i;break}i=i[a]}d[g]=j}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d=0,e=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\W/;[0,0].sort(function(){h=!1;return 0});var k=function(b,d,f,g){f=f||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return f;var i,j,n,o,q,r,s,t,u=!0,w=k.isXML(d),x=[],y=b;do{a.exec(""),i=a.exec(y);if(i){y=i[3],x.push(i[1]);if(i[2]){o=i[3];break}}}while(i);if(x.length>1&&m.exec(b))if(x.length===2&&l.relative[x[0]])j=v(x[0]+x[1],d);else{j=l.relative[x[0]]?[d]:k(x.shift(),d);while(x.length)b=x.shift(),l.relative[b]&&(b+=x.shift()),j=v(b,j)}else{!g&&x.length>1&&d.nodeType===9&&!w&&l.match.ID.test(x[0])&&!l.match.ID.test(x[x.length-1])&&(q=k.find(x.shift(),d,w),d=q.expr?k.filter(q.expr,q.set)[0]:q.set[0]);if(d){q=g?{expr:x.pop(),set:p(g)}:k.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&d.parentNode?d.parentNode:d,w),j=q.expr?k.filter(q.expr,q.set):q.set,x.length>0?n=p(j):u=!1;while(x.length)r=x.pop(),s=r,l.relative[r]?s=x.pop():r="",s==null&&(s=d),l.relative[r](n,s,w)}else n=x=[]}n||(n=j),n||k.error(r||b);if(e.call(n)==="[object Array]")if(!u)f.push.apply(f,n);else if(d&&d.nodeType===1)for(t=0;n[t]!=null;t++)n[t]&&(n[t]===!0||n[t].nodeType===1&&k.contains(d,n[t]))&&f.push(j[t]);else for(t=0;n[t]!=null;t++)n[t]&&n[t].nodeType===1&&f.push(j[t]);else p(n,f);o&&(k(o,h,f,g),k.uniqueSort(f));return f};k.uniqueSort=function(a){if(r){g=h,a.sort(r);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},k.matches=function(a,b){return k(a,null,null,b)},k.matchesSelector=function(a,b){return k(b,null,null,[a]).length>0},k.find=function(a,b,c){var d;if(!a)return[];for(var e=0,f=l.order.length;e<f;e++){var g,h=l.order[e];if(g=l.leftMatch[h].exec(a)){var j=g[1];g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=l.find[h](g,b,c);if(d!=null){a=a.replace(l.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},k.filter=function(a,c,d,e){var f,g,h=a,i=[],j=c,m=c&&c[0]&&k.isXML(c[0]);while(a&&c.length){for(var n in l.filter)if((f=l.leftMatch[n].exec(a))!=null&&f[2]){var o,p,q=l.filter[n],r=f[1];g=!1,f.splice(1,1);if(r.substr(r.length-1)==="\\")continue;j===i&&(i=[]);if(l.preFilter[n]){f=l.preFilter[n](f,j,d,i,e,m);if(!f)g=o=!0;else if(f===!0)continue}if(f)for(var s=0;(p=j[s])!=null;s++)if(p){o=q(p,f,s,j);var t=e^!!o;d&&o!=null?t?g=!0:j[s]=!1:t&&(i.push(p),g=!0)}if(o!==b){d||(j=i),a=a.replace(l.match[n],"");if(!g)return[];break}}if(a===h)if(g==null)k.error(a);else break;h=a}return j},k.error=function(a){throw"Syntax error, unrecognized expression: "+a};var l=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!j.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&k.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!j.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&k.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=u;typeof b=="string"&&!j.test(b)&&(b=b.toLowerCase(),e=b,g=t),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(i,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||k.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&k.error(a[0]);a[0]=d++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");!f&&l.attrMap[g]&&(a[1]=l.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=k(b[3],null,null,c);else{var g=k.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(l.match.POS.test(b[0])||l.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!k(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=l.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||k.getText([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}k.error(e)},CHILD:function(a,b){var c=b[1],d=a;switch(c){case"only":case"first":while(d=d.previousSibling)if(d.nodeType===1)return!1;if(c==="first")return!0;d=a;case"last":while(d=d.nextSibling)if(d.nodeType===1)return!1;return!0;case"nth":var e=b[2],f=b[3];if(e===1&&f===0)return!0;var g=b[0],h=a.parentNode;if(h&&(h.sizcache!==g||!a.nodeIndex)){var i=0;for(d=h.firstChild;d;d=d.nextSibling)d.nodeType===1&&(d.nodeIndex=++i);h.sizcache=g}var j=a.nodeIndex-f;return e===0?j===0:j%e===0&&j/e>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attrHandle[c]?l.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=l.setFilters[e];if(f)return f(a,c,b,d)}}},m=l.match.POS,n=function(a,b){return"\\"+(b-0+1)};for(var o in l.match)l.match[o]=new RegExp(l.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source),l.leftMatch[o]=new RegExp(/(^(?:.|\r|\n)*?)/.source+l.match[o].source.replace(/\\(\d+)/g,n));var p=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(q){p=function(a,b){var c=0,d=b||[];if(e.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var f=a.length;c<f;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var r,s;c.documentElement.compareDocumentPosition?r=function(a,b){if(a===b){g=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(r=function(a,b){if(a===b){g=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return s(a,b);if(!h)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return s(e[k],f[k]);return k===c?s(a,f[k],-1):s(e[k],b,1)},s=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),k.getText=function(a){var b="",c;for(var d=0;a[d];d++)c=a[d],c.nodeType===3||c.nodeType===4?b+=c.nodeValue:c.nodeType!==8&&(b+=k.getText(c.childNodes));return b},function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(l.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},l.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(l.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(l.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=k,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){k=function(b,e,f,g){e=e||c;if(!g&&!k.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return p(e.getElementsByTagName(b),f);if(h[2]&&l.find.CLASS&&e.getElementsByClassName)return p(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return p([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return p([],f);if(i.id===h[3])return p([i],f)}try{return p(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var m=e,n=e.getAttribute("id"),o=n||d,q=e.parentNode,r=/^\s*[+~]/.test(b);n?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),r&&q&&(e=e.parentNode);try{if(!r||q)return p(e.querySelectorAll("[id='"+o+"'] "+b),f)}catch(s){}finally{n||m.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)k[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}k.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!k.isXML(a))try{if(e||!l.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return k(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;l.order.splice(1,0,"CLASS"),l.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?k.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?k.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:k.contains=function(){return!1},k.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var v=function(a,b){var c,d=[],e="",f=b.nodeType?[b]:b;while(c=l.match.PSEUDO.exec(a))e+=c[0],a=a.replace(l.match.PSEUDO,"");a=l.relative[a]?a+"*":a;for(var g=0,h=f.length;g<h;g++)k(a,f[g],d);return k.filter(e,d)};f.find=k,f.expr=k.selectors,f.expr[":"]=f.expr.filters,f.unique=k.uniqueSort,f.text=k.getText,f.isXMLDoc=k.isXML,f.contains=k.contains}();var N=/Until$/,O=/^(?:parents|prevUntil|prevAll)/,P=/,/,Q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,S=f.expr.match.POS,T={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(V(this,a,!1),"not",a)},filter:function(a){return this.pushStack(V(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h,i,j={},k=1;if(g&&a.length){for(d=0,e=a.length;d<e;d++)i=a[d],j[i]||(j[i]=S.test(i)?f(i,b||this.context):i);while(g&&g.ownerDocument&&g!==b){for(i in j)h=j[i],(h.jquery?h.index(g)>-1:f(g).is(h))&&c.push({selector:i,elem:g,level:k});g=g.parentNode,k++}}return c}var l=S.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(l?l.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(U(c[0])||U(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c),g=R.call(arguments);N.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!T[a]?f.unique(e):e,(this.length>1||P.test(d))&&O.test(a)&&(e=e.reverse());return this.pushStack(e,a,g.join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|object|embed|option|style)/i,bb=/checked\s*(?:[^=]|=\s*.checked.)/i,bc=/\/(java|ecma)script/i,bd=/^\s*<!(?:\[CDATA\[|\-\-)/,be={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};be.optgroup=be.option,be.tbody=be.tfoot=be.colgroup=be.caption=be.thead,be.th=be.td,f.support.htmlSerialize||(be._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){f(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f(arguments[0]).toArray());return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!be[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bb.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bf(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bl)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i;b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof a[0]=="string"&&a[0].length<512&&i===c&&a[0].charAt(0)==="<"&&!ba.test(a[0])&&(f.support.checkClone||!bb.test(a[0]))&&(g=!0,h=f.fragments[a[0]],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean
(a,i,e,d)),g&&(f.fragments[a[0]]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d=a.cloneNode(!0),e,g,h;if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bh(a,d),e=bi(a),g=bi(d);for(h=0;e[h];++h)g[h]&&bh(e[h],g[h])}if(b){bg(a,d);if(c){e=bi(a),g=bi(d);for(h=0;e[h];++h)bg(e[h],g[h])}}e=g=null;return d},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=be[l]||be._default,n=m[0],o=b.createElement("div");o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bk(k[i]);else bk(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||bc.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.expando,g=f.event.special,h=f.support.deleteExpando;for(var i=0,j;(j=a[i])!=null;i++){if(j.nodeName&&f.noData[j.nodeName.toLowerCase()])continue;c=j[f.expando];if(c){b=d[c]&&d[c][e];if(b&&b.events){for(var k in b.events)g[k]?f.event.remove(j,k):f.removeEvent(j,k,b.handle);b.handle&&(b.handle.elem=null)}h?delete j[f.expando]:j.removeAttribute&&j.removeAttribute(f.expando),delete d[c]}}}});var bm=/alpha\([^)]*\)/i,bn=/opacity=([^)]*)/,bo=/([A-Z]|^ms)/g,bp=/^-?\d+(?:px)?$/i,bq=/^-?\d/,br=/^([\-+])=([\-+.\de]+)/,bs={position:"absolute",visibility:"hidden",display:"block"},bt=["Left","Right"],bu=["Top","Bottom"],bv,bw,bx;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bv(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=br.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bv)return bv(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return by(a,b,d);f.swap(a,bs,function(){e=by(a,b,d)});return e}},set:function(a,b){if(!bp.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return bn.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNaN(b)?"":"alpha(opacity="+b*100+")",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bm,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bm.test(g)?g.replace(bm,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bv(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bw=function(a,c){var d,e,g;c=c.replace(bo,"-$1").toLowerCase();if(!(e=a.ownerDocument.defaultView))return b;if(g=e.getComputedStyle(a,null))d=g.getPropertyValue(c),d===""&&!f.contains(a.ownerDocument.documentElement,a)&&(d=f.style(a,c));return d}),c.documentElement.currentStyle&&(bx=function(a,b){var c,d=a.currentStyle&&a.currentStyle[b],e=a.runtimeStyle&&a.runtimeStyle[b],f=a.style;!bp.test(d)&&bq.test(d)&&(c=f.left,e&&(a.runtimeStyle.left=a.currentStyle.left),f.left=b==="fontSize"?"1em":d||0,d=f.pixelLeft+"px",f.left=c,e&&(a.runtimeStyle.left=e));return d===""?"auto":d}),bv=bw||bx,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bz=/%20/g,bA=/\[\]$/,bB=/\r?\n/g,bC=/#.*$/,bD=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bE=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bF=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bG=/^(?:GET|HEAD)$/,bH=/^\/\//,bI=/\?/,bJ=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bK=/^(?:select|textarea)/i,bL=/\s+/,bM=/([?&])_=[^&]*/,bN=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bO=f.fn.load,bP={},bQ={},bR,bS,bT=["*/"]+["*"];try{bR=e.href}catch(bU){bR=c.createElement("a"),bR.href="",bR=bR.href}bS=bN.exec(bR.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bO)return bO.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bJ,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bK.test(this.nodeName)||bE.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bB,"\r\n")}}):{name:b.name,value:c.replace(bB,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.bind(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?bX(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),bX(a,b);return a},ajaxSettings:{url:bR,isLocal:bF.test(bS[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bT},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bV(bP),ajaxTransport:bV(bQ),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?bZ(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=b$(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.resolveWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f._Deferred(),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bD.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.done,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bC,"").replace(bH,bS[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bL),d.crossDomain==null&&(r=bN.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bS[1]&&r[2]==bS[2]&&(r[3]||(r[1]==="http:"?80:443))==(bS[3]||(bS[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),bW(bP,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bG.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bI.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bM,"$1_="+x);d.url=y+(y===d.url?(bI.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bT+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=bW(bQ,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){s<2?w(-1,z):f.error(z)}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)bY(g,a[g],c,e);return d.join("&").replace(bz,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var b_=f.now(),ca=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+b_++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ca.test(b.url)||e&&ca.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ca,l),b.url===j&&(e&&(k=k.replace(ca,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cb=a.ActiveXObject?function(){for(var a in cd)cd[a](0,1)}:!1,cc=0,cd;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ce()||cf()}:ce,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cb&&delete cd[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cc,cb&&(cd||(cd={},f(a).unload(cb)),cd[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var cg={},ch,ci,cj=/^(?:toggle|show|hide)$/,ck=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cl,cm=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cn;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cq("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cr(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cq("hide",3),a,b,c);for(var d=0,e=this.length;d<e;d++)if(this[d].style){var g=f.css(this[d],"display");g!=="none"&&!f._data(this[d],"olddisplay")&&f._data(this[d],"olddisplay",g)}for(d=0;d<e;d++)this[d].style&&(this[d].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cq("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return this[e.queue===!1?"each":"queue"](function(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(f.support.inlineBlockNeedsLayout?(j=cr(this.nodeName),j==="inline"?this.style.display="inline-block":(this.style.display="inline",this.style.zoom=1)):this.style.display="inline-block"))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)k=new f.fx(this,b,i),h=a[i],cj.test(h)?k[h==="toggle"?d?"show":"hide":h]():(l=ck.exec(h),m=k.cur(),l?(n=parseFloat(l[2]),o=l[3]||(f.cssNumber[i]?"":"px"),o!=="px"&&(f.style(this,i,(n||1)+o),m=(n||1)/k.cur()*m,f.style(this,i,m+o)),l[1]&&(n=(l[1]==="-="?-1:1)*n+m),k.custom(m,n,o)):k.custom(m,h,""));return!0})},stop:function(a,b){a&&this.queue([]),this.each(function(){var a=f.timers,c=a.length;b||f._unmark(!0,this);while(c--)a[c].elem===this&&(b&&a[c](!0),a.splice(c,1))}),b||this.dequeue();return this}}),f.each({slideDown:cq("show",1),slideUp:cq("hide",1),slideToggle:cq("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default,d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue!==!1?f.dequeue(this):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,b,c){function g(a){return d.step(a)}var d=this,e=f.fx;this.startTime=cn||co(),this.start=a,this.end=b,this.unit=c||this.unit||(f.cssNumber[this.prop]?"":"px"),this.now=this.start,this.pos=this.state=0,g.elem=this.elem,g()&&f.timers.push(g)&&!cl&&(cl=setInterval(e.tick,e.interval))},show:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.show=!0,this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b=cn||co(),c=!0,d=this.elem,e=this.options,g,h;if(a||b>=e.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),e.animatedProperties[this.prop]=!0;for(g in e.animatedProperties)e.animatedProperties[g]!==!0&&(c=!1);if(c){e.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){d.style["overflow"+b]=e.overflow[a]}),e.hide&&f(d).hide();if(e.hide||e.show)for(var i in e.animatedProperties)f.style(d,i,e.orig[i]);e.complete.call(d)}return!1}e.duration==Infinity?this.now=b:(h=b-this.startTime,this.state=h/e.duration,this.pos=f.easing[e.animatedProperties[this.prop]](this.state,h,0,1,e.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){for(var a=f.timers,b=0;b<a.length;++b)a[b]()||a.splice(b--,1);a.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cl),cl=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit:a.elem[a.prop]=a.now}}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cs=/^t(?:able|d|h)$/i,ct=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cu(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);f.offset.initialize();var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.offset.supportsFixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.offset.doesNotAddBorder&&(!f.offset.doesAddBorderForTableAndCells||!cs.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.offset.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.offset.supportsFixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={initialize:function(){var a=c.body,b=c.createElement("div"),d,e,g,h,i=parseFloat(f.css(a,"marginTop"))||0,j="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";f.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"}),b.innerHTML=j,a.insertBefore(b,a.firstChild),d=b.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,this.doesNotAddBorder=e.offsetTop!==5,this.doesAddBorderForTableAndCells=h.offsetTop===5,e.style.position="fixed",e.style.top="20px",this.supportsFixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",this.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==i,a.removeChild(b),f.offset.initialize=f.noop},bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.offset.initialize(),f.offset.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=ct.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!ct.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cu(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cu(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a&&a.style?parseFloat(f.css(a,d,"padding")):null},f.fn["outer"+c]=function(a){var b=this[0];return b&&b.style?parseFloat(f.css(b,d,a?"margin":"border")):null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNaN(j)?i:j}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
(function($){
if(!$.encoding){
$.encoding={};
}
$.extend($.encoding,{strToBe32s:function(_2){
var be=[];
var _4=Math.floor(_2.length/4);
var i,j;
for(i=0,j=0;i<_4;i++,j+=4){
be[i]=((_2.charCodeAt(j)&255)<<24)|((_2.charCodeAt(j+1)&255)<<16)|((_2.charCodeAt(j+2)&255)<<8)|(_2.charCodeAt(j+3)&255);
}
while(j<_2.length){
be[j>>2]|=(_2.charCodeAt(j)&255)<<(24-(j*8)%32);
j++;
}
return be;
},be32sToStr:function(be){
var _8="";
for(var i=0;i<be.length*32;i+=8){
_8+=String.fromCharCode((be[i>>5]>>>(24-i%32))&255);
}
return _8;
},be32sToHex:function(be){
var _b="0123456789ABCDEF";
var _c="";
for(var i=0;i<be.length*4;i++){
_c+=_b.charAt((be[i>>2]>>((3-i%4)*8+4))&15)+_b.charAt((be[i>>2]>>((3-i%4)*8))&15);
}
return _c;
}});
})(jQuery);
(function($){
if(!$.encoding.digests){
$.encoding.digests={};
}
$.extend($.encoding.digests,{hexSha1Str:function(_f){
return $.encoding.be32sToHex($.encoding.digests.sha1Str(_f));
},sha1Str:function(str){
return sha1($.encoding.strToBe32s(str),str.length);
},sha1:function(x,_12){
return sha1($.encoding.strToBe32s(str),str.length);
}});
function sha1(x,_14){
function add32(a,b){
var lsw=(a&65535)+(b&65535);
var msw=(a>>16)+(b>>16)+(lsw>>16);
return (msw<<16)|(lsw&65535);
}
function AA(a,b,c,d,e){
b=(b>>>27)|(b<<5);
var lsw=(a&65535)+(b&65535)+(c&65535)+(d&65535)+(e&65535);
var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
return (msw<<16)|(lsw&65535);
}
function RR(w,j){
var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
return (n>>>31)|(n<<1);
}
var len=_14*8;
x[len>>5]|=128<<(24-len%32);
x[((len+64>>9)<<4)+15]=len;
var w=new Array(80);
var k1=1518500249;
var k2=1859775393;
var k3=2400959708;
var k4=3395469782;
var h0=1732584193;
var h1=4023233417;
var h2=2562383102;
var h3=271733878;
var h4=3285377520;
for(var i=0;i<x.length;i+=16){
var j=0;
var t;
var a=h0;
var b=h1;
var c=h2;
var d=h3;
var e=h4;
while(j<16){
w[j]=x[i+j];
t=AA(e,a,d^(b&(c^d)),w[j],k1);
e=d;
d=c;
c=(b>>>2)|(b<<30);
b=a;
a=t;
j++;
}
while(j<20){
w[j]=RR(w,j);
t=AA(e,a,d^(b&(c^d)),w[j],k1);
e=d;
d=c;
c=(b>>>2)|(b<<30);
b=a;
a=t;
j++;
}
while(j<40){
w[j]=RR(w,j);
t=AA(e,a,b^c^d,w[j],k2);
e=d;
d=c;
c=(b>>>2)|(b<<30);
b=a;
a=t;
j++;
}
while(j<60){
w[j]=RR(w,j);
t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
e=d;
d=c;
c=(b>>>2)|(b<<30);
b=a;
a=t;
j++;
}
while(j<80){
w[j]=RR(w,j);
t=AA(e,a,b^c^d,w[j],k4);
e=d;
d=c;
c=(b>>>2)|(b<<30);
b=a;
a=t;
j++;
}
h0=add32(h0,a);
h1=add32(h1,b);
h2=add32(h2,c);
h3=add32(h3,d);
h4=add32(h4,e);
}
return [h0,h1,h2,h3,h4];
}
})(jQuery);
(function($){
var _37="customStyleSheet";
$.twStylesheet=function(css,_39){
_39=_39||{};
var id=_39.id||_37;
var doc=_39.doc||document;
var el=doc.getElementById(id);
if(doc.createStyleSheet){
if(el){
el.parentNode.removeChild(el);
}
doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id=\""+id+"\" type=\"text/css\">"+css+"</style>");
}else{
if(el){
el.replaceChild(doc.createTextNode(css),el.firstChild);
}else{
el=doc.createElement("style");
el.type="text/css";
el.id=id;
el.appendChild(doc.createTextNode(css));
doc.getElementsByTagName("head")[0].appendChild(el);
}
}
};
$.twStylesheet.remove=function(_3d){
_3d=_3d||{};
var id=_3d.id||_37;
var doc=_3d.doc||document;
var el=doc.getElementById(id);
if(el){
el.parentNode.removeChild(el);
}
};
})(jQuery);

//]]>
</script>
<!--POST-SCRIPT-START-->
<!--POST-SCRIPT-END-->
</body>
</html>
